<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="description" content="Kelvin&#x27;s blog"/><link rel="icon" href="/images/favicon.ico"/><title>使用 Next.js 与 MDX 搭建一个静态博客（一）</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/f7b5dcb73c615fd1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f7b5dcb73c615fd1.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5efe62c786a6b4f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5efe62c786a6b4f4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-81f4fb35f4507347.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7d075d2556e27131.js" defer=""></script><script src="/_next/static/chunks/39-1e17aeb5671a7eb7.js" defer=""></script><script src="/_next/static/chunks/pages/post/how-to-build-a-static-blog-with-nextjs-and-mdx-i-fb32c4db893943de.js" defer=""></script><script src="/_next/static/cwVvvbIvC2_SXId0JVTpT/_buildManifest.js" defer=""></script><script src="/_next/static/cwVvvbIvC2_SXId0JVTpT/_ssgManifest.js" defer=""></script><script src="/_next/static/cwVvvbIvC2_SXId0JVTpT/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="container"><nav class="navbar"><div class="navbar-content"><div class="navbar-menu-container"><ul class="navbar-menu"><li><a href="/">首页</a></li><li><a href="/posts/horse-sense">秘籍</a></li><li><a href="/posts/gibberish">八股</a></li><li><a href="/posts/xray">庖丁</a></li><li><a href="/posts/copycat">画瓢</a></li></ul></div></div></nav><main class="main"><main><article class="post-container"><div class="post-title-container"><h1 class="post-title">使用 Next.js 与 MDX 搭建一个静态博客（一）</h1><p class="post-date">OCT 22, 2021</p></div><blockquote><p>&quot;In some ways, programming is like painting. You start with a blank canvas and certain basic raw materials. You use a combination of science, art, and craft to determine what to do with them.&quot;<br/><br/>-- Andrew Hunt</p></blockquote><h2>Why?</h2><p>花了几天时间，重新搭了一个 blog。考虑到之前一直在写 Vue，这次想换 React 练练手，调研了一堆轮子后，花了九牛二虎之力才最终定下来，用 <a href="https://nextjs.org/">Next.js</a> 和 <a href="https://mdxjs.com/">MDX</a> 来搭。过程中遇到了无数个坑，总结得到了这篇文章。</p><p>之所以选择 Next.js 加 MDX，主要是考虑以下几个需求：</p><ul><li><svg class="marker" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><div>基于 React，方便练手</div></li><li><svg class="marker" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><div>基于 Markdown，不用解释了吧</div></li><li><svg class="marker" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><div>页面、主题能随便改，最好能从零开始</div></li><li><svg class="marker" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><div>最终打包成静态页面，方便直接丢到 Github Pages 上</div></li><li><svg class="marker" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg><div>有脚手架，项目配置简单</div></li></ul><p>上述几个需求，Next.js 都能完美满足，整个开发体验也是相当优秀，跟着文档走一遍基本就能搭出来。剩下的就是找各种优化的插件，以及无休止地修改页面样式。</p><div class="TicTacToe_game__mj0jL"><div class="TicTacToe_board__3JryJ"><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button><button class="TicTacToe_square__vGVnH"></button></div><p>Next Player: X</p><button class="TicTacToe_resetButton__1jf3G">重新开始</button></div><p>项目最开始搭建的时候，本来打算主要写写文章，所以用的是纯 MD 来写。后来发现了<a href="https://www.joshwcomeau.com/">这个网站</a>，里头的<a href="https://www.joshwcomeau.com/blog/how-i-built-my-blog/">这篇文章</a>有介绍作者是怎样搭建他的 blog 的，用到的是 MDX。其实 MDX 就是能在 MD 文件里插入 React 的组件，是 MD 的拓展。当时我想，如果在文章里加一些自定义的组件，用来做演示，效果应该挺好的，就像上面的<code>TicTacToe</code>组件。</p><p>Next.js 集成 MDX 有相当多方案，并且每个都有坑。<a href="https://dev.to/tylerlwsmith/quick-comparison-of-mdx-integration-strategies-with-next-js-1kcm">这篇文章</a>有简单的对比，感兴趣的可以了解一下。一开始我尝试用<code>mdx-bundler</code>来解释 MDX 文件，第一版出来的效果还行，只是卡在了生成目录上。后面发现 <a href="https://beta.reactjs.org/">React 的文档</a>居然更新了，同样是基于 Next.js 和 MDX。于是我赶紧 clone 下来，发现他们用的是<code>@mdx-js/loader</code>，折腾了一番之后，我最终同样选择了<code>@mdx-js/loader</code>，下面会有讲到。</p><h2>How?</h2><h3>第一步：先跑起来再说</h3><p>其实 Next.js 官方有一个比较完整的<a href="https://nextjs.org/learn/basics/create-nextjs-app">新手教程</a>，跟着它走完，就可以把一个基于 markdown 的 blog 跑起来。或者通过<a href="https://github.com/vercel/next.js/tree/canary/examples/blog-starter">这个模板</a>也可以达到同样的效果。然而，作为练手项目，当然得从零开始，重新造个轮子。</p><p>先通过下面的命令，得到一个“纯净版”的 next app：</p><pre class="prism-code language-bash"><code class="prism-code language-bash"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token function">yarn</span><span class="token plain"> create next-app my-blog</span></div></div></code></pre><p>进入项目根目录并运行<code>yarn dev</code>后访问<code>http://localhost:3000</code>，如果能看到下面的页面，就证明项目已经顺利跑起来了。</p><p><img src="/images/how-to-build-a-static-blog-with-nextjs-and-mdx-i/welcome-screen.png" alt="脚手架首页"/></p><p>此时项目的目录结构是这样的：</p><pre class="prism-code language-bash"><code class="prism-code language-bash"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token plain">pages/  </span><span class="token comment"># 目录中的 js 文件将被解析生成页面</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">--- _app.js  </span><span class="token comment"># 全局布局、样式在这里设置</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">--- index.js  </span><span class="token comment"># 通过 http://yoursite/ 来访问</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">--- api/  </span><span class="token comment"># API 路由，可以用来实现 severless 函数</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain">     </span><span class="token operator">|</span><span class="token plain">--- hello.js  </span><span class="token comment"># 通过 http://yoursite/api/hello 来访问，用不到，可忽略</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain">public/  </span><span class="token comment"># 放图片、图标等静态资源</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">styles/  </span><span class="token comment"># 放 css 文件</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">next.config.js  </span><span class="token comment"># Next.js 的配置文件</span></div></div></code></pre><p>上面看到的首页，其实就是<code>pages/index.js</code>里的东西。Next.js 开箱即支持页面路由，不需要繁琐地配置 React Router，仅需要在<code>pages/</code>目录下新增一个文件，比如<code>pages/about.js</code>，然后导出一个组件，如：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// pages/about.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">About</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token maybe-class-name">Hello</span><span class="token plain"> </span><span class="token maybe-class-name">World</span><span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>然后就可以通过<code>http://localhost:3000/about</code>来访问这个页面了，简单到令人发指！</p><p>整个<code>pages/</code>目录就相当于一个路由表，当需要增加页面路由时，在相应的目录下新建文件即可。通过配置不同的 loader，就能支持将不同类型的文件解析为页面。比如通过<code>mdx-js/loader</code>，就能将<code>pages/post/my-first-post.mdx</code>文件解析为<code>http://localhost:3000/post/my-first-post</code>页面。我们最终的文章都是以 MDX 文件的形式保存在<code>pages/post/</code>目录下，具体配置后面会说。</p><p>要注意的是，默认情况下，Next.js 只会解析 JS 文件，需要在<code>next.config.js</code>文件中修改配置来支持更多文件类型：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// next.config.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain">module</span><span class="token punctuation">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">  </span><span class="token literal-property property">pageExtensions</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token string">&quot;js&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;jsx&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;md&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;mdx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></div></code></pre><p>除此之外，并不是所有在<code>pages/</code>目录下的文件都会被解析生成页面，例外的有<code>api/</code>目录及<code>_app.js</code>。其中<code>api/</code>目录主要用于 severless 函数，暂时用不上，可以整个删掉完全忽略。而<code>pages/_app.js</code>这个文件，可以用来进行一些全局的配置。默认生成的<code>pages/_app.js</code>文件内容如下：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// pages/_app.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">MyApp</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Component</span><span class="token parameter punctuation">,</span><span class="token parameter"> pageProps </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">pageProps</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">MyApp</span><span class="token punctuation">;</span></div></div></code></pre><p>类比 React Router，<code>MyApp</code>相当于那个被<code>BrowserRouter</code>包裹的“全局”组件。传给它的<code>Component</code>组件，则对应了<code>pages/</code>目录下每一个将要被解析的文件中默认导出的组件，相当于每个<code>Route</code>。如解析<code>pages/about.js</code>这个文件时，<code>Component = Aboubt</code>，<code>/about</code>这个路由就指向了<code>About</code>组件。</p><h3>第二步：写个布局</h3><p>我们可以利用<code>pages/_app.js</code>来给所有页面增加所有页面的全局配置，如页面头的信息，布局等：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// components/Layout.jsx</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Head</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;next/head&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">NavBar</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./Navbar&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Footer</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./Footer&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token constant">PAGE_TITLE</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;Kelvin&#x27;s Blog&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token constant">PAGE_DESCRIPTION</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;Kelvin&#x27;s blog&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Layout</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain">      </span><span class="token comment">// 将被添加到所有页面头</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Head</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">14</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">meta name</span><span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span><span class="token plain"> content</span><span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1&quot;</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">15</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">meta charSet</span><span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">16</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">meta name</span><span class="token operator">=</span><span class="token string">&quot;description&quot;</span><span class="token plain"> content</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token constant">PAGE_DESCRIPTION</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">17</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">link rel</span><span class="token operator">=</span><span class="token string">&quot;icon&quot;</span><span class="token plain"> href</span><span class="token operator">=</span><span class="token string">&quot;/favicon.ico&quot;</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">18</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">title</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token constant">PAGE_TITLE</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">title</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">19</span><div class="token-line-content"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Head</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">20</span><div class="token-line-content"><span class="token plain">      </span><span class="token comment">// 所有页面通用布局</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">21</span><div class="token-line-content"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token plain">div className</span><span class="token operator">=</span><span class="token string">&quot;container&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">22</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token maybe-class-name">NavBar</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">23</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">main className</span><span class="token operator">=</span><span class="token string">&quot;main&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">main</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">24</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Footer</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">25</span><div class="token-line-content"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">26</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">27</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">28</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>在根目录下新建<code>components/</code>目录，把自定义的组件都丢进去方便管理。创建几个页面布局用的组件，像<code> NavBar</code>、<code>Footer </code>这些。然后创一个<code>Layout</code>组件，将这些用于布局的组件像上面一样都引进来。</p><p>再利用 Next.js 自带的<code>Head</code>组件，添加页面标题，icon，各种 SEO 的标签等。将<code>Layout</code>组件引入到<code>pages/_app.js</code>中，像下面这样包住<code>&lt;Component /&gt;</code>，就可以实现全局的布局了。</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// pages/_app.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Layout</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;components/Layout&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&quot;styles/main.scss&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">MyApp</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> </span><span class="token parameter maybe-class-name">Component</span><span class="token parameter punctuation">,</span><span class="token parameter"> pageProps </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Layout</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Component</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token spread operator">...</span><span class="token plain">pageProps</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Layout</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">MyApp</span><span class="token punctuation">;</span></div></div></code></pre><h3>第三步：写个首页</h3><p><img src="/images/how-to-build-a-static-blog-with-nextjs-and-mdx-i/home.png" alt="Blog 首页"/></p><p>写完基本的布局，是时候来写首页了。Blog 的首页比较简单，就是一个文章的列表，包括文章的标题、发表日期、简介等。这些数据，会在 Next.js 打包时，传给每一个文章页面的组件。</p><p>Next.js 支持 SSG 和 SSR 的方式去生成页面，我们是纯静态页面，不考虑 SSR。在 SSG 的过程中，Next.js 提供了<code>getStaticProps()</code>钩子，可以在生成页面的时候去做一些额外的处理，比如从数据库中获取数据，压缩图片等。这些处理过的数据，可以通过<code>getStaticProps()</code>返回的对象（<code>props</code>）传递给页面组件。</p><p>假设我们有一个获取文章数据的<code>getAllPosts()</code>函数。我们可以在<code>pages/index.js</code>中导出一个异步函数<code>getStaticProps</code>，在这个函数中调用<code>getAllPosts</code>，将获取到的文章数据<code>postsData</code>包裹在一个对象中返回出来（作为<code>props</code>属性的值）。Next.js 就会在 SSG 的过程中，以<code>props</code>的形式将这个返回值传递给<code>Home</code>组件。</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// pages/index.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">  </span><span class="token comment">// 获取文章数据</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain"></span><span class="token comment">// 在打包时调用，返回 props 给 Home 组件生成首页</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> postsData </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">    </span><span class="token literal-property property">props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain">      postsData</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">14</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">15</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">16</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Home</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> postsData </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">17</span><div class="token-line-content"><span class="token plain">  </span><span class="token comment">// 首页</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">18</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>那么问题来了，这个<code>getAllPosts()</code>函数，该怎么弄呢？前面讲过，最终我们是要用 MDX 文件来写文章，放在<code>pages/post/</code>这个目录下。每个文件，即每篇文章生成一个文章的页面，路由为文件名，如下：</p><pre class="prism-code language-bash"><code class="prism-code language-bash"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token plain">pages/</span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token operator">|</span><span class="token plain">--- post/</span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">     </span><span class="token operator">|</span><span class="token plain">--- first-post.mdx   </span><span class="token comment"># =&gt; http://localhost:3000/post/first-post</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain">     </span><span class="token operator">|</span><span class="token plain">--- second-post.mdx  </span><span class="token comment"># =&gt; http://localhost:3000/post/second-post</span></div></div></code></pre><p>那么有没有可能，在这些文件中记录标题、发表日期、简介等信息，然后遍历这个目录下的所有文件，取出这些数据呢？有，我们需要用到 <strong>frontmatter</strong>！</p><p>Frontmatter 是 markdown 的插件，通过在 MD 文件头插入键值对的方式，存储有关文件的元数据。我们可以通过 frontmatter 来存储标题、发表日期、简介这些信息，格式如下：</p><pre class="prism-code language-md"><code class="prism-code language-md"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token front-matter-block punctuation">---</span><span class="token front-matter-block"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token front-matter-block"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">title</span><span class="token front-matter-block front-matter yaml language-yaml punctuation">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml string">&quot;使用 Next.js 与 MDX 搭建一个静态博客&quot;</span><span class="token front-matter-block front-matter yaml language-yaml"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">date</span><span class="token front-matter-block front-matter yaml language-yaml punctuation">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml string">&quot;OCT 22, 2021&quot;</span><span class="token front-matter-block front-matter yaml language-yaml"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token front-matter-block front-matter yaml language-yaml"></span><span class="token front-matter-block front-matter yaml language-yaml key atrule">desc</span><span class="token front-matter-block front-matter yaml language-yaml punctuation">:</span><span class="token front-matter-block front-matter yaml language-yaml"> </span><span class="token front-matter-block front-matter yaml language-yaml string">&quot;花了几天时间，重新搭了一个 blog。&quot;</span><span class="token front-matter-block"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token front-matter-block"></span><span class="token front-matter-block punctuation">---</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">文章正文部分</span></div></div></code></pre><p>使用 <a href="https://github.com/jonschlinkert/gray-matter">gray-matter</a> 这个包，可以将这些元数据提取出来，具体方法为，先安装依赖包：</p><pre class="prism-code language-bash"><code class="prism-code language-bash"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token function">yarn</span><span class="token plain"> </span><span class="token function">add</span><span class="token plain"> gray-matter -D</span></div></div></code></pre><p>在根目录新建<code>lib/posts.js</code>文件，实现<code>getAllPosts()</code>函数。大致过程为，先遍历<code>pages/post/</code>目录，拿到所有文件，过滤掉只要 MDX 文件。读取每个文件，通过<code>gray-matter</code>处理，将提取到的数据与文件名（id）一并按发表日期排序后返回。具体代码如下：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// lib/posts.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">fs</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">path</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">matter</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;gray-matter&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> postsDirectory </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token plain">process</span><span class="token punctuation">.</span><span class="token method function property-access">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;pages&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;post&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain">  </span><span class="token comment">// 获取 /posts 目录下的文件名，过滤只要 MDX 文件</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> fileNames </span><span class="token operator">=</span><span class="token plain"> fs</span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span><span class="token plain">postsDirectory</span><span class="token punctuation">)</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> fileName</span><span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.mdx$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> postsData </span><span class="token operator">=</span><span class="token plain"> fileNames</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">14</span><div class="token-line-content"><span class="token plain">    </span><span class="token comment">// 去除后缀名，剩下的文件名为 id</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">15</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> id </span><span class="token operator">=</span><span class="token plain"> fileName</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">\.mdx$</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">16</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">17</span><div class="token-line-content"><span class="token plain">    </span><span class="token comment">// MDX 文件路径</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">18</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> fullPath </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token plain">postsDirectory</span><span class="token punctuation">,</span><span class="token plain"> fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">19</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> fileContent </span><span class="token operator">=</span><span class="token plain"> fs</span><span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span><span class="token plain">fullPath</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">20</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">21</span><div class="token-line-content"><span class="token plain">    </span><span class="token comment">// 读取 MDX 文件头数据</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">22</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> data </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">matter</span><span class="token punctuation">(</span><span class="token plain">fileContent</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">23</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">24</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">25</span><div class="token-line-content"><span class="token plain">      id</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">26</span><div class="token-line-content"><span class="token plain">      </span><span class="token spread operator">...</span><span class="token plain">data</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">27</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">28</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">29</span><div class="token-line-content"><span class="token plain">  </span><span class="token comment">// 返回按时间排序的结果</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">30</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> postsData</span><span class="token punctuation">.</span><span class="token method function property-access">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> </span><span class="token parameter literal-property property">date</span><span class="token parameter operator">:</span><span class="token parameter"> a </span><span class="token parameter punctuation">}</span><span class="token parameter punctuation">,</span><span class="token parameter"> </span><span class="token parameter punctuation">{</span><span class="token parameter"> </span><span class="token parameter literal-property property">date</span><span class="token parameter operator">:</span><span class="token parameter"> b </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">31</span><div class="token-line-content"><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">&lt;</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">32</span><div class="token-line-content"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">33</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">a </span><span class="token operator">&gt;</span><span class="token plain"> b</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">34</span><div class="token-line-content"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">35</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword control-flow">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">36</span><div class="token-line-content"><span class="token plain">      </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">37</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">38</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">39</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>然后在<code>components/</code>目录中新建一个<code>PostList</code>组件，方便在别的页面中复用。组件用到了 Next.js 自带的<code>Link</code>组件，用法可以看<a href="https://nextjs.org/docs/api-reference/next/link">官方文档</a>，代码如下：</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// components/PostList.jsx</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Link</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;next/link&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain"></span><span class="token comment">// postData 包含了所有文章的 id、标题、发表日期、简介</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">PostList</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> postsData </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">ul className</span><span class="token operator">=</span><span class="token string">&quot;main-posts-list&quot;</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain">postsData</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> id</span><span class="token parameter punctuation">,</span><span class="token parameter"> title</span><span class="token parameter punctuation">,</span><span class="token parameter"> date</span><span class="token parameter punctuation">,</span><span class="token parameter"> desc </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token plain">li key</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token plain">article</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token plain">div className</span><span class="token operator">=</span><span class="token string">&quot;posts-list-date&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">date</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">div</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Link</span><span class="token plain"> href</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">/post/</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain">              </span><span class="token operator">&lt;</span><span class="token plain">a</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">14</span><div class="token-line-content"><span class="token plain">                </span><span class="token operator">&lt;</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">title</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">h1</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">15</span><div class="token-line-content"><span class="token plain">              </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">a</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">16</span><div class="token-line-content"><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">Link</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">17</span><div class="token-line-content"><span class="token plain">            </span><span class="token operator">&lt;</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token plain">desc</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">p</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">18</span><div class="token-line-content"><span class="token plain">          </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">article</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">19</span><div class="token-line-content"><span class="token plain">        </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">li</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">20</span><div class="token-line-content"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">21</span><div class="token-line-content"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">ul</span><span class="token operator">&gt;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">22</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">23</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>最后在<code>pages/index.js</code>文件中调用<code>getAllPosts</code>并传给<code>PostList</code>。注意，最后<code>return</code>出来的数据，一定要包在<code>props{}</code>对象中。如此这番折腾之后，我们的首页终于完成了！</p><pre class="prism-code language-js"><code class="prism-code language-js"><div class="token-line"><span class="line-number">1</span><div class="token-line-content"><span class="token comment">// pages/index.js</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">2</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">PostList</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;components/PostList&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">3</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> getAllPosts </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;lib/posts&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">4</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">5</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">6</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> postsData </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">7</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">8</span><div class="token-line-content"><span class="token plain">    </span><span class="token literal-property property">props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">9</span><div class="token-line-content"><span class="token plain">      postsData</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">10</span><div class="token-line-content"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">11</span><div class="token-line-content"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">12</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">13</span><div class="token-line-content"><span class="token plain">
</span></div></div><div class="token-line"><span class="line-number">14</span><div class="token-line-content"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Home</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> postsData </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">15</span><div class="token-line-content"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token maybe-class-name">PostList</span><span class="token plain"> postsData</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">postsData</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></div></div><div class="token-line"><span class="line-number">16</span><div class="token-line-content"><span class="token plain"></span><span class="token punctuation">}</span></div></div></code></pre><p>鉴于篇幅有点过长，我决定将它砍成几份。关于文章页面的生成，代码高亮的配置，文章目录等，改日再写。</p></article></main></main><footer><div>Build with ♥ @GZ</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/post/how-to-build-a-static-blog-with-nextjs-and-mdx-i","query":{},"buildId":"cwVvvbIvC2_SXId0JVTpT","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>