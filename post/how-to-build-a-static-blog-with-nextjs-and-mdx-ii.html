<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="description" content="Kelvin&#x27;s blog"/><link rel="icon" href="/images/favicon.ico"/><title>使用 Next.js 与 MDX 搭建一个静态博客（二）</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/e2fd2485305bc9a4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e2fd2485305bc9a4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5efe62c786a6b4f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5efe62c786a6b4f4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-81f4fb35f4507347.js" defer=""></script><script src="/_next/static/chunks/pages/_app-7b4daab53c85f4a6.js" defer=""></script><script src="/_next/static/chunks/323-451496564d94cd92.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bid%5D-27bdb1cff1f518c2.js" defer=""></script><script src="/_next/static/uGHNlN9iOuFLKPkuPU0G7/_buildManifest.js" defer=""></script><script src="/_next/static/uGHNlN9iOuFLKPkuPU0G7/_ssgManifest.js" defer=""></script><script src="/_next/static/uGHNlN9iOuFLKPkuPU0G7/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="container"><nav class="navbar"><div class="navbar-content"><div class="navbar-menu-container"><ul class="navbar-menu"><li><a class="active" href="/">首页</a></li><li><a href="/posts/horse-sense">秘籍</a></li><li><a href="/posts/gibberish">八股</a></li><li><a href="/posts/xray">庖丁</a></li><li><a href="/posts/copycat">画瓢</a></li></ul></div></div></nav><main class="main"><main><article class="post-container"><div class="post-title-container"><h1 class="post-title">使用 Next.js 与 MDX 搭建一个静态博客（二）</h1><p class="post-date">JUNE 9, 2022</p></div><p>在上一篇介绍<a href="how-to-build-a-static-blog-with-nextjs-and-mdx-i">博客搭建的文章</a>里，小结了 Next 的基本项目结构、全局布局，以及怎样读取 MDX 的头数据等。这次继续介绍如何解析 MDX 的内容到博客文章页面，以及代码块如何高亮。以下面的目录结构为起点：</p>
<div class="code-block-container"><div class="code-block-head"><span>&gt;_&lt;</span><span>bash</span></div><pre class="prism-code language-bash"><div class="code-block"><span class="token-line"><span class="token plain">components/</span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- Layout.jsx</span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- NavBar.jsx</span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- Footer.jsx</span></span><span class="token-line"><span class="token plain">lib/</span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- posts.js</span></span><span class="token-line"><span class="token plain">pages/  </span><span class="token comment"># 目录中的 js 文件将被解析生成页面</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- _app.js  </span><span class="token comment"># 全局布局、样式在这里设置</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- index.js  </span><span class="token comment"># 通过 http://yoursite/ 来访问</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">posts/  </span><span class="token comment"># 文章目录，放 mdx 文件</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token operator">|</span><span class="token plain">--- first-post.mdx</span></span><span class="token-line"><span class="token plain">public/  </span><span class="token comment"># 放图片、图标等静态资源</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">styles/  </span><span class="token comment"># 放 css 文件</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">next.config.js  </span><span class="token comment"># Next.js 的配置文件</span><span class="token plain"></span></span></div></pre></div>
<h2>博客文章页面</h2>
<h3>第一步：动态路由</h3>
<p>在 Next 中，除了<code>pages/index.js</code>这种生成“固定”链接的页面，还可以生成“动态”链接的页面。我们希望以<code>http://localhost:3000/post/:id</code>的链接来访问相应的文章，这里的<code>id</code>就是“动态”的部分，它根据文章的 id（文件名）动态生成。我们的文章以 MDX 文件的形式放在<code>posts/</code>目录中，可以利用 Next 的<a href="https://nextjs.org/docs/routing/dynamic-routes">动态路由（Dynamic Routes）</a>机制来实现。</p>
<p>我们希望最终的路由用文章的标题来组成，如<code>/post/hello-world</code>、<code>/post/my-post</code>等。为此我们在<code>pages/</code>目录下新建<code>pages/post/[id].js</code>文件。其中，文件名中的<code>[id]</code>表示文章对应 MDX 文件的文件名，将用于生成动态路由。关于动态路由的详细用法，可以看 Next 的<a href="https://nextjs.org/docs/routing/dynamic-routes">官方文档</a>，这里不再赘述。</p>
<p>我们的页面是静态生成的，在<code>[id].js</code>文件中，我们使用<code>getStaticPaths()</code>方法，来生成相应的动态路由。该方法需要返回一个<code>paths</code>数组，枚举所有可能的动态路由，对于我们的博客项目来说，就是要返回所有文章的<code>id</code>。</p>
<p>由于我们只需要返回文章的 id，直接调用上回提到的<code>getAllPosts()</code>方法即可：</p>
<div class="code-block-container"><div class="code-block-head"><span>pages/post/[id].js</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> getAllPosts </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;lib/posts&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> posts </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">paths</span><span class="token operator">:</span><span class="token plain"> posts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token literal-property property">params</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> post</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h3>第二步：读取页面数据</h3>
<p><code>getStaticPaths()</code>方法还需要搭配<code>getStaticProps()</code>方法一起使用，后者将返回一个<code>props</code>对象，在生成静态页面时，作为文章页面组件的参数使用。<code>getStaticProps(context)</code>方法接受一个<code>context</code>对象作为参数，其中<code>context.params</code>属性包含了路由信息，即<code>getStaticPaths()</code>方法返回的<code>paths</code>数组中每一个对象中的<code>params</code>属性。</p>
<p>可能有点绕，举例就是对于<code>[id].js</code>页面来说，<code>context.params</code>即<code>{id: ...}</code>。我们可以通过<code>id</code>拿到文件名，再去读取对应的 MDX 文件，解析出文章的具体内容。</p>
<p>我们通过<code>mdx-bundler</code>的<code>bundleMDX()</code>方法来解析读取到的 MDX 文件数据，该方法会返回解析好的正文内容（<code>code</code>）和<code>frontmatter</code>头部数据，我们需要将这些数据以<code>props</code>对象的形式返回，如下：</p>
<div class="code-block-container"><div class="code-block-head"><span>pages/post/[id].js</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">fs</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">path</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> bundleMDX </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;mdx-bundler&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> postsDirectory </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;lib/posts&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> params </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> filePath </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token plain">postsDirectory</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">params</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">id</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">.mdx</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> fileContent </span><span class="token operator">=</span><span class="token plain"> fs</span><span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">,</span><span class="token plain"> frontmatter </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token function">bundleMDX</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">source</span><span class="token operator">:</span><span class="token plain"> fileContent</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token comment">// 插件，后面会有讲到</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">meta</span><span class="token operator">:</span><span class="token plain"> frontmatter</span><span class="token punctuation">,</span><span class="token plain"> code </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h3>第三步：页面组件</h3>
<p>有了解析好的文章数据后，我们就可以来写页面组件了。前面提到的正文数据<code>code</code>，并不能直接使用，需要用<code>mdx-bundler</code>的<code>getMDXComponent()</code>方法再解析一遍，得到一个 React 组件（<code>&lt;Content /&gt;</code>）。你可以直接使用该组件，或者自己写一个<code>&lt;PostLayout /&gt;</code>布局的组件把正文套进去：</p>
<div class="code-block-container"><div class="code-block-head"><span>pages/post/[id].js</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> getMDXComponent </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;mdx-bundler/client&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">PostLayout</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;components/PostLayout&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Post</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> meta</span><span class="token parameter punctuation">,</span><span class="token parameter"> code </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Content</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getMDXComponent</span><span class="token punctuation">(</span><span class="token plain">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token maybe-class-name">PostLayout</span><span class="token plain"> meta</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">meta</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Content</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">PostLayout</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h3>小结</h3>
<p>到此为止，我们的文章页面就写好了。我们来小结一下整个流程。</p>
<ol>
<li>当 Next 生成动态路由页面时，会调用<code>getStaticPaths()</code>和<code>getStaticProps()</code>两个方法。前者用于生成路由，后者给组件提供<code>props</code>。</li>
<li>当 Next 调用<code>getStaticPaths()</code>方法时，我们利用<code>getAllPosts()</code>方法，读取文章目录中所有的 MDX 文件数据，生成<code>paths</code>数组。数组中的每一项对应一个文章页面的动态路由，即<code>id</code>，并通过<code>context.params</code>提供给<code>getStaticProps()</code>方法使用。</li>
<li><code>getStaticProps()</code>方法，通过调用<code>bundleMDX()</code>方法，找到相应的 MDX 文件进行解析，返回<code>code</code>与<code>meta</code>组成的<code>props</code>给到<code>&lt;Post/&gt;</code>组件使用。</li>
<li><code>&lt;Post/&gt;</code>组件，通过调用<code>getMDXComponent()</code>方法，将<code>props.code</code>转化成<code>&lt;Content/&gt;</code>组件，显示文章正文内容。</li>
</ol>
<p>大致流程如下图所示：</p>
<p><img src="/images/how-to-build-a-static-blog-with-nextjs-and-mdx-ii/flow.png" alt=""/></p>
<p>此时<code>[id].js</code>文件的完整代码如下：</p>
<div class="code-block-container"><div class="code-block-head"><span>pages/post/[id].js</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">fs</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">path</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> bundleMDX </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;mdx-bundler&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> getMDXComponent </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;mdx-bundler/client&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">PostLayout</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;components/PostLayout&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> postsDirectory</span><span class="token imports punctuation">,</span><span class="token imports"> getAllPosts </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;lib/posts&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticPaths</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> posts </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAllPosts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">paths</span><span class="token operator">:</span><span class="token plain"> posts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">post</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token literal-property property">params</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> post</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">fallback</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">getStaticProps</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> params </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> filePath </span><span class="token operator">=</span><span class="token plain"> path</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token plain">postsDirectory</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string interpolation interpolation-punctuation punctuation">${</span><span class="token template-string interpolation">params</span><span class="token template-string interpolation punctuation">.</span><span class="token template-string interpolation property-access">id</span><span class="token template-string interpolation interpolation-punctuation punctuation">}</span><span class="token template-string string">.mdx</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> fileContent </span><span class="token operator">=</span><span class="token plain"> fs</span><span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span><span class="token plain">filePath</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;utf-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> code</span><span class="token punctuation">,</span><span class="token plain"> frontmatter </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword control-flow">await</span><span class="token plain"> </span><span class="token function">bundleMDX</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">source</span><span class="token operator">:</span><span class="token plain"> fileContent</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token comment">// 插件，后面会有讲到</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">meta</span><span class="token operator">:</span><span class="token plain"> frontmatter</span><span class="token punctuation">,</span><span class="token plain"> code </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Post</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> meta</span><span class="token parameter punctuation">,</span><span class="token parameter"> code </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Content</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getMDXComponent</span><span class="token punctuation">(</span><span class="token plain">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token maybe-class-name">PostLayout</span><span class="token plain"> meta</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">meta</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Content</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">PostLayout</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h2>代码高亮</h2>
<p>作为一个开发者的博客，文章中必定少不了代码块，而默认情况下代码块的样式非常影响阅读，如下图：</p>
<p><img src="/images/how-to-build-a-static-blog-with-nextjs-and-mdx-ii/plain-code.png" alt=""/></p>
<p>因此我们需要把代码块高亮化处理。可以实现代码高亮的轮子有很多，比较常用的是 <a href="https://prismjs.com/">Prism.js</a> 和 <a href="https://highlightjs.org/">highlight.js</a> 这两个。我最终选择的是 Prism，用到 <a href="https://github.com/FormidableLabs/prism-react-renderer">prism-react-renderer</a> 这个包。</p>
<p>我们的代码块，通过<code>mdx-bundler</code>转换后，是放在<code>&lt;pre&gt;&lt;/pre&gt;</code>标签中的。为了改变代码块的样式，我们可以自定义转换后的<code>&lt;pre&gt;&lt;/pre&gt;</code>标签。</p>
<p>上面讲过，我们读取到的 MDX 文件是通过<code>bundleMDX()</code>这个方法进行转换后，再通过<code>getMDXComponent()</code>这个方法转成 React 组件的。转换生成的组件（<code>&lt;Content/&gt;</code>）有一个<code>components</code>属性，可以替换生成的 HTML 标签。</p>
<h3>第一步：创建代码块组件</h3>
<p>我们可以创建一个<code>&lt;CodeBlock/&gt;</code>组件，用于替换<code>&lt;pre&gt;&lt;/pre&gt;</code>标签。在<code>components/</code>目录下，我们新建<code>CodeBlock.jsx</code>文件。</p>
<div class="code-block-container"><div class="code-block-head"><span>components/CodeBlock.jsx</span><span>jsx</span></div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Highlight</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports punctuation">{</span><span class="token imports"> defaultProps </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;prism-react-renderer&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">CodeBlock</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> className</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token literal-property property">children</span><span class="token operator">:</span><span class="token plain"> code </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> children</span><span class="token punctuation">.</span><span class="token property-access">props</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> language </span><span class="token operator">=</span><span class="token plain"> className </span><span class="token operator">&amp;&amp;</span><span class="token plain"> className</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex regex-delimiter">/</span><span class="token regex regex-source language-regex">language-</span><span class="token regex regex-delimiter">/</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Highlight</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">defaultProps</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">code</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">code</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">language</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">language</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> className</span><span class="token parameter punctuation">,</span><span class="token parameter"> style</span><span class="token parameter punctuation">,</span><span class="token parameter"> tokens</span><span class="token parameter punctuation">,</span><span class="token parameter"> getLineProps</span><span class="token parameter punctuation">,</span><span class="token parameter"> getTokenProps </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">        </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">code-block-container</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">          </span><span class="token tag punctuation">&lt;</span><span class="token tag">pre</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">className</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">style</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">code-block</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">              </span><span class="token punctuation">{</span><span class="token plain">tokens</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">line</span><span class="token parameter punctuation">,</span><span class="token parameter"> i</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">                </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">i</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread method function property-access">getLineProps</span><span class="token tag spread punctuation">(</span><span class="token tag spread punctuation">{</span><span class="token tag spread"> line</span><span class="token tag spread punctuation">,</span><span class="token tag spread"> </span><span class="token tag spread literal-property property">key</span><span class="token tag spread operator">:</span><span class="token tag spread"> i </span><span class="token tag spread punctuation">}</span><span class="token tag spread punctuation">)</span><span class="token tag spread punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">                  </span><span class="token punctuation">{</span><span class="token plain">line</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">token</span><span class="token parameter punctuation">,</span><span class="token parameter"> key</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">                    </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">key</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread method function property-access">getTokenProps</span><span class="token tag spread punctuation">(</span><span class="token tag spread punctuation">{</span><span class="token tag spread"> token</span><span class="token tag spread punctuation">,</span><span class="token tag spread"> key </span><span class="token tag spread punctuation">}</span><span class="token tag spread punctuation">)</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">                  </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">                </span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">              </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">            </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">          </span><span class="token tag punctuation">&lt;/</span><span class="token tag">pre</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">        </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">Highlight</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">CodeBlock</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>首先<code>&lt;CodeBlock/&gt;</code>组件接受一个名叫<code>children</code>的 props，它的<code>type</code>属性是<code>&#x27;code&#x27;</code>，表示这是一个代码块。除此以外<code>children</code>还有一个<code>props</code>属性，包含<code>className</code>和又一个<code>children</code>属性。结构大致如下：</p>
<div class="code-block-container"><div class="code-block-head"><span>&gt;_&lt;</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token literal-property property">children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;code&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token literal-property property">props</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token literal-property property">className</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;language-js&#x27;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token literal-property property">children</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;console.log(&quot;hi&quot;)&#x27;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<p>我们在 Markdonw 中写代码块时，可以表明代码语言，如：</p>
<div class="code-block-container"><div class="code-block-head"><span>&gt;_&lt;</span><span>md</span></div><pre class="prism-code language-md"><div class="code-block"><span class="token-line"><span class="token code punctuation">```</span><span class="token code code-language">js</span><span class="token code"></span></span><span class="token-line"><span class="token code"></span><span class="token code code-block language-js">console.log(&quot;hello&quot;);</span><span class="token code"></span></span><span class="token-line"><span class="token code"></span><span class="token code punctuation">```</span><span class="token plain"></span></span></div></pre></div>
<p>其中<code>children.props.className</code>就是根据<code>```</code>后面所填写的语言生成的字符串，格式为<code>&#x27;language-*&#x27;</code>，通过简单的正则匹配我们就能得到代码块的语言。而<code>children.props.children</code>则为代码文本。</p>
<p>prism-react-renderer 提供了一个<code>&lt;Highlight/&gt;</code>组件，用于高亮代码，用法比较简单，将对应的 props 传入即可，不再赘述。</p>
<h3>第二步：替换标签</h3>
<p>接下来我们要做的就是回到<code>&lt;Post/&gt;</code>组件中，将<code>CodeBlock</code>组件传入替换即可：</p>
<div class="code-block-container"><div class="code-block-head"><span>pages/post/[id].js</span><span>js</span></div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">CodeBlock</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;components/CodeBlock&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token comment">// 上略</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function maybe-class-name">Post</span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> meta</span><span class="token parameter punctuation">,</span><span class="token parameter"> code </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">Content</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getMDXComponent</span><span class="token punctuation">(</span><span class="token plain">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token maybe-class-name">PostLayout</span><span class="token plain"> meta</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">meta</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token operator">&lt;</span><span class="token maybe-class-name">Content</span><span class="token plain"> components</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token literal-property property">pre</span><span class="token operator">:</span><span class="token plain"> </span><span class="token maybe-class-name">CodeBlock</span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token maybe-class-name">PostLayout</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h3>第三步：修改主题</h3>
<p>到此，我们的代码就已经“亮”起来了。默认使用的是 <a href="https://github.com/FormidableLabs/prism-react-renderer/blob/master/src/themes/duotoneDark.js">duotoneDark</a> 主题，确实不太好看，没关系，我们可以通过下面的方法进行修改。</p>
<h4>方法一</h4>
<p>我们可以直接使用 prism-react-renderer 提供的主题，可以在<code>prism-react-renderer/themes/</code>目录下找到它们，然后直接修改<code>&lt;Highlight/&gt;</code>组件传入<code>theme</code>即可：</p>
<div class="code-block-container"><div class="code-block-head"><span>&gt;_&lt;</span><span>jsx</span></div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">dracula</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;prism-react-renderer/themes/dracula&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">
</span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Highlight</span><span class="token tag"> </span><span class="token tag attr-name">theme</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dracula</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<h4>方法二</h4>
<p>由于 prism-react-renderer 生成代码块的标签中都添加了相应的 class，我们可以直接使用 Prism 的主题。主题在网上搜一下就能找到，直接把 css 拿过来使用即可。</p></article></main></main><footer><div>Build with ♥ @GZ</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"meta":{"title":"使用 Next.js 与 MDX 搭建一个静态博客（二）","date":"JUNE 9, 2022","desc":"在上一篇介绍博客搭建的文章里，小结了 Next 的基本项目结构、全局布局，以及怎样读取 MDX 的头数据等。这次继续介绍如何解析 MDX 的内容到博客文章页面，以及代码块如何高亮。","type":"horse-sense"},"code":"var Component=(()=\u003e{var a=Object.create;var d=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var u=(t,c)=\u003e()=\u003e(c||t((c={exports:{}}).exports,c),c.exports),f=(t,c)=\u003e{for(var o in c)d(t,o,{get:c[o],enumerable:!0})},i=(t,c,o,n)=\u003e{if(c\u0026\u0026typeof c==\"object\"||typeof c==\"function\")for(let r of p(c))!g.call(t,r)\u0026\u0026r!==o\u0026\u0026d(t,r,{get:()=\u003ec[r],enumerable:!(n=h(c,r))||n.enumerable});return t};var x=(t,c,o)=\u003e(o=t!=null?a(m(t)):{},i(c||!t||!t.__esModule?d(o,\"default\",{value:t,enumerable:!0}):o,t)),j=t=\u003ei(d({},\"__esModule\",{value:!0}),t);var l=u((M,s)=\u003e{s.exports=_jsx_runtime});var D={};f(D,{default:()=\u003eb,frontmatter:()=\u003eP});var e=x(l()),P={title:\"\\u4F7F\\u7528 Next.js \\u4E0E MDX \\u642D\\u5EFA\\u4E00\\u4E2A\\u9759\\u6001\\u535A\\u5BA2\\uFF08\\u4E8C\\uFF09\",date:\"JUNE 9, 2022\",desc:\"\\u5728\\u4E0A\\u4E00\\u7BC7\\u4ECB\\u7ECD\\u535A\\u5BA2\\u642D\\u5EFA\\u7684\\u6587\\u7AE0\\u91CC\\uFF0C\\u5C0F\\u7ED3\\u4E86 Next \\u7684\\u57FA\\u672C\\u9879\\u76EE\\u7ED3\\u6784\\u3001\\u5168\\u5C40\\u5E03\\u5C40\\uFF0C\\u4EE5\\u53CA\\u600E\\u6837\\u8BFB\\u53D6 MDX \\u7684\\u5934\\u6570\\u636E\\u7B49\\u3002\\u8FD9\\u6B21\\u7EE7\\u7EED\\u4ECB\\u7ECD\\u5982\\u4F55\\u89E3\\u6790 MDX \\u7684\\u5185\\u5BB9\\u5230\\u535A\\u5BA2\\u6587\\u7AE0\\u9875\\u9762\\uFF0C\\u4EE5\\u53CA\\u4EE3\\u7801\\u5757\\u5982\\u4F55\\u9AD8\\u4EAE\\u3002\",type:\"horse-sense\"};function y(t={}){let{wrapper:c}=t.components||{};return c?(0,e.jsx)(c,Object.assign({},t,{children:(0,e.jsx)(o,{})})):o();function o(){let n=Object.assign({p:\"p\",a:\"a\",pre:\"pre\",code:\"code\",h2:\"h2\",h3:\"h3\",ol:\"ol\",li:\"li\",img:\"img\",h4:\"h4\"},t.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[\"\\u5728\\u4E0A\\u4E00\\u7BC7\\u4ECB\\u7ECD\",(0,e.jsx)(n.a,{href:\"how-to-build-a-static-blog-with-nextjs-and-mdx-i\",children:\"\\u535A\\u5BA2\\u642D\\u5EFA\\u7684\\u6587\\u7AE0\"}),\"\\u91CC\\uFF0C\\u5C0F\\u7ED3\\u4E86 Next \\u7684\\u57FA\\u672C\\u9879\\u76EE\\u7ED3\\u6784\\u3001\\u5168\\u5C40\\u5E03\\u5C40\\uFF0C\\u4EE5\\u53CA\\u600E\\u6837\\u8BFB\\u53D6 MDX \\u7684\\u5934\\u6570\\u636E\\u7B49\\u3002\\u8FD9\\u6B21\\u7EE7\\u7EED\\u4ECB\\u7ECD\\u5982\\u4F55\\u89E3\\u6790 MDX \\u7684\\u5185\\u5BB9\\u5230\\u535A\\u5BA2\\u6587\\u7AE0\\u9875\\u9762\\uFF0C\\u4EE5\\u53CA\\u4EE3\\u7801\\u5757\\u5982\\u4F55\\u9AD8\\u4EAE\\u3002\\u4EE5\\u4E0B\\u9762\\u7684\\u76EE\\u5F55\\u7ED3\\u6784\\u4E3A\\u8D77\\u70B9\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-bash\",children:`components/\n  |--- Layout.jsx\n  |--- NavBar.jsx\n  |--- Footer.jsx\nlib/\n  |--- posts.js\npages/  # \\u76EE\\u5F55\\u4E2D\\u7684 js \\u6587\\u4EF6\\u5C06\\u88AB\\u89E3\\u6790\\u751F\\u6210\\u9875\\u9762\n  |--- _app.js  # \\u5168\\u5C40\\u5E03\\u5C40\\u3001\\u6837\\u5F0F\\u5728\\u8FD9\\u91CC\\u8BBE\\u7F6E\n  |--- index.js  # \\u901A\\u8FC7 http://yoursite/ \\u6765\\u8BBF\\u95EE\nposts/  # \\u6587\\u7AE0\\u76EE\\u5F55\\uFF0C\\u653E mdx \\u6587\\u4EF6\n  |--- first-post.mdx\npublic/  # \\u653E\\u56FE\\u7247\\u3001\\u56FE\\u6807\\u7B49\\u9759\\u6001\\u8D44\\u6E90\nstyles/  # \\u653E css \\u6587\\u4EF6\nnext.config.js  # Next.js \\u7684\\u914D\\u7F6E\\u6587\\u4EF6\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u535A\\u5BA2\\u6587\\u7AE0\\u9875\\u9762\"}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E00\\u6B65\\uFF1A\\u52A8\\u6001\\u8DEF\\u7531\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5728 Next \\u4E2D\\uFF0C\\u9664\\u4E86\",(0,e.jsx)(n.code,{children:\"pages/index.js\"}),\"\\u8FD9\\u79CD\\u751F\\u6210\\u201C\\u56FA\\u5B9A\\u201D\\u94FE\\u63A5\\u7684\\u9875\\u9762\\uFF0C\\u8FD8\\u53EF\\u4EE5\\u751F\\u6210\\u201C\\u52A8\\u6001\\u201D\\u94FE\\u63A5\\u7684\\u9875\\u9762\\u3002\\u6211\\u4EEC\\u5E0C\\u671B\\u4EE5\",(0,e.jsx)(n.code,{children:\"http://localhost:3000/post/:id\"}),\"\\u7684\\u94FE\\u63A5\\u6765\\u8BBF\\u95EE\\u76F8\\u5E94\\u7684\\u6587\\u7AE0\\uFF0C\\u8FD9\\u91CC\\u7684\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\u5C31\\u662F\\u201C\\u52A8\\u6001\\u201D\\u7684\\u90E8\\u5206\\uFF0C\\u5B83\\u6839\\u636E\\u6587\\u7AE0\\u7684 id\\uFF08\\u6587\\u4EF6\\u540D\\uFF09\\u52A8\\u6001\\u751F\\u6210\\u3002\\u6211\\u4EEC\\u7684\\u6587\\u7AE0\\u4EE5 MDX \\u6587\\u4EF6\\u7684\\u5F62\\u5F0F\\u653E\\u5728\",(0,e.jsx)(n.code,{children:\"posts/\"}),\"\\u76EE\\u5F55\\u4E2D\\uFF0C\\u53EF\\u4EE5\\u5229\\u7528 Next \\u7684\",(0,e.jsx)(n.a,{href:\"https://nextjs.org/docs/routing/dynamic-routes\",children:\"\\u52A8\\u6001\\u8DEF\\u7531\\uFF08Dynamic Routes\\uFF09\"}),\"\\u673A\\u5236\\u6765\\u5B9E\\u73B0\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u5E0C\\u671B\\u6700\\u7EC8\\u7684\\u8DEF\\u7531\\u7528\\u6587\\u7AE0\\u7684\\u6807\\u9898\\u6765\\u7EC4\\u6210\\uFF0C\\u5982\",(0,e.jsx)(n.code,{children:\"/post/hello-world\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"/post/my-post\"}),\"\\u7B49\\u3002\\u4E3A\\u6B64\\u6211\\u4EEC\\u5728\",(0,e.jsx)(n.code,{children:\"pages/\"}),\"\\u76EE\\u5F55\\u4E0B\\u65B0\\u5EFA\",(0,e.jsx)(n.code,{children:\"pages/post/[id].js\"}),\"\\u6587\\u4EF6\\u3002\\u5176\\u4E2D\\uFF0C\\u6587\\u4EF6\\u540D\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"[id]\"}),\"\\u8868\\u793A\\u6587\\u7AE0\\u5BF9\\u5E94 MDX \\u6587\\u4EF6\\u7684\\u6587\\u4EF6\\u540D\\uFF0C\\u5C06\\u7528\\u4E8E\\u751F\\u6210\\u52A8\\u6001\\u8DEF\\u7531\\u3002\\u5173\\u4E8E\\u52A8\\u6001\\u8DEF\\u7531\\u7684\\u8BE6\\u7EC6\\u7528\\u6CD5\\uFF0C\\u53EF\\u4EE5\\u770B Next \\u7684\",(0,e.jsx)(n.a,{href:\"https://nextjs.org/docs/routing/dynamic-routes\",children:\"\\u5B98\\u65B9\\u6587\\u6863\"}),\"\\uFF0C\\u8FD9\\u91CC\\u4E0D\\u518D\\u8D58\\u8FF0\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u7684\\u9875\\u9762\\u662F\\u9759\\u6001\\u751F\\u6210\\u7684\\uFF0C\\u5728\",(0,e.jsx)(n.code,{children:\"[id].js\"}),\"\\u6587\\u4EF6\\u4E2D\\uFF0C\\u6211\\u4EEC\\u4F7F\\u7528\",(0,e.jsx)(n.code,{children:\"getStaticPaths()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u6765\\u751F\\u6210\\u76F8\\u5E94\\u7684\\u52A8\\u6001\\u8DEF\\u7531\\u3002\\u8BE5\\u65B9\\u6CD5\\u9700\\u8981\\u8FD4\\u56DE\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"paths\"}),\"\\u6570\\u7EC4\\uFF0C\\u679A\\u4E3E\\u6240\\u6709\\u53EF\\u80FD\\u7684\\u52A8\\u6001\\u8DEF\\u7531\\uFF0C\\u5BF9\\u4E8E\\u6211\\u4EEC\\u7684\\u535A\\u5BA2\\u9879\\u76EE\\u6765\\u8BF4\\uFF0C\\u5C31\\u662F\\u8981\\u8FD4\\u56DE\\u6240\\u6709\\u6587\\u7AE0\\u7684\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7531\\u4E8E\\u6211\\u4EEC\\u53EA\\u9700\\u8981\\u8FD4\\u56DE\\u6587\\u7AE0\\u7684 id\\uFF0C\\u76F4\\u63A5\\u8C03\\u7528\\u4E0A\\u56DE\\u63D0\\u5230\\u7684\",(0,e.jsx)(n.code,{children:\"getAllPosts()\"}),\"\\u65B9\\u6CD5\\u5373\\u53EF\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=pages/post/[id].js\",children:`import { getAllPosts } from \"lib/posts\";\n\nexport async function getStaticPaths() {\n  const posts = getAllPosts();\n  return {\n    paths: posts.map((post) =\u003e ({\n      params: { id: post.id },\n    })),\n    fallback: false,\n  };\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E8C\\u6B65\\uFF1A\\u8BFB\\u53D6\\u9875\\u9762\\u6570\\u636E\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"getStaticPaths()\"}),\"\\u65B9\\u6CD5\\u8FD8\\u9700\\u8981\\u642D\\u914D\",(0,e.jsx)(n.code,{children:\"getStaticProps()\"}),\"\\u65B9\\u6CD5\\u4E00\\u8D77\\u4F7F\\u7528\\uFF0C\\u540E\\u8005\\u5C06\\u8FD4\\u56DE\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"props\"}),\"\\u5BF9\\u8C61\\uFF0C\\u5728\\u751F\\u6210\\u9759\\u6001\\u9875\\u9762\\u65F6\\uFF0C\\u4F5C\\u4E3A\\u6587\\u7AE0\\u9875\\u9762\\u7EC4\\u4EF6\\u7684\\u53C2\\u6570\\u4F7F\\u7528\\u3002\",(0,e.jsx)(n.code,{children:\"getStaticProps(context)\"}),\"\\u65B9\\u6CD5\\u63A5\\u53D7\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"context\"}),\"\\u5BF9\\u8C61\\u4F5C\\u4E3A\\u53C2\\u6570\\uFF0C\\u5176\\u4E2D\",(0,e.jsx)(n.code,{children:\"context.params\"}),\"\\u5C5E\\u6027\\u5305\\u542B\\u4E86\\u8DEF\\u7531\\u4FE1\\u606F\\uFF0C\\u5373\",(0,e.jsx)(n.code,{children:\"getStaticPaths()\"}),\"\\u65B9\\u6CD5\\u8FD4\\u56DE\\u7684\",(0,e.jsx)(n.code,{children:\"paths\"}),\"\\u6570\\u7EC4\\u4E2D\\u6BCF\\u4E00\\u4E2A\\u5BF9\\u8C61\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"params\"}),\"\\u5C5E\\u6027\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u53EF\\u80FD\\u6709\\u70B9\\u7ED5\\uFF0C\\u4E3E\\u4F8B\\u5C31\\u662F\\u5BF9\\u4E8E\",(0,e.jsx)(n.code,{children:\"[id].js\"}),\"\\u9875\\u9762\\u6765\\u8BF4\\uFF0C\",(0,e.jsx)(n.code,{children:\"context.params\"}),\"\\u5373\",(0,e.jsx)(n.code,{children:\"{id: ...}\"}),\"\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\u62FF\\u5230\\u6587\\u4EF6\\u540D\\uFF0C\\u518D\\u53BB\\u8BFB\\u53D6\\u5BF9\\u5E94\\u7684 MDX \\u6587\\u4EF6\\uFF0C\\u89E3\\u6790\\u51FA\\u6587\\u7AE0\\u7684\\u5177\\u4F53\\u5185\\u5BB9\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"mdx-bundler\"}),\"\\u7684\",(0,e.jsx)(n.code,{children:\"bundleMDX()\"}),\"\\u65B9\\u6CD5\\u6765\\u89E3\\u6790\\u8BFB\\u53D6\\u5230\\u7684 MDX \\u6587\\u4EF6\\u6570\\u636E\\uFF0C\\u8BE5\\u65B9\\u6CD5\\u4F1A\\u8FD4\\u56DE\\u89E3\\u6790\\u597D\\u7684\\u6B63\\u6587\\u5185\\u5BB9\\uFF08\",(0,e.jsx)(n.code,{children:\"code\"}),\"\\uFF09\\u548C\",(0,e.jsx)(n.code,{children:\"frontmatter\"}),\"\\u5934\\u90E8\\u6570\\u636E\\uFF0C\\u6211\\u4EEC\\u9700\\u8981\\u5C06\\u8FD9\\u4E9B\\u6570\\u636E\\u4EE5\",(0,e.jsx)(n.code,{children:\"props\"}),\"\\u5BF9\\u8C61\\u7684\\u5F62\\u5F0F\\u8FD4\\u56DE\\uFF0C\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=pages/post/[id].js\",children:`import fs from \"fs\";\nimport path from \"path\";\nimport { bundleMDX } from \"mdx-bundler\";\nimport { postsDirectory } from \"lib/posts\";\n\nexport async function getStaticProps({ params }) {\n  const filePath = path.join(postsDirectory, \\`\\${params.id}.mdx\\`);\n  const fileContent = fs.readFileSync(filePath, \"utf-8\");\n\n  const { code, frontmatter } = await bundleMDX({\n    source: fileContent,\n    // \\u63D2\\u4EF6\\uFF0C\\u540E\\u9762\\u4F1A\\u6709\\u8BB2\\u5230\n  });\n\n  return { props: { meta: frontmatter, code } };\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E09\\u6B65\\uFF1A\\u9875\\u9762\\u7EC4\\u4EF6\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6709\\u4E86\\u89E3\\u6790\\u597D\\u7684\\u6587\\u7AE0\\u6570\\u636E\\u540E\\uFF0C\\u6211\\u4EEC\\u5C31\\u53EF\\u4EE5\\u6765\\u5199\\u9875\\u9762\\u7EC4\\u4EF6\\u4E86\\u3002\\u524D\\u9762\\u63D0\\u5230\\u7684\\u6B63\\u6587\\u6570\\u636E\",(0,e.jsx)(n.code,{children:\"code\"}),\"\\uFF0C\\u5E76\\u4E0D\\u80FD\\u76F4\\u63A5\\u4F7F\\u7528\\uFF0C\\u9700\\u8981\\u7528\",(0,e.jsx)(n.code,{children:\"mdx-bundler\"}),\"\\u7684\",(0,e.jsx)(n.code,{children:\"getMDXComponent()\"}),\"\\u65B9\\u6CD5\\u518D\\u89E3\\u6790\\u4E00\\u904D\\uFF0C\\u5F97\\u5230\\u4E00\\u4E2A React \\u7EC4\\u4EF6\\uFF08\",(0,e.jsx)(n.code,{children:\"\u003cContent /\u003e\"}),\"\\uFF09\\u3002\\u4F60\\u53EF\\u4EE5\\u76F4\\u63A5\\u4F7F\\u7528\\u8BE5\\u7EC4\\u4EF6\\uFF0C\\u6216\\u8005\\u81EA\\u5DF1\\u5199\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"\u003cPostLayout /\u003e\"}),\"\\u5E03\\u5C40\\u7684\\u7EC4\\u4EF6\\u628A\\u6B63\\u6587\\u5957\\u8FDB\\u53BB\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=pages/post/[id].js\",children:`import { getMDXComponent } from \"mdx-bundler/client\";\nimport PostLayout from \"components/PostLayout\";\n\nexport default function Post({ meta, code }) {\n  const Content = getMDXComponent(code);\n  return (\n    \u003cPostLayout meta={meta}\u003e\n      \u003cContent /\u003e\n    \u003c/PostLayout\u003e\n  );\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u5C0F\\u7ED3\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5230\\u6B64\\u4E3A\\u6B62\\uFF0C\\u6211\\u4EEC\\u7684\\u6587\\u7AE0\\u9875\\u9762\\u5C31\\u5199\\u597D\\u4E86\\u3002\\u6211\\u4EEC\\u6765\\u5C0F\\u7ED3\\u4E00\\u4E0B\\u6574\\u4E2A\\u6D41\\u7A0B\\u3002\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"\\u5F53 Next \\u751F\\u6210\\u52A8\\u6001\\u8DEF\\u7531\\u9875\\u9762\\u65F6\\uFF0C\\u4F1A\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"getStaticPaths()\"}),\"\\u548C\",(0,e.jsx)(n.code,{children:\"getStaticProps()\"}),\"\\u4E24\\u4E2A\\u65B9\\u6CD5\\u3002\\u524D\\u8005\\u7528\\u4E8E\\u751F\\u6210\\u8DEF\\u7531\\uFF0C\\u540E\\u8005\\u7ED9\\u7EC4\\u4EF6\\u63D0\\u4F9B\",(0,e.jsx)(n.code,{children:\"props\"}),\"\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u5F53 Next \\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"getStaticPaths()\"}),\"\\u65B9\\u6CD5\\u65F6\\uFF0C\\u6211\\u4EEC\\u5229\\u7528\",(0,e.jsx)(n.code,{children:\"getAllPosts()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u8BFB\\u53D6\\u6587\\u7AE0\\u76EE\\u5F55\\u4E2D\\u6240\\u6709\\u7684 MDX \\u6587\\u4EF6\\u6570\\u636E\\uFF0C\\u751F\\u6210\",(0,e.jsx)(n.code,{children:\"paths\"}),\"\\u6570\\u7EC4\\u3002\\u6570\\u7EC4\\u4E2D\\u7684\\u6BCF\\u4E00\\u9879\\u5BF9\\u5E94\\u4E00\\u4E2A\\u6587\\u7AE0\\u9875\\u9762\\u7684\\u52A8\\u6001\\u8DEF\\u7531\\uFF0C\\u5373\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\uFF0C\\u5E76\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"context.params\"}),\"\\u63D0\\u4F9B\\u7ED9\",(0,e.jsx)(n.code,{children:\"getStaticProps()\"}),\"\\u65B9\\u6CD5\\u4F7F\\u7528\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"getStaticProps()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u901A\\u8FC7\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"bundleMDX()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u627E\\u5230\\u76F8\\u5E94\\u7684 MDX \\u6587\\u4EF6\\u8FDB\\u884C\\u89E3\\u6790\\uFF0C\\u8FD4\\u56DE\",(0,e.jsx)(n.code,{children:\"code\"}),\"\\u4E0E\",(0,e.jsx)(n.code,{children:\"meta\"}),\"\\u7EC4\\u6210\\u7684\",(0,e.jsx)(n.code,{children:\"props\"}),\"\\u7ED9\\u5230\",(0,e.jsx)(n.code,{children:\"\u003cPost/\u003e\"}),\"\\u7EC4\\u4EF6\\u4F7F\\u7528\\u3002\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"\u003cPost/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u901A\\u8FC7\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"getMDXComponent()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5C06\",(0,e.jsx)(n.code,{children:\"props.code\"}),\"\\u8F6C\\u5316\\u6210\",(0,e.jsx)(n.code,{children:\"\u003cContent/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u663E\\u793A\\u6587\\u7AE0\\u6B63\\u6587\\u5185\\u5BB9\\u3002\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5927\\u81F4\\u6D41\\u7A0B\\u5982\\u4E0B\\u56FE\\u6240\\u793A\\uFF1A\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/how-to-build-a-static-blog-with-nextjs-and-mdx-ii/flow.png\",alt:\"\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6B64\\u65F6\",(0,e.jsx)(n.code,{children:\"[id].js\"}),\"\\u6587\\u4EF6\\u7684\\u5B8C\\u6574\\u4EE3\\u7801\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=pages/post/[id].js\",children:`import fs from \"fs\";\nimport path from \"path\";\nimport { bundleMDX } from \"mdx-bundler\";\nimport { getMDXComponent } from \"mdx-bundler/client\";\nimport PostLayout from \"components/PostLayout\";\nimport { postsDirectory, getAllPosts } from \"lib/posts\";\n\nexport async function getStaticPaths() {\n  const posts = getAllPosts();\n  return {\n    paths: posts.map((post) =\u003e ({\n      params: { id: post.id },\n    })),\n    fallback: false,\n  };\n}\n\nexport async function getStaticProps({ params }) {\n  const filePath = path.join(postsDirectory, \\`\\${params.id}.mdx\\`);\n  const fileContent = fs.readFileSync(filePath, \"utf-8\");\n\n  const { code, frontmatter } = await bundleMDX({\n    source: fileContent,\n    // \\u63D2\\u4EF6\\uFF0C\\u540E\\u9762\\u4F1A\\u6709\\u8BB2\\u5230\n  });\n\n  return { props: { meta: frontmatter, code } };\n}\n\nexport default function Post({ meta, code }) {\n  const Content = getMDXComponent(code);\n  return (\n    \u003cPostLayout meta={meta}\u003e\n      \u003cContent /\u003e\n    \u003c/PostLayout\u003e\n  );\n}\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u4EE3\\u7801\\u9AD8\\u4EAE\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u4F5C\\u4E3A\\u4E00\\u4E2A\\u5F00\\u53D1\\u8005\\u7684\\u535A\\u5BA2\\uFF0C\\u6587\\u7AE0\\u4E2D\\u5FC5\\u5B9A\\u5C11\\u4E0D\\u4E86\\u4EE3\\u7801\\u5757\\uFF0C\\u800C\\u9ED8\\u8BA4\\u60C5\\u51B5\\u4E0B\\u4EE3\\u7801\\u5757\\u7684\\u6837\\u5F0F\\u975E\\u5E38\\u5F71\\u54CD\\u9605\\u8BFB\\uFF0C\\u5982\\u4E0B\\u56FE\\uFF1A\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/how-to-build-a-static-blog-with-nextjs-and-mdx-ii/plain-code.png\",alt:\"\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u56E0\\u6B64\\u6211\\u4EEC\\u9700\\u8981\\u628A\\u4EE3\\u7801\\u5757\\u9AD8\\u4EAE\\u5316\\u5904\\u7406\\u3002\\u53EF\\u4EE5\\u5B9E\\u73B0\\u4EE3\\u7801\\u9AD8\\u4EAE\\u7684\\u8F6E\\u5B50\\u6709\\u5F88\\u591A\\uFF0C\\u6BD4\\u8F83\\u5E38\\u7528\\u7684\\u662F \",(0,e.jsx)(n.a,{href:\"https://prismjs.com/\",children:\"Prism.js\"}),\" \\u548C \",(0,e.jsx)(n.a,{href:\"https://highlightjs.org/\",children:\"highlight.js\"}),\" \\u8FD9\\u4E24\\u4E2A\\u3002\\u6211\\u6700\\u7EC8\\u9009\\u62E9\\u7684\\u662F Prism\\uFF0C\\u7528\\u5230 \",(0,e.jsx)(n.a,{href:\"https://github.com/FormidableLabs/prism-react-renderer\",children:\"prism-react-renderer\"}),\" \\u8FD9\\u4E2A\\u5305\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u7684\\u4EE3\\u7801\\u5757\\uFF0C\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"mdx-bundler\"}),\"\\u8F6C\\u6362\\u540E\\uFF0C\\u662F\\u653E\\u5728\",(0,e.jsx)(n.code,{children:\"\u003cpre\u003e\u003c/pre\u003e\"}),\"\\u6807\\u7B7E\\u4E2D\\u7684\\u3002\\u4E3A\\u4E86\\u6539\\u53D8\\u4EE3\\u7801\\u5757\\u7684\\u6837\\u5F0F\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u81EA\\u5B9A\\u4E49\\u8F6C\\u6362\\u540E\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cpre\u003e\u003c/pre\u003e\"}),\"\\u6807\\u7B7E\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E0A\\u9762\\u8BB2\\u8FC7\\uFF0C\\u6211\\u4EEC\\u8BFB\\u53D6\\u5230\\u7684 MDX \\u6587\\u4EF6\\u662F\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"bundleMDX()\"}),\"\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u8FDB\\u884C\\u8F6C\\u6362\\u540E\\uFF0C\\u518D\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"getMDXComponent()\"}),\"\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u8F6C\\u6210 React \\u7EC4\\u4EF6\\u7684\\u3002\\u8F6C\\u6362\\u751F\\u6210\\u7684\\u7EC4\\u4EF6\\uFF08\",(0,e.jsx)(n.code,{children:\"\u003cContent/\u003e\"}),\"\\uFF09\\u6709\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"components\"}),\"\\u5C5E\\u6027\\uFF0C\\u53EF\\u4EE5\\u66FF\\u6362\\u751F\\u6210\\u7684 HTML \\u6807\\u7B7E\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E00\\u6B65\\uFF1A\\u521B\\u5EFA\\u4EE3\\u7801\\u5757\\u7EC4\\u4EF6\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u521B\\u5EFA\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"\u003cCodeBlock/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u7528\\u4E8E\\u66FF\\u6362\",(0,e.jsx)(n.code,{children:\"\u003cpre\u003e\u003c/pre\u003e\"}),\"\\u6807\\u7B7E\\u3002\\u5728\",(0,e.jsx)(n.code,{children:\"components/\"}),\"\\u76EE\\u5F55\\u4E0B\\uFF0C\\u6211\\u4EEC\\u65B0\\u5EFA\",(0,e.jsx)(n.code,{children:\"CodeBlock.jsx\"}),\"\\u6587\\u4EF6\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=components/CodeBlock.jsx\",children:`import Highlight, { defaultProps } from \"prism-react-renderer\";\n\nconst CodeBlock = ({ children }) =\u003e {\n  const { className, children: code } = children.props;\n  const language = className \u0026\u0026 className.replace(/language-/, \"\");\n  return (\n    \u003cHighlight {...defaultProps} code={code} language={language}\u003e\n      {({ className, style, tokens, getLineProps, getTokenProps }) =\u003e (\n        \u003cdiv className=\"code-block-container\"\u003e\n          \u003cpre className={className} style={style}\u003e\n            \u003cdiv className=\"code-block\"\u003e\n              {tokens.slice(0, -1).map((line, i) =\u003e (\n                \u003cspan key={i} {...getLineProps({ line, key: i })}\u003e\n                  {line.map((token, key) =\u003e (\n                    \u003cspan key={key} {...getTokenProps({ token, key })} /\u003e\n                  ))}\n                \u003c/span\u003e\n              ))}\n            \u003c/div\u003e\n          \u003c/pre\u003e\n        \u003c/div\u003e\n      )}\n    \u003c/Highlight\u003e\n  );\n};\n\nexport default CodeBlock;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u9996\\u5148\",(0,e.jsx)(n.code,{children:\"\u003cCodeBlock/\u003e\"}),\"\\u7EC4\\u4EF6\\u63A5\\u53D7\\u4E00\\u4E2A\\u540D\\u53EB\",(0,e.jsx)(n.code,{children:\"children\"}),\"\\u7684 props\\uFF0C\\u5B83\\u7684\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u5C5E\\u6027\\u662F\",(0,e.jsx)(n.code,{children:\"'code'\"}),\"\\uFF0C\\u8868\\u793A\\u8FD9\\u662F\\u4E00\\u4E2A\\u4EE3\\u7801\\u5757\\u3002\\u9664\\u6B64\\u4EE5\\u5916\",(0,e.jsx)(n.code,{children:\"children\"}),\"\\u8FD8\\u6709\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"props\"}),\"\\u5C5E\\u6027\\uFF0C\\u5305\\u542B\",(0,e.jsx)(n.code,{children:\"className\"}),\"\\u548C\\u53C8\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"children\"}),\"\\u5C5E\\u6027\\u3002\\u7ED3\\u6784\\u5927\\u81F4\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`{\n  children: {\n    type: 'code',\n    props: {\n      className: 'language-js',\n      children: 'console.log(\"hi\")'\n    }\n  }\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u4EEC\\u5728 Markdonw \\u4E2D\\u5199\\u4EE3\\u7801\\u5757\\u65F6\\uFF0C\\u53EF\\u4EE5\\u8868\\u660E\\u4EE3\\u7801\\u8BED\\u8A00\\uFF0C\\u5982\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-md\",children:'```js\\nconsole.log(\"hello\");\\n```\\n'})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5176\\u4E2D\",(0,e.jsx)(n.code,{children:\"children.props.className\"}),\"\\u5C31\\u662F\\u6839\\u636E\",(0,e.jsx)(n.code,{children:\"```\"}),\"\\u540E\\u9762\\u6240\\u586B\\u5199\\u7684\\u8BED\\u8A00\\u751F\\u6210\\u7684\\u5B57\\u7B26\\u4E32\\uFF0C\\u683C\\u5F0F\\u4E3A\",(0,e.jsx)(n.code,{children:\"'language-*'\"}),\"\\uFF0C\\u901A\\u8FC7\\u7B80\\u5355\\u7684\\u6B63\\u5219\\u5339\\u914D\\u6211\\u4EEC\\u5C31\\u80FD\\u5F97\\u5230\\u4EE3\\u7801\\u5757\\u7684\\u8BED\\u8A00\\u3002\\u800C\",(0,e.jsx)(n.code,{children:\"children.props.children\"}),\"\\u5219\\u4E3A\\u4EE3\\u7801\\u6587\\u672C\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"prism-react-renderer \\u63D0\\u4F9B\\u4E86\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"\u003cHighlight/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u7528\\u4E8E\\u9AD8\\u4EAE\\u4EE3\\u7801\\uFF0C\\u7528\\u6CD5\\u6BD4\\u8F83\\u7B80\\u5355\\uFF0C\\u5C06\\u5BF9\\u5E94\\u7684 props \\u4F20\\u5165\\u5373\\u53EF\\uFF0C\\u4E0D\\u518D\\u8D58\\u8FF0\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E8C\\u6B65\\uFF1A\\u66FF\\u6362\\u6807\\u7B7E\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u8981\\u505A\\u7684\\u5C31\\u662F\\u56DE\\u5230\",(0,e.jsx)(n.code,{children:\"\u003cPost/\u003e\"}),\"\\u7EC4\\u4EF6\\u4E2D\\uFF0C\\u5C06\",(0,e.jsx)(n.code,{children:\"CodeBlock\"}),\"\\u7EC4\\u4EF6\\u4F20\\u5165\\u66FF\\u6362\\u5373\\u53EF\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=pages/post/[id].js\",children:`import CodeBlock from \"components/CodeBlock\";\n\n// \\u4E0A\\u7565\n\nexport default function Post({ meta, code }) {\n  const Content = getMDXComponent(code);\n  return (\n    \u003cPostLayout meta={meta}\u003e\n      \u003cContent components={pre: CodeBlock} /\u003e\n    \u003c/PostLayout\u003e\n  );\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7B2C\\u4E09\\u6B65\\uFF1A\\u4FEE\\u6539\\u4E3B\\u9898\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5230\\u6B64\\uFF0C\\u6211\\u4EEC\\u7684\\u4EE3\\u7801\\u5C31\\u5DF2\\u7ECF\\u201C\\u4EAE\\u201D\\u8D77\\u6765\\u4E86\\u3002\\u9ED8\\u8BA4\\u4F7F\\u7528\\u7684\\u662F \",(0,e.jsx)(n.a,{href:\"https://github.com/FormidableLabs/prism-react-renderer/blob/master/src/themes/duotoneDark.js\",children:\"duotoneDark\"}),\" \\u4E3B\\u9898\\uFF0C\\u786E\\u5B9E\\u4E0D\\u592A\\u597D\\u770B\\uFF0C\\u6CA1\\u5173\\u7CFB\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\\u4E0B\\u9762\\u7684\\u65B9\\u6CD5\\u8FDB\\u884C\\u4FEE\\u6539\\u3002\"]}),`\n`,(0,e.jsx)(n.h4,{children:\"\\u65B9\\u6CD5\\u4E00\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u76F4\\u63A5\\u4F7F\\u7528 prism-react-renderer \\u63D0\\u4F9B\\u7684\\u4E3B\\u9898\\uFF0C\\u53EF\\u4EE5\\u5728\",(0,e.jsx)(n.code,{children:\"prism-react-renderer/themes/\"}),\"\\u76EE\\u5F55\\u4E0B\\u627E\\u5230\\u5B83\\u4EEC\\uFF0C\\u7136\\u540E\\u76F4\\u63A5\\u4FEE\\u6539\",(0,e.jsx)(n.code,{children:\"\u003cHighlight/\u003e\"}),\"\\u7EC4\\u4EF6\\u4F20\\u5165\",(0,e.jsx)(n.code,{children:\"theme\"}),\"\\u5373\\u53EF\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",children:`import dracula from \"prism-react-renderer/themes/dracula\";\n\n\u003cHighlight theme={dracula} /\u003e;\n`})}),`\n`,(0,e.jsx)(n.h4,{children:\"\\u65B9\\u6CD5\\u4E8C\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7531\\u4E8E prism-react-renderer \\u751F\\u6210\\u4EE3\\u7801\\u5757\\u7684\\u6807\\u7B7E\\u4E2D\\u90FD\\u6DFB\\u52A0\\u4E86\\u76F8\\u5E94\\u7684 class\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u76F4\\u63A5\\u4F7F\\u7528 Prism \\u7684\\u4E3B\\u9898\\u3002\\u4E3B\\u9898\\u5728\\u7F51\\u4E0A\\u641C\\u4E00\\u4E0B\\u5C31\\u80FD\\u627E\\u5230\\uFF0C\\u76F4\\u63A5\\u628A css \\u62FF\\u8FC7\\u6765\\u4F7F\\u7528\\u5373\\u53EF\\u3002\"})]})}}var b=y;return j(D);})();\n;return Component;"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"how-to-build-a-static-blog-with-nextjs-and-mdx-ii"},"buildId":"uGHNlN9iOuFLKPkuPU0G7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>