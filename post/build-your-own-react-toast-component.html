<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="description" content="Kelvin&#x27;s blog"/><link rel="icon" href="/images/favicon.ico"/><title>如何基于 Context 和 Hooks 封装一个 Toast 组件</title><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/fa516012e89e3238.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fa516012e89e3238.css" data-n-g=""/><link rel="preload" href="/_next/static/css/5efe62c786a6b4f4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5efe62c786a6b4f4.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-7c5ed703f3f21a9f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c1a59e66f922986f.js" defer=""></script><script src="/_next/static/chunks/259-40724c9c857ae4fb.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bid%5D-ccca81b68ed154e7.js" defer=""></script><script src="/_next/static/__B9SB2fFDyT1nST8Szb4/_buildManifest.js" defer=""></script><script src="/_next/static/__B9SB2fFDyT1nST8Szb4/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="container"><nav class="navbar"><div class="navbar-content"><div class="navbar-menu-container"><ul class="navbar-menu"><li><a href="/">首页</a></li><li><a href="/posts/horse-sense">秘籍</a></li><li><a href="/posts/gibberish">八股</a></li><li><a href="/posts/xray">庖丁</a></li><li><a href="/posts/copycat">画瓢</a></li></ul></div></div></nav><main class="main"><main><article class="post-container"><div class="post-title-container"><h1 class="post-title">如何基于 Context 和 Hooks 封装一个 Toast 组件</h1><p class="post-date">July 19, 2022</p></div><p><img src="/images/build-your-own-react-toast-component/toast.png" alt="toast"/></p>
<p>像上图中这种从手机底部（或顶部）弹出的消息通知，相信大家一定不陌生，甚至可能都已经觉得有点厌烦。在 Android 中，它被称作 Toast 或 Snackbar，在 iOS 以及一些桌面系统中，它叫 Notification。不管名字是什么，它们的作用都是向用户传达消息。</p>
<p>我还是喜欢 Toast 这个叫法，就像土司（Toast）烤好了从土司机弹出一样，形象生动。Toast 一般用于不是特别重要的消息，一闪而过，点到即止。它不需要像弹窗一样，强制中断用户的操作，体验上更佳。当然，如果是重要的消息，还是得打断用户，毕竟 Toast 的确比较容易忽略。在日常开发中，我们经常需要向用户展示一些非重要的消息，比如加载数据成功了，或者保存、删除成功等，都会用到 Toast 组件。下面我们来尝试，使用 Context 和 Hooks，封装一个简单的 Toast 组件。</p>
<p><img src="/images/build-your-own-react-toast-component/toaster.png" alt="toaster"/></p>
<h2>开始前的一些思考</h2>
<p>我习惯写代码之前理清一下思路，把框架梳理出来，真正到了敲键盘的时候就会顺手很多。如果你是“说干就干”型的，可以直接跳过这一部分的内容。</p>
<h3>怎样用？</h3>
<p>封装组件，目的是为了方便日后复用，提高开发效率，因此我们得从使用者的角度出发，先思考清楚“怎样用”这个问题。如果使用起来不合心意，那样封装就失去了它的意义。设计组件，就和设计接口一样，需要哪些参数（props），返回的内容是什么（样式、交互、逻辑等），怎样调用，这些想明白了，实现起来就能有的放矢。</p>
<p>我们先来确定最基础的入参（props），既然 Toast 展示的是“消息”，那它肯定需要<code>message</code>，而对于不同类型的消息，最好是能有不同的样式<code>type</code>，比如“警告红”、“成功绿”等。由于 Toast 一般都是“一闪而过”，因此也需要<code>duration</code>来控制展示的时间长短。除此之外，我们还可以定义一个<code>onHide</code>的事件，传入一个方法，在 Toast 消失时调用。这样就能够与组件自身的逻辑进行交互，便于拓展。综上，我们暂时先定义以下四个 props：</p>
<ul>
<li><code>message</code>：消息内容</li>
<li><code>type</code>：消息类型，控制显示的样式</li>
<li><code>duration</code>：持续时间，控制展示的时长</li>
<li><code>onHide</code>：消失事件</li>
</ul>
<h3>分散调用</h3>
<p>我们可以像一般的组件一样，直接以 JSX 的方式调用：</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag attr-name">message</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">message</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">type</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">type</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">duration</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript number">3000</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">onHide</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">hideHandler</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span></div></pre></div>
<p>然而这样的调用方式有个问题，就是我们需要有额外的 state 来控制它的显示。当我们在不同组件里调用时，需要在每个调用的组件里独立管理状态，显得十分麻烦。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line highlight"><span class="code-block-line-number">1</span><span class="token comment">// ComponentA 中</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">show</span><span class="token punctuation">,</span><span class="token plain"> setShow</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">props</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">show</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">show</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line highlight"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token comment">// ComponentB 中</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">7</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">show</span><span class="token punctuation">,</span><span class="token plain"> setShow</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">props</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">show</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">show</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain">
</span></span><span class="token-line highlight"><span class="code-block-line-number">11</span><span class="token plain"></span><span class="token comment">// ComponentC 中</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">12</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">show</span><span class="token punctuation">,</span><span class="token plain"> setShow</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">props</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">show</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">show</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span></div></pre></div>
<p>这样的操作除了麻烦以外，还会带来一个问题：由于我们的<code>&lt;Toast/&gt;</code>组件被分散内嵌在各个组件当中，导致很难统一处理样式，当有多个 Toast 同时出现时，很容易就会造成 Toast 间的“重叠”。</p>
<h3>统一调用</h3>
<p>既然“分散”这么麻烦，那么能不能统一在一个地方放置<code>&lt;Toast/&gt;</code>，这样状态、样式上都能很好的处理，比如，放置在一个统一的<code>&lt;ToastContainer/&gt;</code>组件中：</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token comment">// 统一的状态</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token comment">// ToastContainer 组件</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter">toasts</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain-text">    </span><span class="token punctuation">{</span><span class="token plain">toasts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">toast</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain-text">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">
</span></span><span class="token-line highlight"><span class="code-block-line-number">13</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span></div></pre></div>
<p>这样一来，当我们需要展示 Toast 时，只需要往<code>toasts</code>数组中增加一个新的<code>toast</code>即可。并且所有的 Toast 都放置在 ToastContainer 中，样式也可以自由发挥了。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token comment">// 统一的状态</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token comment">// ToastContainer 组件</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter">toasts</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain-text">    </span><span class="token punctuation">{</span><span class="token plain">toasts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">toast</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain-text">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token plain"></span><span class="token comment">// 要展示 Toast 时</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">16</span><span class="token plain"></span><span class="token function">setToasts</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> newToast</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></span></div></pre></div>
<h3>状态管理</h3>
<p>上面的方法中状态是统一了，但操作都得在同一个组件内。假如我们要在不同的组件里调用展示 Toast 的方法呢？一种方法是<a href="https://reactjs.org/docs/lifting-state-up.html">“状态提升”（Lifting state up）</a>，把状态提到更高一层，具体方法不再赘述，可以看文档了解。但是这种做法会带来<a href="https://kentcdodds.com/blog/prop-drilling">“Prop drilling”</a>的问题，我们得将<code>setToasts</code>方法传给需要调用的组件，如果组件嵌套的层级很深，就得一层层地往下“钻”，这种做法并不优雅。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token comment">// 统一的状态</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token comment">// ToastContainer 组件</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter">toasts</span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain-text">    </span><span class="token punctuation">{</span><span class="token plain">toasts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"> </span><span class="token tag spread punctuation">{</span><span class="token tag spread operator">...</span><span class="token tag spread">toast</span><span class="token tag spread punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain-text">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain"></span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token plain"></span><span class="token comment">// 把 setToasts 方法传给要调用的组件</span><span class="token plain"></span></span><span class="token-line highlight"><span class="code-block-line-number">16</span><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">AnotherComponent</span><span class="token tag"> </span><span class="token tag attr-name">onShowToast</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">setToasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span></div></pre></div>
<p>实际上我们可以利用统一的状态管理工具来解决这个问题，业界已经有无数的轮子能做到，毕竟说到造轮子，的确没有比贵圈更狂热的了。比如传统一点的 <a href="https://redux.js.org/">Redux</a>，新一点的 <a href="https://jotai.org/">Jotai</a>，官方背景的 <a href="https://recoiljs.org/">Recoil</a>，还有 <a href="https://github.com/pmndrs/zustand">Zustand</a>、<a href="https://rematchjs.org/">Rematch</a> 等。</p>
<p>上面提到的这些轮子，各有优劣，可以自行选择使用。对于我们 Toast 组件这种“小鸡”，其实没有必要上“牛刀”，用 Context 配合<code>useContext</code>就可以实现同样的效果。如果你还不了解 Context 和 Hooks，可以看看<a href="https://kentcdodds.com/blog/how-to-use-react-context-effectively">这个文档</a>，这里不再赘述。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token comment">// 包在需要调用的组件的公共外层</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastProvider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">App</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain-text">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastProvider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<h3>暴露接口</h3>
<p>我们可以自定义一个 Context Provider 组件<code>&lt;ToastProvider/&gt;</code>，将它包在需要调用的组件的公共外层，比如<code>&lt;App/&gt;</code>之外。这时我们就要考虑该将哪些东西放进 Context 里公用，就是要暴露什么样的接口出去。</p>
<p>上面的例子中我们是通过调用<code>setToasts</code>方法来增加新的 Toast，如果直接把这个方法暴露出去，调用者有可能会随意改动 state 而导致奇怪的 bug 出现。因此我们需要在<code>setToasts</code>方法外再包上一层，以限制调用者的使用，比如下面的<code>toast</code>方法：</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;删除成功。&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token number">3000</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token plain"> doSomethingOnHide</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>我们直接把所需要的参数传进去即可，省去了直接操作 state 所带来的风险。甚至我们还可以参考 Axios 的做法，把类型<code>type</code>转成方法，直接调用，省去填写<code>type</code>参数的麻烦。还可以用默认值省略一些参数，进一步简化调用：</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token plain">toast</span><span class="token punctuation">.</span><span class="token method function property-access">info</span><span class="token punctuation">(</span><span class="token string">&quot;加载成功。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">toast</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">&quot;保存失败。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">toast</span><span class="token punctuation">.</span><span class="token method function property-access">success</span><span class="token punctuation">(</span><span class="token string">&quot;抢票成功。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<h3>小结</h3>
<p>综上，我们前期确定下来的几个基本的封装要点有：</p>
<ul>
<li><code>&lt;Toast/&gt;</code>组件需要<code>message</code>、<code>type</code>、<code>duration</code>、<code>onHide</code>这几个 props</li>
<li>用统一的<code>&lt;ToastContainer/&gt;</code>来管理所有<code>&lt;Toast/&gt;</code></li>
<li>用一个数组来处理 Toast 的增删，保存相关属性</li>
<li>用 Context 管理状态</li>
<li>对外暴露<code>toast</code>及其衍生的方法</li>
</ul>
<h2>开始封装</h2>
<p>接下来我们可以正式开始封装了。这里直接略过项目的创建阶段，你可以使用自己喜欢的脚手架来创建项目，又或者在已有的项目中进行封装，这并不影响实际的封装过程。我这里把所有文件都直接放在<code>src/</code>目录下，你可以把它们放在<code>component/</code>或者<code>hooks/</code>或者其它任意目录都没问题，看个人喜好。每个文件的内容在下面会具体介绍到。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-undefined"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token plain">src/</span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">|--- ToastProvider.jsx</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">|--- Toast.jsx</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">|--- ToastContainer.jsx</span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">|--- useToast.js</span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">|--- App.jsx</span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain">|--- index.js</span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">|--- index.css</span></span></div></pre></div>
<p>我们从最外层开始，先封装一个<code>&lt;ToastProvider/&gt;</code>组件。</p>
<h3>Context Provider</h3>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createContext </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token comment">// 创建 Context</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContext</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token comment">// 套上 Provider</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">ToastProvider</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>Context 利用 Provider 提供需要“暴露”公共的内容，然后通过 Consumer 或<code>useContext</code>方法来在嵌套的组件中获得这些公共的内容。在使用的时候，我们把<code>&lt;ToastProvider/&gt;</code>组件包在外层即可，这样里面的组件（以及深层的子组件）就能获得这些内容。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/index.js</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./App&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./ToastProvider&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation">.</span><span class="token method function property-access">createRoot</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastProvider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">App</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain-text">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastProvider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain"></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>当然，这里只是搭了个框架，因为我们还没有提供要暴露的内容，所以现在在组件中还不能获取到任何东西。</p>
<h3>Toast 组件</h3>
<p>接下来我们来写真正的<code>&lt;Toast/&gt;</code>本体，它除了接受上面提到的<code>message</code>、<code>duration</code>、<code>type</code>、<code>onHide</code>这几个 props 以外，还额外增加了一个<code>id</code>，作为唯一的标识，方便我们对<code>toasts</code>数据进行删减。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/Toast.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> useEffect </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token constant">TOAST_STYLE</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">  </span><span class="token literal-property property">info</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">    </span><span class="token literal-property property">bgColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;bg-amber-100&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">    </span><span class="token literal-property property">textColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;text-amber-600&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">  </span><span class="token literal-property property">error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain">    </span><span class="token literal-property property">bgColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;bg-red-100&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain">    </span><span class="token literal-property property">textColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;text-red-600&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">  </span><span class="token literal-property property">success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain">    </span><span class="token literal-property property">bgColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;bg-green-100&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token plain">    </span><span class="token literal-property property">textColor</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;text-green-600&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">16</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">17</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">18</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">Toast</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> id</span><span class="token parameter punctuation">,</span><span class="token parameter"> message</span><span class="token parameter punctuation">,</span><span class="token parameter"> duration</span><span class="token parameter punctuation">,</span><span class="token parameter"> type</span><span class="token parameter punctuation">,</span><span class="token parameter"> onHide </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">19</span><span class="token plain">  </span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">20</span><span class="token plain">    </span><span class="token comment">// duration 控制显示的时长，到期消失时调用 onHide 并传入 id</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">21</span><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> timer </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">onHide</span><span class="token punctuation">(</span><span class="token plain">id</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"> duration</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">22</span><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">clearTimeout</span><span class="token punctuation">(</span><span class="token plain">timer</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">23</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">24</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">25</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">26</span><span class="token tag">      </span><span class="token tag attr-name">className</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">px-8 py-4 mb-4 last:mb-0 rounded-md shadow-sm </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation constant">TOAST_STYLE</span><span class="token tag script language-javascript template-string interpolation punctuation">[</span><span class="token tag script language-javascript template-string interpolation">type</span><span class="token tag script language-javascript template-string interpolation punctuation">]</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">bgColor</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string string"> </span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">${</span><span class="token tag script language-javascript template-string interpolation constant">TOAST_STYLE</span><span class="token tag script language-javascript template-string interpolation punctuation">[</span><span class="token tag script language-javascript template-string interpolation">type</span><span class="token tag script language-javascript template-string interpolation punctuation">]</span><span class="token tag script language-javascript template-string interpolation punctuation">.</span><span class="token tag script language-javascript template-string interpolation property-access">textColor</span><span class="token tag script language-javascript template-string interpolation interpolation-punctuation punctuation">}</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">27</span><span class="token tag">    </span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">28</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">message</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">29</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">30</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">31</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">32</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">33</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">Toast</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>组件的逻辑比较简单，<code>message</code>展示消息的内容，你可以用你喜欢的 HTML 结构展示。我这里用了最简单的 div 配合 <a href="https://tailwindcss.com/">Tailwind CSS</a>，通过<code>type</code>来区分不同类型，设置不同的样式。</p>
<p>由于 Toast 展示一小段时间后便会自动消失，我们利用<code>useEffect</code>在组件初始化时设置一个定时器，由<code>duration</code>控制展示的时长，到期消失时，调用<code>onHide</code>方法，并传入<code>id</code>，控制 Toast 隐藏（隐藏的逻辑在后面）。</p>
<h3>ToastContainer</h3>
<p>当同时有多个 Toast 一起展示的时候，虽然这种情况比较少，但也是要考虑进来，最好还是能够在一个“容器”里统一处理，避免样式上重叠。我们新建一个<code>&lt;ToastContainer/&gt;</code>组件，本质上就是一个列表，这里用 flex 简单布局一下，或者你喜欢的其它布局样式。组件接受两个 props：<code>toasts</code>中存放所有 Toast 数据，<code>onHide</code>则在消失时调用。这里又用到了“prop drilling”，因为移除 Toast 的方法（后面会讲到），我不希望它被暴露到 Context 中，只好一层层传进来。</p>
<p>当然，如果你希望能够“手动”控制 Toast 的显示，也可以把移除的方法也一并暴露出去，这里为了保持简单暂且不这样做。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastContainer.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Toast</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./Toast&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> toasts</span><span class="token parameter punctuation">,</span><span class="token parameter"> onHide </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">fixed top-0 right-0 p-8 flex flex-col items-end</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">toasts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token punctuation">,</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">,</span><span class="token plain"> duration </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> toast</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain">          </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag"> </span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">id</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain-text">            </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token tag">              </span><span class="token tag attr-name">id</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">id</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token tag">              </span><span class="token tag attr-name">message</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">message</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token tag">              </span><span class="token tag attr-name">duration</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">duration</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token tag">              </span><span class="token tag attr-name">type</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">type</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token tag">              </span><span class="token tag attr-name">onHide</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">onHide</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">16</span><span class="token tag">            </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">17</span><span class="token plain-text">          </span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">18</span><span class="token plain">        </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">19</span><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">20</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">21</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">22</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">23</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">24</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContainer</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>我们还可以给 Toast 的进出加上动画，这里推荐<code>react-transition-group</code>这个包。它十分小巧，严格意义上来讲，它并不是一个动画库，它只是提供了一些能够方便实现动画需求的“钩子”。它的用法也比较简单，这里用到了<code>&lt;TransitionGroup/&gt;</code>和<code>&lt;CSSTransition/&gt;</code>两个组件，再配合简单的 CSS，就能实现进出的动画效果。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastContainer.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">Toast</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./Toast&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">TransitionGroup</span><span class="token imports punctuation">,</span><span class="token imports"> </span><span class="token imports maybe-class-name">CSSTransition</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react-transition-group&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastContainer</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> toasts</span><span class="token parameter punctuation">,</span><span class="token parameter"> onHide </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">ul</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">fixed top-0 right-0 p-8 flex flex-col items-end</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">TransitionGroup</span><span class="token tag"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token tag">      </span><span class="token tag attr-name">component</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">ul</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token tag">      </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">fixed top-0 right-0 p-8 flex flex-col items-end</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token tag">    </span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">toasts</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">        </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> id</span><span class="token punctuation">,</span><span class="token plain"> type</span><span class="token punctuation">,</span><span class="token plain"> message</span><span class="token punctuation">,</span><span class="token plain"> duration </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> toast</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain">          </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag"> </span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">id</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">          </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">CSSTransition</span><span class="token tag"> </span><span class="token tag attr-name">key</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">id</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">timeout</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript number">300</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">classNames</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">toast</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">16</span><span class="token plain-text">            </span><span class="token tag punctuation">&lt;</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">17</span><span class="token plain-text">              </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Toast</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">18</span><span class="token tag">                </span><span class="token tag attr-name">id</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">id</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">19</span><span class="token tag">                </span><span class="token tag attr-name">message</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">message</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">20</span><span class="token tag">                </span><span class="token tag attr-name">duration</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">duration</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">21</span><span class="token tag">                </span><span class="token tag attr-name">type</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">type</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">22</span><span class="token tag">                </span><span class="token tag attr-name">onHide</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">onHide</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></span><span class="token-line"><span class="code-block-line-number">23</span><span class="token tag">              </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">24</span><span class="token plain-text">            </span><span class="token tag punctuation">&lt;/</span><span class="token tag">li</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">          </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">CSSTransition</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">26</span><span class="token plain-text">        );</span></span><span class="token-line"><span class="code-block-line-number">27</span><span class="token plain-text">      })}</span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">TransitionGroup</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">ul</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">30</span><span class="token plain-text">  );</span></span><span class="token-line"><span class="code-block-line-number">31</span><span class="token plain-text">};</span></span><span class="token-line"><span class="code-block-line-number">32</span><span class="token plain-text">
</span></span><span class="token-line"><span class="code-block-line-number">33</span><span class="token plain-text">export default ToastContainer;</span></span></div></pre></div>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/index.css</div><pre class="prism-code language-css"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token selector class">.toast-enter</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">  </span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token selector class">.toast-enter-active</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">  </span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">  </span><span class="token property">transition</span><span class="token punctuation">:</span><span class="token plain"> all </span><span class="token number">300</span><span class="token unit">ms</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain"></span><span class="token selector class">.toast-exit</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain">  </span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">13</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">14</span><span class="token plain"></span><span class="token selector class">.toast-exit-active</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token plain">  </span><span class="token property">opacity</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">16</span><span class="token plain">  </span><span class="token property">transform</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">translateX</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">17</span><span class="token plain">  </span><span class="token property">transition</span><span class="token punctuation">:</span><span class="token plain"> all </span><span class="token number">300</span><span class="token unit">ms</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">18</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></span></div></pre></div>
<h3>状态管理</h3>
<p>处理完<code>&lt;Toast/&gt;</code>和<code>&lt;ToastContainer/&gt;</code>之后，我们回到<code>&lt;ToastProvider/&gt;</code>来，继续完善它状态管理部分的逻辑。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line del"><span class="code-block-line-number">-</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createContext </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createContext</span><span class="token imports punctuation">,</span><span class="token imports"> useState </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token comment">// 创建 Context</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContext</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain"></span><span class="token comment">// 套上 Provider</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain">
</span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">18</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">19</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">20</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">ToastProvider</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>我们首先增加一个<code>toasts</code>的状态，它是一个数组。我们将它传给<code>&lt;ToastContainer/&gt;</code>，同时将<code>&lt;ToastContainer/&gt;</code>嵌在<code>&lt;ToastContext.Provider/&gt;</code>里。你可能注意到了，此时的<code>&lt;ToastContainer/&gt;</code>还缺少一个<code>onHide</code>的参数，不用急，我们先实现新增 Toast 的方法。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> createContext</span><span class="token imports punctuation">,</span><span class="token imports"> useState </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token comment">// 创建 Context</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContext</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token comment">// 唯一 id</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain"></span><span class="token keyword">let</span><span class="token plain"> toastCount </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">8</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">9</span><span class="token plain"></span><span class="token comment">// 套上 Provider</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">10</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">11</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">12</span><span class="token plain">
</span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">addToast</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token parameter punctuation">,</span><span class="token parameter"> duration</span><span class="token parameter punctuation">,</span><span class="token parameter"> onHideHandler</span><span class="token parameter punctuation">,</span><span class="token parameter"> type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> toast </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      </span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token operator">++</span><span class="token plain">toastCount</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      message</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      duration</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      onHideHandler</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      type</span><span class="token punctuation">,</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token function">setToasts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toasts</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token spread operator">...</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> toast</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">23</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">24</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">25</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">26</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">27</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">28</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">29</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">30</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">31</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">32</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">ToastProvider</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>在组件内，我们增加一个<code>addToast</code>方法，顾名思义这个方法是用来增加 Toast 的。它的逻辑非常简单，把所有<code>&lt;Toast/&gt;</code>组件需要的参数打包成一个<code>toast</code>对象，添加到数组中去。其中<code>id</code>属性我们用一个简单的全局变量来实现，每新增一个 Toast 则对其进行递增处理，保证所有<code>id</code>的唯一性。当然你也可以用<code>uuid</code>去实现。另外<code>onHideHandler</code>是一个回调函数，它将在 Toast 被移除时调用，下面会讲到它的调用时机。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">  </span><span class="token comment">// 其余部分略</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">removeToast</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token function">setToasts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toasts</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      toasts</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">toast</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">        </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">toast</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> id</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">          </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> toast</span><span class="token punctuation">.</span><span class="token property-access">onHideHandler</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">            toast</span><span class="token punctuation">.</span><span class="token method function property-access">onHideHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">          </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">          </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">        </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">19</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">20</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">21</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">22</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">onHide</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">removeToast</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">25</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">26</span><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">27</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>接下来我们实现移除 Toast 的方法<code>removeToast</code>，它接受参数<code>id</code>，然后将对应的<code>toast</code>从数组中移除，在移除的过程中，调用<code>toast.onHideHandler</code>方法。我们把这个方法传给<code>&lt;ToastContainer/&gt;</code>组件，这样一来，当<code>&lt;Toast/&gt;</code>中的定时器到期时，就会触发其<code>onHide</code>方法，也即<code>&lt;ToastContainer/&gt;</code>中的<code>onHide</code>方法，实际上就是调用了<code>removeToast</code>方法（真的有点绕……）。</p>
<h3>对外的“接口”</h3>
<p>搞了这么久，实际上此时我们的 Context 还只是个空壳，里面啥也没有，因为我们还没有给它传过任何的<code>value</code>。我们可以直接把<code>addToast</code>方法放到 Context 里公开，但我希望调用的方式更加“灵活”一些。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token comment">// 单个参数</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;设置成功。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token comment">// 两个参数</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;设置成功。&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> doSomethingOnHide</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain"></span><span class="token comment">// config 对象</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">&quot;设置成功。&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">3000</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>比如我们可以只传一个<code>message</code>参数，以及把<code>duration</code>包进一个<code>config</code>对象中，方便后续增加更多的配置项。因此我们在<code>addToast</code>外再包多一层方法，用于处理这些参数的问题。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ToastProvider</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">toasts</span><span class="token punctuation">,</span><span class="token plain"> setToasts</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">  </span><span class="token comment">// 其余部分略</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> toast </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">,</span><span class="token plain"> config </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> onHideHandler</span><span class="token punctuation">,</span><span class="token plain"> type </span><span class="token operator">=</span><span class="token plain"> </span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">message</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token keyword control-flow">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token plain"> config </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      onHideHandler </span><span class="token operator">=</span><span class="token plain"> config</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      config </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> duration </span><span class="token operator">=</span><span class="token plain"> config</span><span class="token punctuation">.</span><span class="token property-access">duration</span><span class="token plain"> </span><span class="token operator">||</span><span class="token plain"> </span><span class="token number">3000</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token function">addToast</span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">,</span><span class="token plain"> duration</span><span class="token punctuation">,</span><span class="token plain"> onHideHandler</span><span class="token punctuation">,</span><span class="token plain"> type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">15</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">16</span><span class="token plain">  </span><span class="token comment">// toast.xxx 的调用方式</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">[</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    toast</span><span class="token punctuation">[</span><span class="token plain">type</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token parameter punctuation">,</span><span class="token parameter"> config</span><span class="token parameter punctuation">,</span><span class="token parameter"> onHideHandler</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">      </span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token plain">message</span><span class="token punctuation">,</span><span class="token plain"> config</span><span class="token punctuation">,</span><span class="token plain"> onHideHandler</span><span class="token punctuation">,</span><span class="token plain"> type</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">22</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">23</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line del"><span class="code-block-line-number">-</span><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag"> </span><span class="token tag attr-name">value</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> toast </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">26</span><span class="token plain-text">      </span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">27</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">28</span><span class="token plain-text">      </span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">ToastContainer</span><span class="token tag"> </span><span class="token tag attr-name">toasts</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">toasts</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">onHide</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">removeToast</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">29</span><span class="token plain-text">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">ToastContext.Provider</span><span class="token tag punctuation">&gt;</span><span class="token plain-text"></span></span><span class="token-line"><span class="code-block-line-number">30</span><span class="token plain-text">  );</span></span><span class="token-line"><span class="code-block-line-number">31</span><span class="token plain-text">};</span></span></div></pre></div>
<p>这里我们只对外暴露一个<code>toast</code>方法，它有多种调用方式。方法内部对传进来的参数进行了简单的校验，再转交给<code>addToast</code>处理。由于 JS 中函数也是对象，因此我们在<code>toast</code>对象上添加了<code>toast.info</code>、<code>toast.error</code>、<code>toast.success</code>这几个方法，便于调用。</p>
<p>最后的最后，我们还需要封上最后的一层方法。我们把<code>ToastProvider</code>中的<code>ToastContext</code>导出，再引入封装成<code>useToast</code>方法，这样我们就不需要在每次需要使用的时候自己手动去<code>useContext(ToastContext)</code>了。</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/ToastProvider.jsx</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line del"><span class="code-block-line-number">-</span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContext</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line add"><span class="code-block-line-number">+</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token maybe-class-name">ToastContext</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>src/useToast.js</div><pre class="prism-code language-js"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> useContext </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports punctuation">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">ToastContext</span><span class="token imports"> </span><span class="token imports punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./ToastProvider&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">useToast</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">useContext</span><span class="token punctuation">(</span><span class="token maybe-class-name">ToastContext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> useToast</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>最终的效果就是，当我们需要在某个组件中展示 Toast 的时候，我们直接调用<code>toast</code>方法即可：</p>
<div class="code-block-container"><div class="code-block-head"><ul class="code-block-buttons"><li class="code-block-button red"></li><li class="code-block-button yellow"></li><li class="code-block-button green"></li></ul>code</div><pre class="prism-code language-jsx"><div class="code-block"><span class="token-line"><span class="code-block-line-number">1</span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token imports">useToast</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&quot;./useToast&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">2</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">3</span><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">ComponentA</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">4</span><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> toast </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useToast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">5</span><span class="token plain">
</span></span><span class="token-line"><span class="code-block-line-number">6</span><span class="token plain">  </span><span class="token keyword control-flow">return</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript arrow operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">toast</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">&quot;封装完成！&quot;</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain-text">点击</span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="code-block-line-number">7</span><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span></div></pre></div>
<p>至此，我们的 Toast 组件就已经封装好了。当然，这只是简单的封装，如果想要“发个包”的话，还需要完善一些边界条件的处理，以及补充单元测试及撰写一份详细的文档等。有时间再做吧，溜了。</p>
<h2>参考资料</h2>
<ul>
<li><a href="https://reactjs.org/docs/lifting-state-up.html">状态提升（Lifting state up）</a></li>
<li><a href="https://kentcdodds.com/blog/prop-drilling">“Prop drilling”</a></li>
<li><a href="https://kentcdodds.com/blog/how-to-use-react-context-effectively">How to use React Context effectively</a></li>
</ul></article></main></main><footer><div>Build with ♥ @GZ</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"meta":{"title":"如何基于 Context 和 Hooks 封装一个 Toast 组件","date":"July 19, 2022","desc":"Toast 一般用于不是特别重要的消息，一闪而过，点到即止。它不需要像弹窗一样，强制中断用户的操作，体验上更佳。当然，如果是重要的消息，还是得打断用户，毕竟 Toast 的确比较容易忽略。在日常开发中，我们经常需要向用户展示一些非重要的消息，比如加载数据成功了，或者保存、删除成功等，都会用到 Toast 组件。下面我们来尝试，使用 Context 和 Hooks，封装一个简单的 Toast 组件。","type":"horse-sense"},"code":"var Component=(()=\u003e{var h=Object.create;var r=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var g=(t,n)=\u003e()=\u003e(n||t((n={exports:{}}).exports,n),n.exports),x=(t,n)=\u003e{for(var o in n)r(t,o,{get:n[o],enumerable:!0})},d=(t,n,o,a)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let s of T(n))!m.call(t,s)\u0026\u0026s!==o\u0026\u0026r(t,s,{get:()=\u003en[s],enumerable:!(a=p(n,s))||a.enumerable});return t};var C=(t,n,o)=\u003e(o=t!=null?h(u(t)):{},d(n||!t||!t.__esModule?r(o,\"default\",{value:t,enumerable:!0}):o,t)),f=t=\u003ed(r({},\"__esModule\",{value:!0}),t);var c=g((S,i)=\u003e{i.exports=_jsx_runtime});var P={};x(P,{default:()=\u003ej,frontmatter:()=\u003ev});var e=C(c()),v={title:\"\\u5982\\u4F55\\u57FA\\u4E8E Context \\u548C Hooks \\u5C01\\u88C5\\u4E00\\u4E2A Toast \\u7EC4\\u4EF6\",date:\"July 19, 2022\",desc:\"Toast \\u4E00\\u822C\\u7528\\u4E8E\\u4E0D\\u662F\\u7279\\u522B\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u4E00\\u95EA\\u800C\\u8FC7\\uFF0C\\u70B9\\u5230\\u5373\\u6B62\\u3002\\u5B83\\u4E0D\\u9700\\u8981\\u50CF\\u5F39\\u7A97\\u4E00\\u6837\\uFF0C\\u5F3A\\u5236\\u4E2D\\u65AD\\u7528\\u6237\\u7684\\u64CD\\u4F5C\\uFF0C\\u4F53\\u9A8C\\u4E0A\\u66F4\\u4F73\\u3002\\u5F53\\u7136\\uFF0C\\u5982\\u679C\\u662F\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u8FD8\\u662F\\u5F97\\u6253\\u65AD\\u7528\\u6237\\uFF0C\\u6BD5\\u7ADF Toast \\u7684\\u786E\\u6BD4\\u8F83\\u5BB9\\u6613\\u5FFD\\u7565\\u3002\\u5728\\u65E5\\u5E38\\u5F00\\u53D1\\u4E2D\\uFF0C\\u6211\\u4EEC\\u7ECF\\u5E38\\u9700\\u8981\\u5411\\u7528\\u6237\\u5C55\\u793A\\u4E00\\u4E9B\\u975E\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u6BD4\\u5982\\u52A0\\u8F7D\\u6570\\u636E\\u6210\\u529F\\u4E86\\uFF0C\\u6216\\u8005\\u4FDD\\u5B58\\u3001\\u5220\\u9664\\u6210\\u529F\\u7B49\\uFF0C\\u90FD\\u4F1A\\u7528\\u5230 Toast \\u7EC4\\u4EF6\\u3002\\u4E0B\\u9762\\u6211\\u4EEC\\u6765\\u5C1D\\u8BD5\\uFF0C\\u4F7F\\u7528 Context \\u548C Hooks\\uFF0C\\u5C01\\u88C5\\u4E00\\u4E2A\\u7B80\\u5355\\u7684 Toast \\u7EC4\\u4EF6\\u3002\",type:\"horse-sense\"};function l(t){let n=Object.assign({p:\"p\",img:\"img\",h2:\"h2\",h3:\"h3\",code:\"code\",ul:\"ul\",li:\"li\",pre:\"pre\",a:\"a\"},t.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/build-your-own-react-toast-component/toast.png\",alt:\"toast\"})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u50CF\\u4E0A\\u56FE\\u4E2D\\u8FD9\\u79CD\\u4ECE\\u624B\\u673A\\u5E95\\u90E8\\uFF08\\u6216\\u9876\\u90E8\\uFF09\\u5F39\\u51FA\\u7684\\u6D88\\u606F\\u901A\\u77E5\\uFF0C\\u76F8\\u4FE1\\u5927\\u5BB6\\u4E00\\u5B9A\\u4E0D\\u964C\\u751F\\uFF0C\\u751A\\u81F3\\u53EF\\u80FD\\u90FD\\u5DF2\\u7ECF\\u89C9\\u5F97\\u6709\\u70B9\\u538C\\u70E6\\u3002\\u5728 Android \\u4E2D\\uFF0C\\u5B83\\u88AB\\u79F0\\u4F5C Toast \\u6216 Snackbar\\uFF0C\\u5728 iOS \\u4EE5\\u53CA\\u4E00\\u4E9B\\u684C\\u9762\\u7CFB\\u7EDF\\u4E2D\\uFF0C\\u5B83\\u53EB Notification\\u3002\\u4E0D\\u7BA1\\u540D\\u5B57\\u662F\\u4EC0\\u4E48\\uFF0C\\u5B83\\u4EEC\\u7684\\u4F5C\\u7528\\u90FD\\u662F\\u5411\\u7528\\u6237\\u4F20\\u8FBE\\u6D88\\u606F\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u8FD8\\u662F\\u559C\\u6B22 Toast \\u8FD9\\u4E2A\\u53EB\\u6CD5\\uFF0C\\u5C31\\u50CF\\u571F\\u53F8\\uFF08Toast\\uFF09\\u70E4\\u597D\\u4E86\\u4ECE\\u571F\\u53F8\\u673A\\u5F39\\u51FA\\u4E00\\u6837\\uFF0C\\u5F62\\u8C61\\u751F\\u52A8\\u3002Toast \\u4E00\\u822C\\u7528\\u4E8E\\u4E0D\\u662F\\u7279\\u522B\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u4E00\\u95EA\\u800C\\u8FC7\\uFF0C\\u70B9\\u5230\\u5373\\u6B62\\u3002\\u5B83\\u4E0D\\u9700\\u8981\\u50CF\\u5F39\\u7A97\\u4E00\\u6837\\uFF0C\\u5F3A\\u5236\\u4E2D\\u65AD\\u7528\\u6237\\u7684\\u64CD\\u4F5C\\uFF0C\\u4F53\\u9A8C\\u4E0A\\u66F4\\u4F73\\u3002\\u5F53\\u7136\\uFF0C\\u5982\\u679C\\u662F\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u8FD8\\u662F\\u5F97\\u6253\\u65AD\\u7528\\u6237\\uFF0C\\u6BD5\\u7ADF Toast \\u7684\\u786E\\u6BD4\\u8F83\\u5BB9\\u6613\\u5FFD\\u7565\\u3002\\u5728\\u65E5\\u5E38\\u5F00\\u53D1\\u4E2D\\uFF0C\\u6211\\u4EEC\\u7ECF\\u5E38\\u9700\\u8981\\u5411\\u7528\\u6237\\u5C55\\u793A\\u4E00\\u4E9B\\u975E\\u91CD\\u8981\\u7684\\u6D88\\u606F\\uFF0C\\u6BD4\\u5982\\u52A0\\u8F7D\\u6570\\u636E\\u6210\\u529F\\u4E86\\uFF0C\\u6216\\u8005\\u4FDD\\u5B58\\u3001\\u5220\\u9664\\u6210\\u529F\\u7B49\\uFF0C\\u90FD\\u4F1A\\u7528\\u5230 Toast \\u7EC4\\u4EF6\\u3002\\u4E0B\\u9762\\u6211\\u4EEC\\u6765\\u5C1D\\u8BD5\\uFF0C\\u4F7F\\u7528 Context \\u548C Hooks\\uFF0C\\u5C01\\u88C5\\u4E00\\u4E2A\\u7B80\\u5355\\u7684 Toast \\u7EC4\\u4EF6\\u3002\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/build-your-own-react-toast-component/toaster.png\",alt:\"toaster\"})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u5F00\\u59CB\\u524D\\u7684\\u4E00\\u4E9B\\u601D\\u8003\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u4E60\\u60EF\\u5199\\u4EE3\\u7801\\u4E4B\\u524D\\u7406\\u6E05\\u4E00\\u4E0B\\u601D\\u8DEF\\uFF0C\\u628A\\u6846\\u67B6\\u68B3\\u7406\\u51FA\\u6765\\uFF0C\\u771F\\u6B63\\u5230\\u4E86\\u6572\\u952E\\u76D8\\u7684\\u65F6\\u5019\\u5C31\\u4F1A\\u987A\\u624B\\u5F88\\u591A\\u3002\\u5982\\u679C\\u4F60\\u662F\\u201C\\u8BF4\\u5E72\\u5C31\\u5E72\\u201D\\u578B\\u7684\\uFF0C\\u53EF\\u4EE5\\u76F4\\u63A5\\u8DF3\\u8FC7\\u8FD9\\u4E00\\u90E8\\u5206\\u7684\\u5185\\u5BB9\\u3002\"}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u600E\\u6837\\u7528\\uFF1F\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5C01\\u88C5\\u7EC4\\u4EF6\\uFF0C\\u76EE\\u7684\\u662F\\u4E3A\\u4E86\\u65B9\\u4FBF\\u65E5\\u540E\\u590D\\u7528\\uFF0C\\u63D0\\u9AD8\\u5F00\\u53D1\\u6548\\u7387\\uFF0C\\u56E0\\u6B64\\u6211\\u4EEC\\u5F97\\u4ECE\\u4F7F\\u7528\\u8005\\u7684\\u89D2\\u5EA6\\u51FA\\u53D1\\uFF0C\\u5148\\u601D\\u8003\\u6E05\\u695A\\u201C\\u600E\\u6837\\u7528\\u201D\\u8FD9\\u4E2A\\u95EE\\u9898\\u3002\\u5982\\u679C\\u4F7F\\u7528\\u8D77\\u6765\\u4E0D\\u5408\\u5FC3\\u610F\\uFF0C\\u90A3\\u6837\\u5C01\\u88C5\\u5C31\\u5931\\u53BB\\u4E86\\u5B83\\u7684\\u610F\\u4E49\\u3002\\u8BBE\\u8BA1\\u7EC4\\u4EF6\\uFF0C\\u5C31\\u548C\\u8BBE\\u8BA1\\u63A5\\u53E3\\u4E00\\u6837\\uFF0C\\u9700\\u8981\\u54EA\\u4E9B\\u53C2\\u6570\\uFF08props\\uFF09\\uFF0C\\u8FD4\\u56DE\\u7684\\u5185\\u5BB9\\u662F\\u4EC0\\u4E48\\uFF08\\u6837\\u5F0F\\u3001\\u4EA4\\u4E92\\u3001\\u903B\\u8F91\\u7B49\\uFF09\\uFF0C\\u600E\\u6837\\u8C03\\u7528\\uFF0C\\u8FD9\\u4E9B\\u60F3\\u660E\\u767D\\u4E86\\uFF0C\\u5B9E\\u73B0\\u8D77\\u6765\\u5C31\\u80FD\\u6709\\u7684\\u653E\\u77E2\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u5148\\u6765\\u786E\\u5B9A\\u6700\\u57FA\\u7840\\u7684\\u5165\\u53C2\\uFF08props\\uFF09\\uFF0C\\u65E2\\u7136 Toast \\u5C55\\u793A\\u7684\\u662F\\u201C\\u6D88\\u606F\\u201D\\uFF0C\\u90A3\\u5B83\\u80AF\\u5B9A\\u9700\\u8981\",(0,e.jsx)(n.code,{children:\"message\"}),\"\\uFF0C\\u800C\\u5BF9\\u4E8E\\u4E0D\\u540C\\u7C7B\\u578B\\u7684\\u6D88\\u606F\\uFF0C\\u6700\\u597D\\u662F\\u80FD\\u6709\\u4E0D\\u540C\\u7684\\u6837\\u5F0F\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\uFF0C\\u6BD4\\u5982\\u201C\\u8B66\\u544A\\u7EA2\\u201D\\u3001\\u201C\\u6210\\u529F\\u7EFF\\u201D\\u7B49\\u3002\\u7531\\u4E8E Toast \\u4E00\\u822C\\u90FD\\u662F\\u201C\\u4E00\\u95EA\\u800C\\u8FC7\\u201D\\uFF0C\\u56E0\\u6B64\\u4E5F\\u9700\\u8981\",(0,e.jsx)(n.code,{children:\"duration\"}),\"\\u6765\\u63A7\\u5236\\u5C55\\u793A\\u7684\\u65F6\\u95F4\\u957F\\u77ED\\u3002\\u9664\\u6B64\\u4E4B\\u5916\\uFF0C\\u6211\\u4EEC\\u8FD8\\u53EF\\u4EE5\\u5B9A\\u4E49\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u7684\\u4E8B\\u4EF6\\uFF0C\\u4F20\\u5165\\u4E00\\u4E2A\\u65B9\\u6CD5\\uFF0C\\u5728 Toast \\u6D88\\u5931\\u65F6\\u8C03\\u7528\\u3002\\u8FD9\\u6837\\u5C31\\u80FD\\u591F\\u4E0E\\u7EC4\\u4EF6\\u81EA\\u8EAB\\u7684\\u903B\\u8F91\\u8FDB\\u884C\\u4EA4\\u4E92\\uFF0C\\u4FBF\\u4E8E\\u62D3\\u5C55\\u3002\\u7EFC\\u4E0A\\uFF0C\\u6211\\u4EEC\\u6682\\u65F6\\u5148\\u5B9A\\u4E49\\u4EE5\\u4E0B\\u56DB\\u4E2A props\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"message\"}),\"\\uFF1A\\u6D88\\u606F\\u5185\\u5BB9\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"type\"}),\"\\uFF1A\\u6D88\\u606F\\u7C7B\\u578B\\uFF0C\\u63A7\\u5236\\u663E\\u793A\\u7684\\u6837\\u5F0F\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"duration\"}),\"\\uFF1A\\u6301\\u7EED\\u65F6\\u95F4\\uFF0C\\u63A7\\u5236\\u5C55\\u793A\\u7684\\u65F6\\u957F\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\uFF1A\\u6D88\\u5931\\u4E8B\\u4EF6\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u5206\\u6563\\u8C03\\u7528\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u50CF\\u4E00\\u822C\\u7684\\u7EC4\\u4EF6\\u4E00\\u6837\\uFF0C\\u76F4\\u63A5\\u4EE5 JSX \\u7684\\u65B9\\u5F0F\\u8C03\\u7528\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",children:`\u003cToast message={message} type={type} duration={3000} onHide={hideHandler} /\u003e\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7136\\u800C\\u8FD9\\u6837\\u7684\\u8C03\\u7528\\u65B9\\u5F0F\\u6709\\u4E2A\\u95EE\\u9898\\uFF0C\\u5C31\\u662F\\u6211\\u4EEC\\u9700\\u8981\\u6709\\u989D\\u5916\\u7684 state \\u6765\\u63A7\\u5236\\u5B83\\u7684\\u663E\\u793A\\u3002\\u5F53\\u6211\\u4EEC\\u5728\\u4E0D\\u540C\\u7EC4\\u4EF6\\u91CC\\u8C03\\u7528\\u65F6\\uFF0C\\u9700\\u8981\\u5728\\u6BCF\\u4E2A\\u8C03\\u7528\\u7684\\u7EC4\\u4EF6\\u91CC\\u72EC\\u7ACB\\u7BA1\\u7406\\u72B6\\u6001\\uFF0C\\u663E\\u5F97\\u5341\\u5206\\u9EBB\\u70E6\\u3002\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"hl=1-2,6-7,11-12\",children:`// ComponentA \\u4E2D\nconst [show, setShow] = useState(false)\n\n\u003cToast {...props} show={show} /\u003e\n\n// ComponentB \\u4E2D\nconst [show, setShow] = useState(false)\n\n\u003cToast {...props} show={show} /\u003e\n\n// ComponentC \\u4E2D\nconst [show, setShow] = useState(false)\n\n\u003cToast {...props} show={show} /\u003e\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8FD9\\u6837\\u7684\\u64CD\\u4F5C\\u9664\\u4E86\\u9EBB\\u70E6\\u4EE5\\u5916\\uFF0C\\u8FD8\\u4F1A\\u5E26\\u6765\\u4E00\\u4E2A\\u95EE\\u9898\\uFF1A\\u7531\\u4E8E\\u6211\\u4EEC\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u7EC4\\u4EF6\\u88AB\\u5206\\u6563\\u5185\\u5D4C\\u5728\\u5404\\u4E2A\\u7EC4\\u4EF6\\u5F53\\u4E2D\\uFF0C\\u5BFC\\u81F4\\u5F88\\u96BE\\u7EDF\\u4E00\\u5904\\u7406\\u6837\\u5F0F\\uFF0C\\u5F53\\u6709\\u591A\\u4E2A Toast \\u540C\\u65F6\\u51FA\\u73B0\\u65F6\\uFF0C\\u5F88\\u5BB9\\u6613\\u5C31\\u4F1A\\u9020\\u6210 Toast \\u95F4\\u7684\\u201C\\u91CD\\u53E0\\u201D\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u7EDF\\u4E00\\u8C03\\u7528\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u65E2\\u7136\\u201C\\u5206\\u6563\\u201D\\u8FD9\\u4E48\\u9EBB\\u70E6\\uFF0C\\u90A3\\u4E48\\u80FD\\u4E0D\\u80FD\\u7EDF\\u4E00\\u5728\\u4E00\\u4E2A\\u5730\\u65B9\\u653E\\u7F6E\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\uFF0C\\u8FD9\\u6837\\u72B6\\u6001\\u3001\\u6837\\u5F0F\\u4E0A\\u90FD\\u80FD\\u5F88\\u597D\\u7684\\u5904\\u7406\\uFF0C\\u6BD4\\u5982\\uFF0C\\u653E\\u7F6E\\u5728\\u4E00\\u4E2A\\u7EDF\\u4E00\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u7EC4\\u4EF6\\u4E2D\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"hl=2,13\",children:`// \\u7EDF\\u4E00\\u7684\\u72B6\\u6001\nconst [toasts, setToasts] = useState([])\n\n// ToastContainer \\u7EC4\\u4EF6\nconst ToastContainer = ({toasts}) =\u003e (\n  \u003cul\u003e\n    {toasts.map(toast =\u003e (\n      \u003cli\u003e\u003cToast {...toast} /\u003e\u003c/li\u003e\n    ))}\n  \u003c/ul\u003e\n)\n\n\u003cToastContainer toasts={toasts} /\u003e\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8FD9\\u6837\\u4E00\\u6765\\uFF0C\\u5F53\\u6211\\u4EEC\\u9700\\u8981\\u5C55\\u793A Toast \\u65F6\\uFF0C\\u53EA\\u9700\\u8981\\u5F80\",(0,e.jsx)(n.code,{children:\"toasts\"}),\"\\u6570\\u7EC4\\u4E2D\\u589E\\u52A0\\u4E00\\u4E2A\\u65B0\\u7684\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u5373\\u53EF\\u3002\\u5E76\\u4E14\\u6240\\u6709\\u7684 Toast \\u90FD\\u653E\\u7F6E\\u5728 ToastContainer \\u4E2D\\uFF0C\\u6837\\u5F0F\\u4E5F\\u53EF\\u4EE5\\u81EA\\u7531\\u53D1\\u6325\\u4E86\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"hl=16\",children:`// \\u7EDF\\u4E00\\u7684\\u72B6\\u6001\nconst [toasts, setToasts] = useState([])\n\n// ToastContainer \\u7EC4\\u4EF6\nconst ToastContainer = ({toasts}) =\u003e (\n  \u003cul\u003e\n    {toasts.map(toast =\u003e (\n      \u003cli\u003e\u003cToast {...toast} /\u003e\u003c/li\u003e\n    ))}\n  \u003c/ul\u003e\n)\n\n\u003cToastContainer toasts={toasts} /\u003e\n\n// \\u8981\\u5C55\\u793A Toast \\u65F6\nsetToasts([...toasts, newToast])\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u72B6\\u6001\\u7BA1\\u7406\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E0A\\u9762\\u7684\\u65B9\\u6CD5\\u4E2D\\u72B6\\u6001\\u662F\\u7EDF\\u4E00\\u4E86\\uFF0C\\u4F46\\u64CD\\u4F5C\\u90FD\\u5F97\\u5728\\u540C\\u4E00\\u4E2A\\u7EC4\\u4EF6\\u5185\\u3002\\u5047\\u5982\\u6211\\u4EEC\\u8981\\u5728\\u4E0D\\u540C\\u7684\\u7EC4\\u4EF6\\u91CC\\u8C03\\u7528\\u5C55\\u793A Toast \\u7684\\u65B9\\u6CD5\\u5462\\uFF1F\\u4E00\\u79CD\\u65B9\\u6CD5\\u662F\",(0,e.jsx)(n.a,{href:\"https://reactjs.org/docs/lifting-state-up.html\",children:\"\\u201C\\u72B6\\u6001\\u63D0\\u5347\\u201D\\uFF08Lifting state up\\uFF09\"}),\"\\uFF0C\\u628A\\u72B6\\u6001\\u63D0\\u5230\\u66F4\\u9AD8\\u4E00\\u5C42\\uFF0C\\u5177\\u4F53\\u65B9\\u6CD5\\u4E0D\\u518D\\u8D58\\u8FF0\\uFF0C\\u53EF\\u4EE5\\u770B\\u6587\\u6863\\u4E86\\u89E3\\u3002\\u4F46\\u662F\\u8FD9\\u79CD\\u505A\\u6CD5\\u4F1A\\u5E26\\u6765\",(0,e.jsx)(n.a,{href:\"https://kentcdodds.com/blog/prop-drilling\",children:\"\\u201CProp drilling\\u201D\"}),\"\\u7684\\u95EE\\u9898\\uFF0C\\u6211\\u4EEC\\u5F97\\u5C06\",(0,e.jsx)(n.code,{children:\"setToasts\"}),\"\\u65B9\\u6CD5\\u4F20\\u7ED9\\u9700\\u8981\\u8C03\\u7528\\u7684\\u7EC4\\u4EF6\\uFF0C\\u5982\\u679C\\u7EC4\\u4EF6\\u5D4C\\u5957\\u7684\\u5C42\\u7EA7\\u5F88\\u6DF1\\uFF0C\\u5C31\\u5F97\\u4E00\\u5C42\\u5C42\\u5730\\u5F80\\u4E0B\\u201C\\u94BB\\u201D\\uFF0C\\u8FD9\\u79CD\\u505A\\u6CD5\\u5E76\\u4E0D\\u4F18\\u96C5\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"hl=16\",children:`// \\u7EDF\\u4E00\\u7684\\u72B6\\u6001\nconst [toasts, setToasts] = useState([])\n\n// ToastContainer \\u7EC4\\u4EF6\nconst ToastContainer = ({toasts}) =\u003e (\n  \u003cul\u003e\n    {toasts.map(toast =\u003e (\n      \u003cli\u003e\u003cToast {...toast} /\u003e\u003c/li\u003e\n    ))}\n  \u003c/ul\u003e\n)\n\n\u003cToastContainer toasts={toasts} /\u003e\n\n// \\u628A setToasts \\u65B9\\u6CD5\\u4F20\\u7ED9\\u8981\\u8C03\\u7528\\u7684\\u7EC4\\u4EF6\n\u003cAnotherComponent onShowToast={setToasts} /\u003e\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5B9E\\u9645\\u4E0A\\u6211\\u4EEC\\u53EF\\u4EE5\\u5229\\u7528\\u7EDF\\u4E00\\u7684\\u72B6\\u6001\\u7BA1\\u7406\\u5DE5\\u5177\\u6765\\u89E3\\u51B3\\u8FD9\\u4E2A\\u95EE\\u9898\\uFF0C\\u4E1A\\u754C\\u5DF2\\u7ECF\\u6709\\u65E0\\u6570\\u7684\\u8F6E\\u5B50\\u80FD\\u505A\\u5230\\uFF0C\\u6BD5\\u7ADF\\u8BF4\\u5230\\u9020\\u8F6E\\u5B50\\uFF0C\\u7684\\u786E\\u6CA1\\u6709\\u6BD4\\u8D35\\u5708\\u66F4\\u72C2\\u70ED\\u7684\\u4E86\\u3002\\u6BD4\\u5982\\u4F20\\u7EDF\\u4E00\\u70B9\\u7684 \",(0,e.jsx)(n.a,{href:\"https://redux.js.org/\",children:\"Redux\"}),\"\\uFF0C\\u65B0\\u4E00\\u70B9\\u7684 \",(0,e.jsx)(n.a,{href:\"https://jotai.org/\",children:\"Jotai\"}),\"\\uFF0C\\u5B98\\u65B9\\u80CC\\u666F\\u7684 \",(0,e.jsx)(n.a,{href:\"https://recoiljs.org/\",children:\"Recoil\"}),\"\\uFF0C\\u8FD8\\u6709 \",(0,e.jsx)(n.a,{href:\"https://github.com/pmndrs/zustand\",children:\"Zustand\"}),\"\\u3001\",(0,e.jsx)(n.a,{href:\"https://rematchjs.org/\",children:\"Rematch\"}),\" \\u7B49\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E0A\\u9762\\u63D0\\u5230\\u7684\\u8FD9\\u4E9B\\u8F6E\\u5B50\\uFF0C\\u5404\\u6709\\u4F18\\u52A3\\uFF0C\\u53EF\\u4EE5\\u81EA\\u884C\\u9009\\u62E9\\u4F7F\\u7528\\u3002\\u5BF9\\u4E8E\\u6211\\u4EEC Toast \\u7EC4\\u4EF6\\u8FD9\\u79CD\\u201C\\u5C0F\\u9E21\\u201D\\uFF0C\\u5176\\u5B9E\\u6CA1\\u6709\\u5FC5\\u8981\\u4E0A\\u201C\\u725B\\u5200\\u201D\\uFF0C\\u7528 Context \\u914D\\u5408\",(0,e.jsx)(n.code,{children:\"useContext\"}),\"\\u5C31\\u53EF\\u4EE5\\u5B9E\\u73B0\\u540C\\u6837\\u7684\\u6548\\u679C\\u3002\\u5982\\u679C\\u4F60\\u8FD8\\u4E0D\\u4E86\\u89E3 Context \\u548C Hooks\\uFF0C\\u53EF\\u4EE5\\u770B\\u770B\",(0,e.jsx)(n.a,{href:\"https://kentcdodds.com/blog/how-to-use-react-context-effectively\",children:\"\\u8FD9\\u4E2A\\u6587\\u6863\"}),\"\\uFF0C\\u8FD9\\u91CC\\u4E0D\\u518D\\u8D58\\u8FF0\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",children:`// \\u5305\\u5728\\u9700\\u8981\\u8C03\\u7528\\u7684\\u7EC4\\u4EF6\\u7684\\u516C\\u5171\\u5916\\u5C42\nReactDOM.createRoot(document.getElementById(\"root\")).render(\n  \u003cToastProvider\u003e\n    \u003cApp /\u003e\n  \u003c/ToastProvider\u003e\n);\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u66B4\\u9732\\u63A5\\u53E3\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u81EA\\u5B9A\\u4E49\\u4E00\\u4E2A Context Provider \\u7EC4\\u4EF6\",(0,e.jsx)(n.code,{children:\"\u003cToastProvider/\u003e\"}),\"\\uFF0C\\u5C06\\u5B83\\u5305\\u5728\\u9700\\u8981\\u8C03\\u7528\\u7684\\u7EC4\\u4EF6\\u7684\\u516C\\u5171\\u5916\\u5C42\\uFF0C\\u6BD4\\u5982\",(0,e.jsx)(n.code,{children:\"\u003cApp/\u003e\"}),\"\\u4E4B\\u5916\\u3002\\u8FD9\\u65F6\\u6211\\u4EEC\\u5C31\\u8981\\u8003\\u8651\\u8BE5\\u5C06\\u54EA\\u4E9B\\u4E1C\\u897F\\u653E\\u8FDB Context \\u91CC\\u516C\\u7528\\uFF0C\\u5C31\\u662F\\u8981\\u66B4\\u9732\\u4EC0\\u4E48\\u6837\\u7684\\u63A5\\u53E3\\u51FA\\u53BB\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E0A\\u9762\\u7684\\u4F8B\\u5B50\\u4E2D\\u6211\\u4EEC\\u662F\\u901A\\u8FC7\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"setToasts\"}),\"\\u65B9\\u6CD5\\u6765\\u589E\\u52A0\\u65B0\\u7684 Toast\\uFF0C\\u5982\\u679C\\u76F4\\u63A5\\u628A\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u66B4\\u9732\\u51FA\\u53BB\\uFF0C\\u8C03\\u7528\\u8005\\u6709\\u53EF\\u80FD\\u4F1A\\u968F\\u610F\\u6539\\u52A8 state \\u800C\\u5BFC\\u81F4\\u5947\\u602A\\u7684 bug \\u51FA\\u73B0\\u3002\\u56E0\\u6B64\\u6211\\u4EEC\\u9700\\u8981\\u5728\",(0,e.jsx)(n.code,{children:\"setToasts\"}),\"\\u65B9\\u6CD5\\u5916\\u518D\\u5305\\u4E0A\\u4E00\\u5C42\\uFF0C\\u4EE5\\u9650\\u5236\\u8C03\\u7528\\u8005\\u7684\\u4F7F\\u7528\\uFF0C\\u6BD4\\u5982\\u4E0B\\u9762\\u7684\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u65B9\\u6CD5\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`toast(\"\\u5220\\u9664\\u6210\\u529F\\u3002\", 3000, \"success\", doSomethingOnHide);\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u76F4\\u63A5\\u628A\\u6240\\u9700\\u8981\\u7684\\u53C2\\u6570\\u4F20\\u8FDB\\u53BB\\u5373\\u53EF\\uFF0C\\u7701\\u53BB\\u4E86\\u76F4\\u63A5\\u64CD\\u4F5C state \\u6240\\u5E26\\u6765\\u7684\\u98CE\\u9669\\u3002\\u751A\\u81F3\\u6211\\u4EEC\\u8FD8\\u53EF\\u4EE5\\u53C2\\u8003 Axios \\u7684\\u505A\\u6CD5\\uFF0C\\u628A\\u7C7B\\u578B\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u8F6C\\u6210\\u65B9\\u6CD5\\uFF0C\\u76F4\\u63A5\\u8C03\\u7528\\uFF0C\\u7701\\u53BB\\u586B\\u5199\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u53C2\\u6570\\u7684\\u9EBB\\u70E6\\u3002\\u8FD8\\u53EF\\u4EE5\\u7528\\u9ED8\\u8BA4\\u503C\\u7701\\u7565\\u4E00\\u4E9B\\u53C2\\u6570\\uFF0C\\u8FDB\\u4E00\\u6B65\\u7B80\\u5316\\u8C03\\u7528\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`toast.info(\"\\u52A0\\u8F7D\\u6210\\u529F\\u3002\");\ntoast.error(\"\\u4FDD\\u5B58\\u5931\\u8D25\\u3002\");\ntoast.success(\"\\u62A2\\u7968\\u6210\\u529F\\u3002\");\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u5C0F\\u7ED3\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u7EFC\\u4E0A\\uFF0C\\u6211\\u4EEC\\u524D\\u671F\\u786E\\u5B9A\\u4E0B\\u6765\\u7684\\u51E0\\u4E2A\\u57FA\\u672C\\u7684\\u5C01\\u88C5\\u8981\\u70B9\\u6709\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u7EC4\\u4EF6\\u9700\\u8981\",(0,e.jsx)(n.code,{children:\"message\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"duration\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u8FD9\\u51E0\\u4E2A props\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u7528\\u7EDF\\u4E00\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u6765\\u7BA1\\u7406\\u6240\\u6709\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u7528\\u4E00\\u4E2A\\u6570\\u7EC4\\u6765\\u5904\\u7406 Toast \\u7684\\u589E\\u5220\\uFF0C\\u4FDD\\u5B58\\u76F8\\u5173\\u5C5E\\u6027\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u7528 Context \\u7BA1\\u7406\\u72B6\\u6001\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"\\u5BF9\\u5916\\u66B4\\u9732\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u53CA\\u5176\\u884D\\u751F\\u7684\\u65B9\\u6CD5\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u5F00\\u59CB\\u5C01\\u88C5\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u53EF\\u4EE5\\u6B63\\u5F0F\\u5F00\\u59CB\\u5C01\\u88C5\\u4E86\\u3002\\u8FD9\\u91CC\\u76F4\\u63A5\\u7565\\u8FC7\\u9879\\u76EE\\u7684\\u521B\\u5EFA\\u9636\\u6BB5\\uFF0C\\u4F60\\u53EF\\u4EE5\\u4F7F\\u7528\\u81EA\\u5DF1\\u559C\\u6B22\\u7684\\u811A\\u624B\\u67B6\\u6765\\u521B\\u5EFA\\u9879\\u76EE\\uFF0C\\u53C8\\u6216\\u8005\\u5728\\u5DF2\\u6709\\u7684\\u9879\\u76EE\\u4E2D\\u8FDB\\u884C\\u5C01\\u88C5\\uFF0C\\u8FD9\\u5E76\\u4E0D\\u5F71\\u54CD\\u5B9E\\u9645\\u7684\\u5C01\\u88C5\\u8FC7\\u7A0B\\u3002\\u6211\\u8FD9\\u91CC\\u628A\\u6240\\u6709\\u6587\\u4EF6\\u90FD\\u76F4\\u63A5\\u653E\\u5728\",(0,e.jsx)(n.code,{children:\"src/\"}),\"\\u76EE\\u5F55\\u4E0B\\uFF0C\\u4F60\\u53EF\\u4EE5\\u628A\\u5B83\\u4EEC\\u653E\\u5728\",(0,e.jsx)(n.code,{children:\"component/\"}),\"\\u6216\\u8005\",(0,e.jsx)(n.code,{children:\"hooks/\"}),\"\\u6216\\u8005\\u5176\\u5B83\\u4EFB\\u610F\\u76EE\\u5F55\\u90FD\\u6CA1\\u95EE\\u9898\\uFF0C\\u770B\\u4E2A\\u4EBA\\u559C\\u597D\\u3002\\u6BCF\\u4E2A\\u6587\\u4EF6\\u7684\\u5185\\u5BB9\\u5728\\u4E0B\\u9762\\u4F1A\\u5177\\u4F53\\u4ECB\\u7ECD\\u5230\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`src/\n|--- ToastProvider.jsx\n|--- Toast.jsx\n|--- ToastContainer.jsx\n|--- useToast.js\n|--- App.jsx\n|--- index.js\n|--- index.css\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u4ECE\\u6700\\u5916\\u5C42\\u5F00\\u59CB\\uFF0C\\u5148\\u5C01\\u88C5\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"\u003cToastProvider/\u003e\"}),\"\\u7EC4\\u4EF6\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"Context Provider\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx\",children:`import { createContext } from \"react\";\n\n// \\u521B\\u5EFA Context\nconst ToastContext = createContext({});\n\n// \\u5957\\u4E0A Provider\nconst ToastProvider = ({ children }) =\u003e {\n  return \u003cToastContext.Provider\u003e{children}\u003c/ToastContext.Provider\u003e;\n};\n\nexport default ToastProvider;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Context \\u5229\\u7528 Provider \\u63D0\\u4F9B\\u9700\\u8981\\u201C\\u66B4\\u9732\\u201D\\u516C\\u5171\\u7684\\u5185\\u5BB9\\uFF0C\\u7136\\u540E\\u901A\\u8FC7 Consumer \\u6216\",(0,e.jsx)(n.code,{children:\"useContext\"}),\"\\u65B9\\u6CD5\\u6765\\u5728\\u5D4C\\u5957\\u7684\\u7EC4\\u4EF6\\u4E2D\\u83B7\\u5F97\\u8FD9\\u4E9B\\u516C\\u5171\\u7684\\u5185\\u5BB9\\u3002\\u5728\\u4F7F\\u7528\\u7684\\u65F6\\u5019\\uFF0C\\u6211\\u4EEC\\u628A\",(0,e.jsx)(n.code,{children:\"\u003cToastProvider/\u003e\"}),\"\\u7EC4\\u4EF6\\u5305\\u5728\\u5916\\u5C42\\u5373\\u53EF\\uFF0C\\u8FD9\\u6837\\u91CC\\u9762\\u7684\\u7EC4\\u4EF6\\uFF08\\u4EE5\\u53CA\\u6DF1\\u5C42\\u7684\\u5B50\\u7EC4\\u4EF6\\uFF09\\u5C31\\u80FD\\u83B7\\u5F97\\u8FD9\\u4E9B\\u5185\\u5BB9\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/index.js\",children:`import App from \"./App\";\nimport ToastProvider from \"./ToastProvider\";\n\nReactDOM.createRoot(document.getElementById(\"root\")).render(\n  \u003cToastProvider\u003e\n    \u003cApp /\u003e\n  \u003c/ToastProvider\u003e\n);\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5F53\\u7136\\uFF0C\\u8FD9\\u91CC\\u53EA\\u662F\\u642D\\u4E86\\u4E2A\\u6846\\u67B6\\uFF0C\\u56E0\\u4E3A\\u6211\\u4EEC\\u8FD8\\u6CA1\\u6709\\u63D0\\u4F9B\\u8981\\u66B4\\u9732\\u7684\\u5185\\u5BB9\\uFF0C\\u6240\\u4EE5\\u73B0\\u5728\\u5728\\u7EC4\\u4EF6\\u4E2D\\u8FD8\\u4E0D\\u80FD\\u83B7\\u53D6\\u5230\\u4EFB\\u4F55\\u4E1C\\u897F\\u3002\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Toast \\u7EC4\\u4EF6\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u6765\\u5199\\u771F\\u6B63\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u672C\\u4F53\\uFF0C\\u5B83\\u9664\\u4E86\\u63A5\\u53D7\\u4E0A\\u9762\\u63D0\\u5230\\u7684\",(0,e.jsx)(n.code,{children:\"message\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"duration\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u8FD9\\u51E0\\u4E2A props \\u4EE5\\u5916\\uFF0C\\u8FD8\\u989D\\u5916\\u589E\\u52A0\\u4E86\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\uFF0C\\u4F5C\\u4E3A\\u552F\\u4E00\\u7684\\u6807\\u8BC6\\uFF0C\\u65B9\\u4FBF\\u6211\\u4EEC\\u5BF9\",(0,e.jsx)(n.code,{children:\"toasts\"}),\"\\u6570\\u636E\\u8FDB\\u884C\\u5220\\u51CF\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/Toast.jsx\",children:`import { useEffect } from \"react\";\n\nconst TOAST_STYLE = {\n  info: {\n    bgColor: \"bg-amber-100\",\n    textColor: \"text-amber-600\",\n  },\n  error: {\n    bgColor: \"bg-red-100\",\n    textColor: \"text-red-600\",\n  },\n  success: {\n    bgColor: \"bg-green-100\",\n    textColor: \"text-green-600\",\n  },\n};\n\nconst Toast = ({ id, message, duration, type, onHide }) =\u003e {\n  useEffect(() =\u003e {\n    // duration \\u63A7\\u5236\\u663E\\u793A\\u7684\\u65F6\\u957F\\uFF0C\\u5230\\u671F\\u6D88\\u5931\\u65F6\\u8C03\\u7528 onHide \\u5E76\\u4F20\\u5165 id\n    const timer = setTimeout(() =\u003e onHide(id), duration);\n    return () =\u003e clearTimeout(timer);\n  }, []);\n  return (\n    \u003cdiv\n      className={\\`px-8 py-4 mb-4 last:mb-0 rounded-md shadow-sm \\${TOAST_STYLE[type].bgColor} \\${TOAST_STYLE[type].textColor}\\`}\n    \u003e\n      {message}\n    \u003c/div\u003e\n  );\n};\n\nexport default Toast;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7EC4\\u4EF6\\u7684\\u903B\\u8F91\\u6BD4\\u8F83\\u7B80\\u5355\\uFF0C\",(0,e.jsx)(n.code,{children:\"message\"}),\"\\u5C55\\u793A\\u6D88\\u606F\\u7684\\u5185\\u5BB9\\uFF0C\\u4F60\\u53EF\\u4EE5\\u7528\\u4F60\\u559C\\u6B22\\u7684 HTML \\u7ED3\\u6784\\u5C55\\u793A\\u3002\\u6211\\u8FD9\\u91CC\\u7528\\u4E86\\u6700\\u7B80\\u5355\\u7684 div \\u914D\\u5408 \",(0,e.jsx)(n.a,{href:\"https://tailwindcss.com/\",children:\"Tailwind CSS\"}),\"\\uFF0C\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"type\"}),\"\\u6765\\u533A\\u5206\\u4E0D\\u540C\\u7C7B\\u578B\\uFF0C\\u8BBE\\u7F6E\\u4E0D\\u540C\\u7684\\u6837\\u5F0F\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7531\\u4E8E Toast \\u5C55\\u793A\\u4E00\\u5C0F\\u6BB5\\u65F6\\u95F4\\u540E\\u4FBF\\u4F1A\\u81EA\\u52A8\\u6D88\\u5931\\uFF0C\\u6211\\u4EEC\\u5229\\u7528\",(0,e.jsx)(n.code,{children:\"useEffect\"}),\"\\u5728\\u7EC4\\u4EF6\\u521D\\u59CB\\u5316\\u65F6\\u8BBE\\u7F6E\\u4E00\\u4E2A\\u5B9A\\u65F6\\u5668\\uFF0C\\u7531\",(0,e.jsx)(n.code,{children:\"duration\"}),\"\\u63A7\\u5236\\u5C55\\u793A\\u7684\\u65F6\\u957F\\uFF0C\\u5230\\u671F\\u6D88\\u5931\\u65F6\\uFF0C\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5E76\\u4F20\\u5165\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\uFF0C\\u63A7\\u5236 Toast \\u9690\\u85CF\\uFF08\\u9690\\u85CF\\u7684\\u903B\\u8F91\\u5728\\u540E\\u9762\\uFF09\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"ToastContainer\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5F53\\u540C\\u65F6\\u6709\\u591A\\u4E2A Toast \\u4E00\\u8D77\\u5C55\\u793A\\u7684\\u65F6\\u5019\\uFF0C\\u867D\\u7136\\u8FD9\\u79CD\\u60C5\\u51B5\\u6BD4\\u8F83\\u5C11\\uFF0C\\u4F46\\u4E5F\\u662F\\u8981\\u8003\\u8651\\u8FDB\\u6765\\uFF0C\\u6700\\u597D\\u8FD8\\u662F\\u80FD\\u591F\\u5728\\u4E00\\u4E2A\\u201C\\u5BB9\\u5668\\u201D\\u91CC\\u7EDF\\u4E00\\u5904\\u7406\\uFF0C\\u907F\\u514D\\u6837\\u5F0F\\u4E0A\\u91CD\\u53E0\\u3002\\u6211\\u4EEC\\u65B0\\u5EFA\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u672C\\u8D28\\u4E0A\\u5C31\\u662F\\u4E00\\u4E2A\\u5217\\u8868\\uFF0C\\u8FD9\\u91CC\\u7528 flex \\u7B80\\u5355\\u5E03\\u5C40\\u4E00\\u4E0B\\uFF0C\\u6216\\u8005\\u4F60\\u559C\\u6B22\\u7684\\u5176\\u5B83\\u5E03\\u5C40\\u6837\\u5F0F\\u3002\\u7EC4\\u4EF6\\u63A5\\u53D7\\u4E24\\u4E2A props\\uFF1A\",(0,e.jsx)(n.code,{children:\"toasts\"}),\"\\u4E2D\\u5B58\\u653E\\u6240\\u6709 Toast \\u6570\\u636E\\uFF0C\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u5219\\u5728\\u6D88\\u5931\\u65F6\\u8C03\\u7528\\u3002\\u8FD9\\u91CC\\u53C8\\u7528\\u5230\\u4E86\\u201Cprop drilling\\u201D\\uFF0C\\u56E0\\u4E3A\\u79FB\\u9664 Toast \\u7684\\u65B9\\u6CD5\\uFF08\\u540E\\u9762\\u4F1A\\u8BB2\\u5230\\uFF09\\uFF0C\\u6211\\u4E0D\\u5E0C\\u671B\\u5B83\\u88AB\\u66B4\\u9732\\u5230 Context \\u4E2D\\uFF0C\\u53EA\\u597D\\u4E00\\u5C42\\u5C42\\u4F20\\u8FDB\\u6765\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5F53\\u7136\\uFF0C\\u5982\\u679C\\u4F60\\u5E0C\\u671B\\u80FD\\u591F\\u201C\\u624B\\u52A8\\u201D\\u63A7\\u5236 Toast \\u7684\\u663E\\u793A\\uFF0C\\u4E5F\\u53EF\\u4EE5\\u628A\\u79FB\\u9664\\u7684\\u65B9\\u6CD5\\u4E5F\\u4E00\\u5E76\\u66B4\\u9732\\u51FA\\u53BB\\uFF0C\\u8FD9\\u91CC\\u4E3A\\u4E86\\u4FDD\\u6301\\u7B80\\u5355\\u6682\\u4E14\\u4E0D\\u8FD9\\u6837\\u505A\\u3002\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastContainer.jsx\",children:`import Toast from \"./Toast\";\n\nconst ToastContainer = ({ toasts, onHide }) =\u003e {\n  return (\n    \u003cul className=\"fixed top-0 right-0 p-8 flex flex-col items-end\"\u003e\n      {toasts.map((toast) =\u003e {\n        const { id, type, message, duration } = toast;\n        return (\n          \u003cli key={id}\u003e\n            \u003cToast\n              id={id}\n              message={message}\n              duration={duration}\n              type={type}\n              onHide={onHide}\n            /\u003e\n          \u003c/li\u003e\n        );\n      })}\n    \u003c/ul\u003e\n  );\n};\n\nexport default ToastContainer;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u8FD8\\u53EF\\u4EE5\\u7ED9 Toast \\u7684\\u8FDB\\u51FA\\u52A0\\u4E0A\\u52A8\\u753B\\uFF0C\\u8FD9\\u91CC\\u63A8\\u8350\",(0,e.jsx)(n.code,{children:\"react-transition-group\"}),\"\\u8FD9\\u4E2A\\u5305\\u3002\\u5B83\\u5341\\u5206\\u5C0F\\u5DE7\\uFF0C\\u4E25\\u683C\\u610F\\u4E49\\u4E0A\\u6765\\u8BB2\\uFF0C\\u5B83\\u5E76\\u4E0D\\u662F\\u4E00\\u4E2A\\u52A8\\u753B\\u5E93\\uFF0C\\u5B83\\u53EA\\u662F\\u63D0\\u4F9B\\u4E86\\u4E00\\u4E9B\\u80FD\\u591F\\u65B9\\u4FBF\\u5B9E\\u73B0\\u52A8\\u753B\\u9700\\u6C42\\u7684\\u201C\\u94A9\\u5B50\\u201D\\u3002\\u5B83\\u7684\\u7528\\u6CD5\\u4E5F\\u6BD4\\u8F83\\u7B80\\u5355\\uFF0C\\u8FD9\\u91CC\\u7528\\u5230\\u4E86\",(0,e.jsx)(n.code,{children:\"\u003cTransitionGroup/\u003e\"}),\"\\u548C\",(0,e.jsx)(n.code,{children:\"\u003cCSSTransition/\u003e\"}),\"\\u4E24\\u4E2A\\u7EC4\\u4EF6\\uFF0C\\u518D\\u914D\\u5408\\u7B80\\u5355\\u7684 CSS\\uFF0C\\u5C31\\u80FD\\u5B9E\\u73B0\\u8FDB\\u51FA\\u7684\\u52A8\\u753B\\u6548\\u679C\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastContainer.jsx del=6,14,29 add=2,7-10,15,25,28\",children:`import Toast from \"./Toast\";\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\n\nconst ToastContainer = ({ toasts, onHide }) =\u003e {\n  return (\n    \u003cul className=\"fixed top-0 right-0 p-8 flex flex-col items-end\"\u003e\n    \u003cTransitionGroup\n      component=\"ul\"\n      className=\"fixed top-0 right-0 p-8 flex flex-col items-end\"\n    \u003e\n      {toasts.map((toast) =\u003e {\n        const { id, type, message, duration } = toast;\n        return (\n          \u003cli key={id}\u003e\n          \u003cCSSTransition key={id} timeout={300} classNames=\"toast\"\u003e\n            \u003cli\u003e\n              \u003cToast\n                id={id}\n                message={message}\n                duration={duration}\n                type={type}\n                onHide={onHide}\n              /\u003e\n            \u003c/li\u003e\n          \u003c/CSSTransition\u003e\n        );\n      })}\n    \u003c/TransitionGroup\u003e\n    \u003c/ul\u003e\n  );\n};\n\nexport default ToastContainer;\n`})}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-css\",metastring:\"title=src/index.css\",children:`.toast-enter {\n  opacity: 0;\n  transform: translateX(100%);\n}\n.toast-enter-active {\n  opacity: 1;\n  transform: translateX(0);\n  transition: all 300ms;\n}\n.toast-exit {\n  opacity: 1;\n  transform: translateX(0);\n}\n.toast-exit-active {\n  opacity: 0;\n  transform: translateX(100%);\n  transition: all 300ms;\n}\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u72B6\\u6001\\u7BA1\\u7406\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5904\\u7406\\u5B8C\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u548C\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u4E4B\\u540E\\uFF0C\\u6211\\u4EEC\\u56DE\\u5230\",(0,e.jsx)(n.code,{children:\"\u003cToastProvider/\u003e\"}),\"\\u6765\\uFF0C\\u7EE7\\u7EED\\u5B8C\\u5584\\u5B83\\u72B6\\u6001\\u7BA1\\u7406\\u90E8\\u5206\\u7684\\u903B\\u8F91\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx del=1,11 add=2,9,12-17\",children:`import { createContext } from \"react\";\nimport { createContext, useState } from \"react\";\n\n// \\u521B\\u5EFA Context\nconst ToastContext = createContext({});\n\n// \\u5957\\u4E0A Provider\nconst ToastProvider = ({ children }) =\u003e {\n  const [toasts, setToasts] = useState([]);\n\n  return \u003cToastContext.Provider\u003e{children}\u003c/ToastContext.Provider\u003e;\n  return (\n    \u003cToastContext.Provider\u003e\n      {children}\n      \u003cToastContainer toasts={toasts} /\u003e\n    \u003c/ToastContext.Provider\u003e\n  );\n};\n\nexport default ToastProvider;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u9996\\u5148\\u589E\\u52A0\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"toasts\"}),\"\\u7684\\u72B6\\u6001\\uFF0C\\u5B83\\u662F\\u4E00\\u4E2A\\u6570\\u7EC4\\u3002\\u6211\\u4EEC\\u5C06\\u5B83\\u4F20\\u7ED9\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\uFF0C\\u540C\\u65F6\\u5C06\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u5D4C\\u5728\",(0,e.jsx)(n.code,{children:\"\u003cToastContext.Provider/\u003e\"}),\"\\u91CC\\u3002\\u4F60\\u53EF\\u80FD\\u6CE8\\u610F\\u5230\\u4E86\\uFF0C\\u6B64\\u65F6\\u7684\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u8FD8\\u7F3A\\u5C11\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u7684\\u53C2\\u6570\\uFF0C\\u4E0D\\u7528\\u6025\\uFF0C\\u6211\\u4EEC\\u5148\\u5B9E\\u73B0\\u65B0\\u589E Toast \\u7684\\u65B9\\u6CD5\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx add=7,13-22\",children:`import { createContext, useState } from \"react\";\n\n// \\u521B\\u5EFA Context\nconst ToastContext = createContext({});\n\n// \\u552F\\u4E00 id\nlet toastCount = 0;\n\n// \\u5957\\u4E0A Provider\nconst ToastProvider = ({ children }) =\u003e {\n  const [toasts, setToasts] = useState([]);\n\n  const addToast = (message, duration, onHideHandler, type) =\u003e {\n    const toast = {\n      id: ++toastCount,\n      message,\n      duration,\n      onHideHandler,\n      type,\n    };\n    setToasts((toasts) =\u003e [...toasts, toast]);\n  };\n\n  return (\n    \u003cToastContext.Provider\u003e\n      {children}\n      \u003cToastContainer toasts={toasts} /\u003e\n    \u003c/ToastContext.Provider\u003e\n  );\n};\n\nexport default ToastProvider;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5728\\u7EC4\\u4EF6\\u5185\\uFF0C\\u6211\\u4EEC\\u589E\\u52A0\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"addToast\"}),\"\\u65B9\\u6CD5\\uFF0C\\u987E\\u540D\\u601D\\u4E49\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u662F\\u7528\\u6765\\u589E\\u52A0 Toast \\u7684\\u3002\\u5B83\\u7684\\u903B\\u8F91\\u975E\\u5E38\\u7B80\\u5355\\uFF0C\\u628A\\u6240\\u6709\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u7EC4\\u4EF6\\u9700\\u8981\\u7684\\u53C2\\u6570\\u6253\\u5305\\u6210\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u5BF9\\u8C61\\uFF0C\\u6DFB\\u52A0\\u5230\\u6570\\u7EC4\\u4E2D\\u53BB\\u3002\\u5176\\u4E2D\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\u5C5E\\u6027\\u6211\\u4EEC\\u7528\\u4E00\\u4E2A\\u7B80\\u5355\\u7684\\u5168\\u5C40\\u53D8\\u91CF\\u6765\\u5B9E\\u73B0\\uFF0C\\u6BCF\\u65B0\\u589E\\u4E00\\u4E2A Toast \\u5219\\u5BF9\\u5176\\u8FDB\\u884C\\u9012\\u589E\\u5904\\u7406\\uFF0C\\u4FDD\\u8BC1\\u6240\\u6709\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\u7684\\u552F\\u4E00\\u6027\\u3002\\u5F53\\u7136\\u4F60\\u4E5F\\u53EF\\u4EE5\\u7528\",(0,e.jsx)(n.code,{children:\"uuid\"}),\"\\u53BB\\u5B9E\\u73B0\\u3002\\u53E6\\u5916\",(0,e.jsx)(n.code,{children:\"onHideHandler\"}),\"\\u662F\\u4E00\\u4E2A\\u56DE\\u8C03\\u51FD\\u6570\\uFF0C\\u5B83\\u5C06\\u5728 Toast \\u88AB\\u79FB\\u9664\\u65F6\\u8C03\\u7528\\uFF0C\\u4E0B\\u9762\\u4F1A\\u8BB2\\u5230\\u5B83\\u7684\\u8C03\\u7528\\u65F6\\u673A\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx del=23 add=6-18,24\",children:`const ToastProvider = ({ children }) =\u003e {\n  const [toasts, setToasts] = useState([]);\n\n  // \\u5176\\u4F59\\u90E8\\u5206\\u7565\n\n  const removeToast = (id) =\u003e {\n    setToasts((toasts) =\u003e\n      toasts.filter((toast) =\u003e {\n        if (toast.id === id) {\n          if (typeof toast.onHideHandler === \"function\") {\n            toast.onHideHandler();\n          }\n          return false;\n        }\n        return true;\n      })\n    );\n  };\n\n  return (\n    \u003cToastContext.Provider\u003e\n      {children}\n      \u003cToastContainer toasts={toasts} /\u003e\n      \u003cToastContainer toasts={toasts} onHide={removeToast} /\u003e\n    \u003c/ToastContext.Provider\u003e\n  );\n};\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u5B9E\\u73B0\\u79FB\\u9664 Toast \\u7684\\u65B9\\u6CD5\",(0,e.jsx)(n.code,{children:\"removeToast\"}),\"\\uFF0C\\u5B83\\u63A5\\u53D7\\u53C2\\u6570\",(0,e.jsx)(n.code,{children:\"id\"}),\"\\uFF0C\\u7136\\u540E\\u5C06\\u5BF9\\u5E94\\u7684\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u4ECE\\u6570\\u7EC4\\u4E2D\\u79FB\\u9664\\uFF0C\\u5728\\u79FB\\u9664\\u7684\\u8FC7\\u7A0B\\u4E2D\\uFF0C\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"toast.onHideHandler\"}),\"\\u65B9\\u6CD5\\u3002\\u6211\\u4EEC\\u628A\\u8FD9\\u4E2A\\u65B9\\u6CD5\\u4F20\\u7ED9\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u7EC4\\u4EF6\\uFF0C\\u8FD9\\u6837\\u4E00\\u6765\\uFF0C\\u5F53\",(0,e.jsx)(n.code,{children:\"\u003cToast/\u003e\"}),\"\\u4E2D\\u7684\\u5B9A\\u65F6\\u5668\\u5230\\u671F\\u65F6\\uFF0C\\u5C31\\u4F1A\\u89E6\\u53D1\\u5176\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u65B9\\u6CD5\\uFF0C\\u4E5F\\u5373\",(0,e.jsx)(n.code,{children:\"\u003cToastContainer/\u003e\"}),\"\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"onHide\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5B9E\\u9645\\u4E0A\\u5C31\\u662F\\u8C03\\u7528\\u4E86\",(0,e.jsx)(n.code,{children:\"removeToast\"}),\"\\u65B9\\u6CD5\\uFF08\\u771F\\u7684\\u6709\\u70B9\\u7ED5\\u2026\\u2026\\uFF09\\u3002\"]}),`\n`,(0,e.jsx)(n.h3,{children:\"\\u5BF9\\u5916\\u7684\\u201C\\u63A5\\u53E3\\u201D\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u641E\\u4E86\\u8FD9\\u4E48\\u4E45\\uFF0C\\u5B9E\\u9645\\u4E0A\\u6B64\\u65F6\\u6211\\u4EEC\\u7684 Context \\u8FD8\\u53EA\\u662F\\u4E2A\\u7A7A\\u58F3\\uFF0C\\u91CC\\u9762\\u5565\\u4E5F\\u6CA1\\u6709\\uFF0C\\u56E0\\u4E3A\\u6211\\u4EEC\\u8FD8\\u6CA1\\u6709\\u7ED9\\u5B83\\u4F20\\u8FC7\\u4EFB\\u4F55\\u7684\",(0,e.jsx)(n.code,{children:\"value\"}),\"\\u3002\\u6211\\u4EEC\\u53EF\\u4EE5\\u76F4\\u63A5\\u628A\",(0,e.jsx)(n.code,{children:\"addToast\"}),\"\\u65B9\\u6CD5\\u653E\\u5230 Context \\u91CC\\u516C\\u5F00\\uFF0C\\u4F46\\u6211\\u5E0C\\u671B\\u8C03\\u7528\\u7684\\u65B9\\u5F0F\\u66F4\\u52A0\\u201C\\u7075\\u6D3B\\u201D\\u4E00\\u4E9B\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`// \\u5355\\u4E2A\\u53C2\\u6570\ntoast(\"\\u8BBE\\u7F6E\\u6210\\u529F\\u3002\");\n// \\u4E24\\u4E2A\\u53C2\\u6570\ntoast(\"\\u8BBE\\u7F6E\\u6210\\u529F\\u3002\", () =\u003e doSomethingOnHide);\n// config \\u5BF9\\u8C61\ntoast(\"\\u8BBE\\u7F6E\\u6210\\u529F\\u3002\", { duration: 3000 });\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6BD4\\u5982\\u6211\\u4EEC\\u53EF\\u4EE5\\u53EA\\u4F20\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"message\"}),\"\\u53C2\\u6570\\uFF0C\\u4EE5\\u53CA\\u628A\",(0,e.jsx)(n.code,{children:\"duration\"}),\"\\u5305\\u8FDB\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"config\"}),\"\\u5BF9\\u8C61\\u4E2D\\uFF0C\\u65B9\\u4FBF\\u540E\\u7EED\\u589E\\u52A0\\u66F4\\u591A\\u7684\\u914D\\u7F6E\\u9879\\u3002\\u56E0\\u6B64\\u6211\\u4EEC\\u5728\",(0,e.jsx)(n.code,{children:\"addToast\"}),\"\\u5916\\u518D\\u5305\\u591A\\u4E00\\u5C42\\u65B9\\u6CD5\\uFF0C\\u7528\\u4E8E\\u5904\\u7406\\u8FD9\\u4E9B\\u53C2\\u6570\\u7684\\u95EE\\u9898\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx del=24 add=6-14,17-21,25\",children:`const ToastProvider = ({ children }) =\u003e {\n  const [toasts, setToasts] = useState([]);\n\n  // \\u5176\\u4F59\\u90E8\\u5206\\u7565\n\n  const toast = (message, config = {}, onHideHandler, type = \"info\") =\u003e {\n    if (!message) return;\n    if (typeof config === \"function\") {\n      onHideHandler = config;\n      config = {};\n    }\n    const duration = config.duration || 3000;\n    addToast(message, duration, onHideHandler, type);\n  };\n\n  // toast.xxx \\u7684\\u8C03\\u7528\\u65B9\\u5F0F\n  [\"info\", \"error\", \"success\"].forEach((type) =\u003e {\n    toast[type] = (message, config, onHideHandler) =\u003e {\n      toast(message, config, onHideHandler, type);\n    };\n  });\n\n  return (\n    \u003cToastContext.Provider\u003e\n    \u003cToastContext.Provider value={{ toast }}\u003e\n      {children}\n      \u003cToastContainer toasts={toasts} /\u003e\n      \u003cToastContainer toasts={toasts} onHide={removeToast} /\u003e\n    \u003c/ToastContext.Provider\u003e\n  );\n};\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8FD9\\u91CC\\u6211\\u4EEC\\u53EA\\u5BF9\\u5916\\u66B4\\u9732\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5B83\\u6709\\u591A\\u79CD\\u8C03\\u7528\\u65B9\\u5F0F\\u3002\\u65B9\\u6CD5\\u5185\\u90E8\\u5BF9\\u4F20\\u8FDB\\u6765\\u7684\\u53C2\\u6570\\u8FDB\\u884C\\u4E86\\u7B80\\u5355\\u7684\\u6821\\u9A8C\\uFF0C\\u518D\\u8F6C\\u4EA4\\u7ED9\",(0,e.jsx)(n.code,{children:\"addToast\"}),\"\\u5904\\u7406\\u3002\\u7531\\u4E8E JS \\u4E2D\\u51FD\\u6570\\u4E5F\\u662F\\u5BF9\\u8C61\\uFF0C\\u56E0\\u6B64\\u6211\\u4EEC\\u5728\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u5BF9\\u8C61\\u4E0A\\u6DFB\\u52A0\\u4E86\",(0,e.jsx)(n.code,{children:\"toast.info\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"toast.error\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"toast.success\"}),\"\\u8FD9\\u51E0\\u4E2A\\u65B9\\u6CD5\\uFF0C\\u4FBF\\u4E8E\\u8C03\\u7528\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6700\\u540E\\u7684\\u6700\\u540E\\uFF0C\\u6211\\u4EEC\\u8FD8\\u9700\\u8981\\u5C01\\u4E0A\\u6700\\u540E\\u7684\\u4E00\\u5C42\\u65B9\\u6CD5\\u3002\\u6211\\u4EEC\\u628A\",(0,e.jsx)(n.code,{children:\"ToastProvider\"}),\"\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"ToastContext\"}),\"\\u5BFC\\u51FA\\uFF0C\\u518D\\u5F15\\u5165\\u5C01\\u88C5\\u6210\",(0,e.jsx)(n.code,{children:\"useToast\"}),\"\\u65B9\\u6CD5\\uFF0C\\u8FD9\\u6837\\u6211\\u4EEC\\u5C31\\u4E0D\\u9700\\u8981\\u5728\\u6BCF\\u6B21\\u9700\\u8981\\u4F7F\\u7528\\u7684\\u65F6\\u5019\\u81EA\\u5DF1\\u624B\\u52A8\\u53BB\",(0,e.jsx)(n.code,{children:\"useContext(ToastContext)\"}),\"\\u4E86\\u3002\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",metastring:\"title=src/ToastProvider.jsx del=1 add=2\",children:`const ToastContext = createContext({});\nexport const ToastContext = createContext({});\n`})}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",metastring:\"title=src/useToast.js\",children:`import { useContext } from \"react\";\nimport { ToastContext } from \"./ToastProvider\";\n\nconst useToast = () =\u003e useContext(ToastContext);\n\nexport default useToast;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6700\\u7EC8\\u7684\\u6548\\u679C\\u5C31\\u662F\\uFF0C\\u5F53\\u6211\\u4EEC\\u9700\\u8981\\u5728\\u67D0\\u4E2A\\u7EC4\\u4EF6\\u4E2D\\u5C55\\u793A Toast \\u7684\\u65F6\\u5019\\uFF0C\\u6211\\u4EEC\\u76F4\\u63A5\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"toast\"}),\"\\u65B9\\u6CD5\\u5373\\u53EF\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-jsx\",children:`import useToast from \"./useToast\";\n\nconst ComponentA = () =\u003e {\n  const { toast } = useToast();\n\n  return \u003cbutton onClick={() =\u003e toast(\"\\u5C01\\u88C5\\u5B8C\\u6210\\uFF01\")}\u003e\\u70B9\\u51FB\u003c/button\u003e;\n};\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u81F3\\u6B64\\uFF0C\\u6211\\u4EEC\\u7684 Toast \\u7EC4\\u4EF6\\u5C31\\u5DF2\\u7ECF\\u5C01\\u88C5\\u597D\\u4E86\\u3002\\u5F53\\u7136\\uFF0C\\u8FD9\\u53EA\\u662F\\u7B80\\u5355\\u7684\\u5C01\\u88C5\\uFF0C\\u5982\\u679C\\u60F3\\u8981\\u201C\\u53D1\\u4E2A\\u5305\\u201D\\u7684\\u8BDD\\uFF0C\\u8FD8\\u9700\\u8981\\u5B8C\\u5584\\u4E00\\u4E9B\\u8FB9\\u754C\\u6761\\u4EF6\\u7684\\u5904\\u7406\\uFF0C\\u4EE5\\u53CA\\u8865\\u5145\\u5355\\u5143\\u6D4B\\u8BD5\\u53CA\\u64B0\\u5199\\u4E00\\u4EFD\\u8BE6\\u7EC6\\u7684\\u6587\\u6863\\u7B49\\u3002\\u6709\\u65F6\\u95F4\\u518D\\u505A\\u5427\\uFF0C\\u6E9C\\u4E86\\u3002\"}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u53C2\\u8003\\u8D44\\u6599\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://reactjs.org/docs/lifting-state-up.html\",children:\"\\u72B6\\u6001\\u63D0\\u5347\\uFF08Lifting state up\\uFF09\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://kentcdodds.com/blog/prop-drilling\",children:\"\\u201CProp drilling\\u201D\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://kentcdodds.com/blog/how-to-use-react-context-effectively\",children:\"How to use React Context effectively\"})}),`\n`]})]})}function H(t={}){let{wrapper:n}=t.components||{};return n?(0,e.jsx)(n,Object.assign({},t,{children:(0,e.jsx)(l,t)})):l(t)}var j=H;return f(P);})();\n;return Component;"},"__N_SSG":true},"page":"/post/[id]","query":{"id":"build-your-own-react-toast-component"},"buildId":"__B9SB2fFDyT1nST8Szb4","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>