{"pageProps":{"meta":{"title":"Axios 源码阅读笔记之——徒手撕 Ajax（二）","date":"JAN 14, 2022","desc":"上一次我们已经封装了一个“简陋版”的 Axios，实现了配置化，多种方式调用，Promise 化等功能。除此以外，Axios 还有两个很重要的功能：拦截器、取消请求。这一次我们先来实现一个拦截器的功能。","type":"xray"},"code":"var Component=(()=>{var p=Object.create;var s=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var m=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports),x=(r,n)=>{for(var t in n)s(r,t,{get:n[t],enumerable:!0})},o=(r,n,t,c)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let i of u(n))!g.call(r,i)&&i!==t&&s(r,i,{get:()=>n[i],enumerable:!(c=a(n,i))||c.enumerable});return r};var q=(r,n,t)=>(t=r!=null?p(f(r)):{},o(n||!r||!r.__esModule?s(t,\"default\",{value:r,enumerable:!0}):t,r)),I=r=>o(s({},\"__esModule\",{value:!0}),r);var l=m((C,h)=>{h.exports=_jsx_runtime});var y={};x(y,{default:()=>R,frontmatter:()=>j});var e=q(l()),j={title:\"Axios \\u6E90\\u7801\\u9605\\u8BFB\\u7B14\\u8BB0\\u4E4B\\u2014\\u2014\\u5F92\\u624B\\u6495 Ajax\\uFF08\\u4E8C\\uFF09\",date:\"JAN 14, 2022\",desc:\"\\u4E0A\\u4E00\\u6B21\\u6211\\u4EEC\\u5DF2\\u7ECF\\u5C01\\u88C5\\u4E86\\u4E00\\u4E2A\\u201C\\u7B80\\u964B\\u7248\\u201D\\u7684 Axios\\uFF0C\\u5B9E\\u73B0\\u4E86\\u914D\\u7F6E\\u5316\\uFF0C\\u591A\\u79CD\\u65B9\\u5F0F\\u8C03\\u7528\\uFF0CPromise \\u5316\\u7B49\\u529F\\u80FD\\u3002\\u9664\\u6B64\\u4EE5\\u5916\\uFF0CAxios \\u8FD8\\u6709\\u4E24\\u4E2A\\u5F88\\u91CD\\u8981\\u7684\\u529F\\u80FD\\uFF1A\\u62E6\\u622A\\u5668\\u3001\\u53D6\\u6D88\\u8BF7\\u6C42\\u3002\\u8FD9\\u4E00\\u6B21\\u6211\\u4EEC\\u5148\\u6765\\u5B9E\\u73B0\\u4E00\\u4E2A\\u62E6\\u622A\\u5668\\u7684\\u529F\\u80FD\\u3002\",type:\"xray\"};function d(r){let n=Object.assign({p:\"p\",a:\"a\",ul:\"ul\",li:\"li\",h2:\"h2\",ol:\"ol\",code:\"code\",pre:\"pre\",img:\"img\",strong:\"strong\"},r.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"/post/recreate-axios-from-scratch-i\",children:\"\\u4E0A\\u4E00\\u6B21\"}),\"\\u6211\\u4EEC\\u5DF2\\u7ECF\\u5C01\\u88C5\\u4E86\\u4E00\\u4E2A\\u201C\\u7B80\\u964B\\u7248\\u201D\\u7684 Axios\\uFF0C\\u5B9E\\u73B0\\u4E86\\u914D\\u7F6E\\u5316\\uFF0C\\u591A\\u79CD\\u65B9\\u5F0F\\u8C03\\u7528\\uFF0CPromise \\u5316\\u7B49\\u529F\\u80FD\\u3002\\u9664\\u6B64\\u4EE5\\u5916\\uFF0CAxios \\u8FD8\\u6709\\u4E24\\u4E2A\\u5F88\\u91CD\\u8981\\u7684\\u529F\\u80FD\\uFF1A\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u62E6\\u622A\\u5668\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u53D6\\u6D88\\u8BF7\\u6C42\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u8FD9\\u4E00\\u6B21\\u6211\\u4EEC\\u5148\\u6765\\u5B9E\\u73B0\\u4E00\\u4E2A\\u62E6\\u622A\\u5668\\u7684\\u529F\\u80FD\\u3002\"}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u5355\\u4E2A\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\"}),`\n`,(0,e.jsx)(n.p,{children:\"\\u6211\\u4EEC\\u77E5\\u9053\\uFF0CAjax \\u8BF7\\u6C42\\u53EF\\u4EE5\\u7C97\\u7565\\u5730\\u5206\\u4E3A\\u4E09\\u4E2A\\u9636\\u6BB5\\uFF1A\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsx)(n.li,{children:\"\\u8BF7\\u6C42\\u524D\\uFF0C\\u5904\\u7406\\u914D\\u7F6E\\u7B49\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u8BF7\\u6C42\\u4E2D\\uFF0C\\u7B49\\u5F85\\u670D\\u52A1\\u5668\\u54CD\\u5E94\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u54CD\\u5E94\\uFF0C\\u5F97\\u5230\\u7ED3\\u679C\\u6216\\u5F02\\u5E38\"}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u62E6\\u622A\\u5668\\u5176\\u5B9E\\u5C31\\u662F\\u4F5C\\u7528\\u5728\\u8BF7\\u6C42\\u524D\\u3001\\u540E\\uFF08\\u54CD\\u5E94\\uFF09\\u8FD9\\u4E24\\u4E2A\\u9636\\u6BB5\\u7684\\u201C\\u94A9\\u5B50\\u201D\\uFF0C\\u5141\\u8BB8\\u6211\\u4EEC\\u5BF9\\u8BF7\\u6C42\\u7684\\u914D\\u7F6E\\u3001\\u8BF7\\u6C42\\u7684\\u54CD\\u5E94\\u3001\\u5F02\\u5E38\\u7B49\\u8FDB\\u884C\\u5904\\u7406\\u3002\\u5148\\u62FF\\u8BF7\\u6C42\\u7684\\u62E6\\u622A\\u5668\\u6765\\u4E3E\\u4F8B\\uFF0C\\u6BD4\\u65B9\\u8BF4\\u6211\\u4EEC\\u73B0\\u5728\\u6709\\u4E2A\\u9700\\u6C42\\uFF0C\\u5E0C\\u671B\\u5728\\u8BF7\\u6C42\\u524D\\uFF0C\\u80FD\\u591F\\u5148\\u5BF9\\u8BF7\\u6C42\\u7684\\u6570\\u636E\\u8FDB\\u884C\\u67D0\\u79CD\\u7279\\u5B9A\\u7684\\u7F16\\u7801\\uFF0C\\u90A3\\u4E48\\u8FD9\\u6BB5\\u903B\\u8F91\\u6211\\u4EEC\\u53EF\\u4EE5\\u6DFB\\u52A0\\u5728\",(0,e.jsx)(n.code,{children:\"request()\"}),\"\\u51FD\\u6570\\u4E2D\\u3002\\u4F46\\u662F\\u8FD9\\u6837\\u4E00\\u6765\\uFF0C\\u903B\\u8F91\\u5C31\\u88AB\\u5199\\u6B7B\\uFF0C\\u6BCF\\u6B21\\u4FEE\\u6539\\u90FD\\u9700\\u8981\\u6539\\u52A8\",(0,e.jsx)(n.code,{children:\"request()\"}),\"\\u51FD\\u6570\\u7684\\u4EE3\\u7801\\uFF0C\\u4E0D\\u7B26\\u5408\\u201C\\u5F00\\u653E\\u5C01\\u95ED\\u201D\\u7684\\u539F\\u5219\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u56E0\\u6B64\\uFF0C\\u6211\\u4EEC\\u5F97\\u628A\\u62E6\\u622A\\u5668\\u62BD\\u53D6\\u51FA\\u6765\\uFF0C\\u653E\\u5728\\u53E6\\u4E00\\u4E2A\\u5730\\u65B9\\uFF0C\\u66B4\\u9732\\u4E00\\u4E2A\\u65B9\\u6CD5\\u7528\\u4E8E\\u8BBE\\u7F6E\\u62E6\\u622A\\u5668\\uFF0C\\u7136\\u540E\\u5728\\u8BF7\\u6C42\\u524D\\u8C03\\u7528\\u8FDB\\u884C\\u5904\\u7406\\uFF0C\\u518D\\u5C06\\u5904\\u7406\\u540E\\u7684\\u7ED3\\u679C\\u7528\\u4E8E\\u8BF7\\u6C42\\u3002\\u6839\\u636E\\u8FD9\\u4E2A\\u601D\\u8DEF\\uFF0C\\u53EF\\u4EE5\\u50CF\\u4E0B\\u9762\\u8FD9\\u6837\\u5B9E\\u73B0\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function Axios(instanceConfig) {\n  // \\u9ED8\\u8BA4\\u7684\\u914D\\u7F6E\n  this.defaults = instanceConfig;\n  // \\u62E6\\u622A\\u5668\\uFF0C\\u5728\\u8BF7\\u6C42\\u524D\\u8C03\\u7528\n  this.requestInterceptor = null;\n}\n\nAxios.prototype.setRequestInterceptor = function (interceptor) {\n  this.requestInterceptor = interceptor;\n};\n\nAxios.prototype.request = function request(configOrUrl, config) {\n  /**\n   * \\u7701\\u7565\n   */\n  // \\u5148\\u8C03\\u7528\\u62E6\\u622A\\u5668\\u8FDB\\u884C\\u5904\\u7406\n  const newConfig = this.requestInterceptor(config);\n  return dispatchRequest(newConfig);\n};\n\n// \\u5047\\u8BBE\\u51FD\\u6570 encode() \\u8FD4\\u56DE\\u7279\\u6B8A\\u7F16\\u7801\\u540E\\u7684\\u6570\\u636E\nfunction encode(config) {}\n\n// \\u8BBE\\u7F6E\\u62E6\\u622A\\u5668\naxios.setRequestInterceptor(encode);\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u591A\\u4E2A\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u770B\\u4E0A\\u53BB\\u8FD8\\u4E0D\\u9519\\uFF0C\\u90A3\\u4E48\\u5047\\u5982\\u6211\\u4EEC\\u7684\\u9700\\u6C42\\u4E0D\\u53EA\\u662F\\u7F16\\u7801\\uFF0C\\u8FD8\\u5E0C\\u671B\\u5728\\u7F16\\u7801\\u540E\\u5BF9\\u6570\\u636E\\u8FDB\\u884C\\u538B\\u7F29\\u5462\\uFF1F\\u7B80\\u5355\\uFF0C\\u628A\",(0,e.jsx)(n.code,{children:\"interceptor\"}),\"\\u5C5E\\u6027\\u6362\\u6210\\u6570\\u7EC4\\uFF0C\\u7136\\u540E\\u5728\\u8BF7\\u6C42\\u524D\\u904D\\u5386\\u4E00\\u4E0B\\uFF0C\\u50CF\\u8FD9\\u6837\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function Axios(instanceConfig) {\n  this.defaults = instanceConfig;\n  // \\u62E6\\u622A\\u5668\\uFF0C\\u6539\\u6210\\u6570\\u7EC4\n  this.requestInterceptors = [];\n}\n\nAxios.prototype.setRequestInterceptor = function (interceptor) {\n  // \\u6309\\u987A\\u5E8F\\u538B\\u8FDB\\u6570\\u7EC4\\u4E2D\n  this.requestInterceptors.push(interceptor);\n};\n\nAxios.prototype.request = function request(configOrUrl, config) {\n  /**\n   * \\u7701\\u7565\n   */\n  // \\u904D\\u5386\\u6240\\u6709\\u62E6\\u622A\\u5668\n  while (this.requestInterceptors.length) {\n    const interceptor = this.requestInterceptors.shift();\n    config = interceptor(config);\n  }\n  return dispatchRequest(config);\n};\n\n// \\u5047\\u8BBE\\u51FD\\u6570 encode() \\u8FD4\\u56DE\\u7279\\u6B8A\\u7F16\\u7801\\u540E\\u7684\\u6570\\u636E\nfunction encode(config) {}\n\n// \\u8BBE\\u7F6E\\u62E6\\u622A\\u5668\naxios.setRequestInterceptor(encode);\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u54CD\\u5E94\\u62E6\\u622A\\u5668\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5BF9\\u4E8E\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\uFF0C\\u4E5F\\u662F\\u540C\\u6837\\u7684\\u9053\\u7406\\uFF0C\\u589E\\u52A0\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"responseInterceptors\"}),\"\\u5C5E\\u6027\\u7528\\u4E8E\\u4FDD\\u5B58\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\uFF0C\\u518D\\u589E\\u52A0\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"setRe sponseInterceptor()\"}),\"\\u65B9\\u6CD5\\u6765\\u8BBE\\u7F6E\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4E0E\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\\u6240\\u4E0D\\u540C\\u7684\\u662F\\uFF0C\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u7684\\u8C03\\u7528\\u7684\\u65F6\\u673A\\u5E94\\u8BE5\\u653E\\u5728\\u8BF7\\u6C42\\u4E4B\\u540E\\uFF0C\\u4E5F\\u5C31\\u662F\",(0,e.jsx)(n.code,{children:\"dispatchRequest()\"}),\"\\u65B9\\u6CD5\\u4E4B\\u540E\\u6267\\u884C\\u3002\",(0,e.jsx)(n.code,{children:\"dispatchRequest()\"}),\"\\u65B9\\u6CD5\\u8FD4\\u56DE\\u7684\\u662F\\u4E00\\u4E2A Promise\\uFF0C\\u56E0\\u6B64\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u8981\\u5728\",(0,e.jsx)(n.code,{children:\"dispatchRequest().then()\"}),\"\\u4E2D\\u53BB\\u904D\\u5386\\u6267\\u884C\\u3002\\u7B80\\u5316\\u7684\\u4EE3\\u7801\\u6846\\u67B6\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function Axios(instanceConfig) {\n  this.defaults = instanceConfig;\n  this.requestInterceptors = [];\n  this.responseInterceptors = [];\n}\n\nAxios.prototype.setRequestInterceptor = function (interceptor) {\n  this.requestInterceptors.push(interceptor);\n};\n\nAxios.prototype.setResponseInterceptor = function (interceptor) {\n  this.responseInterceptors.push(interceptor);\n};\n\nAxios.prototype.request = function request(configOrUrl, config) {\n  /**\n   * \\u7701\\u7565\n   */\n  while (this.requestInterceptors.length) {\n    const interceptor = this.requestInterceptors.shift();\n    config = interceptor(config);\n  }\n  let res;\n  dispatchRequest(config).then((res) => {\n    while (this.responseInterceptors.length) {\n      const interceptor = this.responseInterceptors.shift();\n      res = interceptor(res);\n    }\n  });\n  return res;\n};\n\n// \\u5047\\u8BBE\\u51FD\\u6570 encode() \\u8FD4\\u56DE\\u7279\\u6B8A\\u7F16\\u7801\\u540E\\u7684\\u6570\\u636E\nfunction encode(config) {}\n// \\u5047\\u8BBE\\u51FD\\u6570 decode() \\u8FD4\\u56DE\\u7279\\u6B8A\\u89E3\\u7801\\u540E\\u7684\\u6570\\u636E\nfunction decode(res) {}\n\n// \\u8BBE\\u7F6E\\u62E6\\u622A\\u5668\naxios.setRequestInterceptor(encode);\naxios.setResponseInterceptor(decode);\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Promise \\u94FE\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u55EF\\uFF0C\\u4E0A\\u9762\\u7684\\u4EE3\\u7801\\u770B\\u4E0A\\u53BB\\u8C8C\\u4F3C\\u5C31\\u4E0D\\u592A\\u4F18\\u96C5\\u2026\\u2026\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\\u548C\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u88AB\\u5206\\u6210\\u4E86\\u4E24\\u5757\\uFF0C\\u4F46\\u5B83\\u4EEC\\u53C8\\u6709\\u7740\\u76F8\\u4F3C\\u7684\\u903B\\u8F91\\u3002\\u540C\\u6837\\u662F\\u628A\\u67D0\\u4E2A\\u4E1C\\u897F\\u52A0\\u5DE5\\u540E\\u8FD4\\u56DE\\uFF0C\\u7136\\u540E\\u4EA4\\u7ED9\\u4E0B\\u4E00\\u4E2A\\u6309\\u987A\\u5E8F\\u904D\\u5386\\u6267\\u884C\\uFF0C\\u8FD9\\u79CD\\u201C\\u94FE\\u5F0F\\u8C03\\u7528\\u201D\\u7684\\u573A\\u666F\\uFF0C\\u4F60\\u4F1A\\u60F3\\u5230\\u4EC0\\u4E48\\uFF1F\\u6CA1\\u9519\\uFF0C\\u5C31\\u662F\",(0,e.jsx)(n.code,{children:\"Promise\"}),\"\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:\"\\u901A\\u8FC7 Promise\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u5C06\\u8FD9\\u4E9B\\u5904\\u7406\\u7684\\u903B\\u8F91\\u4E32\\u8FDE\\u8D77\\u6765\\u3002\\u5E76\\u4E14\\u4F7F\\u7528 Promise \\u8FD8\\u6709\\u4E2A\\u597D\\u5904\\u5C31\\u662F\\u5F02\\u5E38\\u7684\\u5904\\u7406\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u628A\\u62E6\\u622A\\u5668\\u62C6\\u6210\\u4E00\\u5BF9\\uFF0C\\u5206\\u522B\\u5904\\u7406\\u6210\\u529F\\u548C\\u5931\\u8D25\\u7684\\u60C5\\u51B5\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`Promise.resolve(config)\n  .then(encode, onError1)\n  .then(zip, onError2)\n  .request(config)\n  .then(unzip, onError3)\n  .then(decode, onError4);\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u901A\\u8FC7\\u4E0B\\u9762\\u7684\\u56FE\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u66F4\\u6E05\\u6670\\u5730\\u770B\\u5230\\u6574\\u4E2A\\u8BF7\\u6C42\\u7684\\u94FE\\u8DEF\\uFF1A\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/recreate-axios-from-scratch/chain.png\",alt:\"chain\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5229\\u7528 Promise\\uFF0C\\u6211\\u4EEC\\u80FD\\u591F\\u8BA9\\u62E6\\u622A\\u5668\\u5904\\u7406\\u5F02\\u6B65\\u7684\\u64CD\\u4F5C\\uFF0C\\u540C\\u65F6\\u8FD8\\u80FD\\u591F\\u5904\\u7406\\u6BCF\\u4E2A\\u8282\\u70B9\\u7684\\u5F02\\u5E38\\u3002\\u66F4\\u5999\\u7684\\u662F\\uFF0C\\u6211\\u4EEC\\u5C06\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\\u3001\\u8BF7\\u6C42\\u65B9\\u6CD5\\u3001\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u4E00\\u5757\\u653E\\u5230\\u4E00\\u4E2A\\u6570\\u7EC4\\u4E2D\\uFF0C\\u901A\\u8FC7\\u904D\\u5386\\uFF0C\\u6BCF\\u6B21\\u53D6\\u51FA\\u4E00\\u5BF9\\u65B9\\u6CD5\\uFF0C\\u4FBF\\u80FD\\u5F88\\u4F18\\u96C5\\u5730\\u5229\\u7528 Promise \\u7684\",(0,e.jsx)(n.code,{children:\"then()\"}),\"\\u65B9\\u6CD5\\u6765\\u4E32\\u8FDE\\u8D77\\u5B83\\u4EEC\\u3002\\u5BF9\\u4E8E\\u8BF7\\u6C42\\u65B9\\u6CD5\\u7684\\u90A3\\u4E00\\u5BF9\\uFF0C\\u6211\\u4EEC\\u7528\",(0,e.jsx)(n.code,{children:\"undefined\"}),\"\\u6765\\u5360\\u4F4D\\uFF0C\\u5219\\u8BF7\\u6C42\\u7684\\u5F02\\u5E38\\u5C06\\u7A7F\\u900F\\u7ED9\\u5176\\u4E0B\\u4E00\\u5BF9\\uFF0C\\u5373\\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u6765\\u5904\\u7406\\u3002\"]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{src:\"/images/recreate-axios-from-scratch/chain-array.png\",alt:\"chain-array\"})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u5C0F\\u7ED3\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7EFC\\u4E0A\\u6240\\u8FF0\\uFF0C\\u6211\\u4EEC\\u5C06\\u62E6\\u622A\\u5668\\u76F8\\u5173\\u7684\\u65B9\\u6CD5\\u62BD\\u53D6\\u6210\\u4E00\\u4E2A\\u7C7B\",(0,e.jsx)(n.code,{children:\"InterceptorManager\"}),\"\\uFF0C\\u6309\\u65B0\\u7684\\u601D\\u8DEF\\u8C03\\u6574\\u540E\\u7684\\u7B80\\u5316\\u4EE3\\u7801\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`class InterceptorManager {\n  constructor() {\n    this.handlers = [];\n  }\n\n  use(fulfilled, rejected) {\n    this.handlers.push({ fulfilled, rejected });\n    // \\u4E0B\\u6807\\u4F5C\\u4E3A id\\uFF0C\\u7528\\u4E8E eject\n    return this.handlers.length - 1;\n  }\n\n  eject(id) {\n    if (this.handlers[id]) {\n      this.handlers[id] = null;\n    }\n  }\n\n  // null \\u65F6\\u4E0D\\u5904\\u7406\n  forEach(fn) {\n    this.handlers.forEach((interceptor) => {\n      if (interceptor) {\n        fn(interceptor);\n      }\n    });\n  }\n}\n\nfunction Axios(instanceConfig) {\n  this.defaults = instanceConfig;\n  this.interceptors = {\n    request: new InterceptorManager(),\n    response: new InterceptorManager(),\n  };\n}\n\nAxios.prototype.request = function request(configOrUrl, config) {\n  /**\n   * \\u7701\\u7565\n   */\n  // \\u62FC\\u63A5\\u6210 [\\u8BF7\\u6C42\\u62E6\\u622A\\u5668, \\u8BF7\\u6C42, \\u54CD\\u5E94\\u62E6\\u622A\\u5668] \\u8BF7\\u6C42\\u94FE\n  // undefined \\u7684\\u4F5C\\u7528\\u662F\\u201C\\u5360\\u4F4D\\u201D\\uFF0C\\u4FDD\\u8BC1\\u4E24\\u4E24\\u4E00\\u7EC4\n  const chain = [dispatchRequest, undefined];\n  // \\u8BF7\\u6C42\\u62E6\\u622A\\u5668\\u201C\\u94FE\\u201D\\uFF0C\\u52A0\\u5230\\u5934\\u90E8\n  this.interceptors.request.forEach(({ fulfilled, rejected }) => {\n    chain.unshift(fulfilled, rejected);\n  });\n  // \\u54CD\\u5E94\\u62E6\\u622A\\u5668\\u201C\\u94FE\\u201D\\uFF0C\\u52A0\\u5230\\u5C3E\\u90E8\n  this.interceptors.response.forEach(({ fulfilled, rejected }) => {\n    chain.push(fulfilled, rejected);\n  });\n\n  // \\u542F\\u52A8\\u94FE\\u6761\n  let promise = Promise.resolve(config);\n\n  while (chain.length) {\n    // \\u904D\\u5386\\u8BF7\\u6C42\\u94FE\\uFF0C\\u4E24\\u4E24\\u4E00\\u7EC4\\u94FE\\u5F0F\\u8C03\\u7528\n    promise = promise.then(chain.shift(), chain.shift());\n  }\n\n  return promise;\n};\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5230\\u6B64\\u4E3A\\u6B62\\uFF0C\\u6211\\u4EEC\\u5C31\\u5B8C\\u6210\\u4E86\\u7B80\\u5355\\u62E6\\u622A\\u5668\\u7684\\u529F\\u80FD\\uFF0C\\u4F7F\\u7528\\u65B9\\u5F0F\\u4E5F\\u5F88\\u7B80\\u5355\\uFF0C\\u6211\\u4EEC\\u53EA\\u9700\\u8BBE\\u7F6E\\u4E00\\u4E0B\\u62E6\\u622A\\u5668\\uFF0C\\u7136\\u540E\\u6B63\\u5E38\\u53D1\\u8D77\\u8BF7\\u6C42\\u5373\\u53EF\\uFF1A\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`// \\u6DFB\\u52A0\\u8BF7\\u6C42\\u62E6\\u622A\\u5668\naxios.interceptors.request.use(\n  function (config) {\n    // \\u8BF7\\u6C42\\u524D\\u5904\\u7406\\u7684\\u903B\\u8F91\\u653E\\u5728\\u8FD9\\u91CC\n    return config;\n  },\n  function (error) {\n    // \\u5F02\\u5E38\\u5904\\u7406\\u7684\\u903B\\u8F91\\u653E\\u5728\\u8FD9\\u91CC\n    return Promise.reject(error);\n  }\n);\n\n// \\u6DFB\\u52A0\\u54CD\\u5E94\\u62E6\\u622A\\u5668\naxios.interceptors.response.use(\n  function (response) {\n    // \\u5BF9\\u54CD\\u5E94\\u7ED3\\u679C\\u7684\\u5904\\u7406\\u903B\\u8F91\\u653E\\u5728\\u8FD9\\u91CC\n    return response;\n  },\n  function (error) {\n    // \\u5F02\\u5E38\\u5904\\u7406\\u7684\\u903B\\u8F91\\u653E\\u5728\\u8FD9\\u91CC\n    return Promise.reject(error);\n  }\n);\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u5B8C\\u6574\\u4EE3\\u7801\\u53EF\\u4EE5\\u5728\",(0,e.jsx)(n.a,{href:\"https://github.com/kelvinleung/re-create.js/tree/main/axios\",children:\"\\u8FD9\\u91CC\\u67E5\\u770B\"}),\"\\u3002\\u63A5\\u4E0B\\u6765\\u6211\\u4EEC\\u8FD8\\u8981\\u624B\\u6495\",(0,e.jsx)(n.strong,{children:\"\\u53D6\\u6D88\\u8BF7\\u6C42\"}),\"\\uFF0C\\u8BE6\\u89C1\\u7B2C\\u4E09\\u90E8\\u5206\\u3002\"]})]})}function A(r={}){let{wrapper:n}=r.components||{};return n?(0,e.jsx)(n,Object.assign({},r,{children:(0,e.jsx)(d,r)})):d(r)}var R=A;return I(y);})();\n;return Component;"},"__N_SSG":true}