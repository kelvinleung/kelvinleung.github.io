{"pageProps":{"meta":{"title":"Axios 源码阅读笔记之——徒手撕 Ajax（三）","date":"Feb 17, 2022","desc":"在上一年（过完年相当于去年……）的文章中，我们实现了“简陋版” Axios 的拦截器功能。这一次，我们来看看取消请求的功能该如何实现。","type":"xray"},"code":"var Component=(()=>{var t=Object.create;var d=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var x=(c,r)=>()=>(r||c((r={exports:{}}).exports,r),r.exports),g=(c,r)=>{for(var o in r)d(c,o,{get:r[o],enumerable:!0})},i=(c,r,o,n)=>{if(r&&typeof r==\"object\"||typeof r==\"function\")for(let l of u(r))!m.call(c,l)&&l!==o&&d(c,l,{get:()=>r[l],enumerable:!(n=h(r,l))||n.enumerable});return c};var f=(c,r,o)=>(o=c!=null?t(p(c)):{},i(r||!c||!c.__esModule?d(o,\"default\",{value:c,enumerable:!0}):o,c)),k=c=>i(d({},\"__esModule\",{value:!0}),c);var a=x((A,s)=>{s.exports=_jsx_runtime});var P={};g(P,{default:()=>T,frontmatter:()=>C});var e=f(a()),C={title:\"Axios \\u6E90\\u7801\\u9605\\u8BFB\\u7B14\\u8BB0\\u4E4B\\u2014\\u2014\\u5F92\\u624B\\u6495 Ajax\\uFF08\\u4E09\\uFF09\",date:\"Feb 17, 2022\",desc:\"\\u5728\\u4E0A\\u4E00\\u5E74\\uFF08\\u8FC7\\u5B8C\\u5E74\\u76F8\\u5F53\\u4E8E\\u53BB\\u5E74\\u2026\\u2026\\uFF09\\u7684\\u6587\\u7AE0\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5B9E\\u73B0\\u4E86\\u201C\\u7B80\\u964B\\u7248\\u201D Axios \\u7684\\u62E6\\u622A\\u5668\\u529F\\u80FD\\u3002\\u8FD9\\u4E00\\u6B21\\uFF0C\\u6211\\u4EEC\\u6765\\u770B\\u770B\\u53D6\\u6D88\\u8BF7\\u6C42\\u7684\\u529F\\u80FD\\u8BE5\\u5982\\u4F55\\u5B9E\\u73B0\\u3002\",type:\"xray\"};function j(c={}){let{wrapper:r}=c.components||{};return r?(0,e.jsx)(r,Object.assign({},c,{children:(0,e.jsx)(o,{})})):o();function o(){let n=Object.assign({p:\"p\",code:\"code\",pre:\"pre\",h2:\"h2\",a:\"a\"},c.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"\\u5728\\u4E0A\\u4E00\\u5E74\\uFF08\\u8FC7\\u5B8C\\u5E74\\u76F8\\u5F53\\u4E8E\\u53BB\\u5E74\\u2026\\u2026\\uFF09\\u7684\\u6587\\u7AE0\\u4E2D\\uFF0C\\u6211\\u4EEC\\u5B9E\\u73B0\\u4E86\\u201C\\u7B80\\u964B\\u7248\\u201D Axios \\u7684\\u62E6\\u622A\\u5668\\u529F\\u80FD\\u3002\\u8FD9\\u4E00\\u6B21\\uFF0C\\u6211\\u4EEC\\u6765\\u770B\\u770B\\u53D6\\u6D88\\u8BF7\\u6C42\\u7684\\u529F\\u80FD\\u8BE5\\u5982\\u4F55\\u5B9E\\u73B0\\u3002\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u901A\\u8FC7\\u524D\\u9762\\u7684\\u6587\\u7AE0\\u6211\\u4EEC\\u77E5\\u9053\\uFF0CAxios \\u5B9E\\u9645\\u4E0A\\u662F\\u5C01\\u88C5\\u4E86 XHR \\u6765\\u53D1\\u8D77 Ajax \\u8BF7\\u6C42\\u7684\\u3002\\u5BF9\\u4E8E\\u539F\\u751F\\u7684 XHR\\uFF0C\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\\u5176\\u81EA\\u5E26\\u7684\",(0,e.jsx)(n.code,{children:\"abort()\"}),\"\\u65B9\\u6CD5\\u6765\\u6765\\u6267\\u884C\\u53D6\\u6D88\\u7684\\u64CD\\u4F5C\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`const xhr = new XMLHttpRequest();\nxhr.open(\"GET\", \"https://www.xxx.com/api\");\nxhr.send();\n\n// \\u53D6\\u6D88\\u8BF7\\u6C42\nxhr.abort();\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u800C\\u771F\\u6B63\\u7684 XHR \\u8BF7\\u6C42\\uFF0C\\u5219\\u662F\\u88AB\\u5C42\\u5C42\\u5305\\u88F9\\uFF0C\\u4F9D\\u6B21\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"request()\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"dispatchRequest()\"}),\"\\u3001\",(0,e.jsx)(n.code,{children:\"xhrAdapter()\"}),\"\\u7B49\\u65B9\\u6CD5\\uFF0C\\u6700\\u7EC8\\u8C03\\u7528\\u5305\\u88F9\\u5728 Promise \\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"XMLHttpRequest()\"}),\"\\u65B9\\u6CD5\\u3002\\u90A3\\u4E48\\u6211\\u4EEC\\u8BE5\\u600E\\u6837\\u53D6\\u6D88\\u4E00\\u4E2A Promise \\u5462\\uFF1F\"]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u201C\\u53D6\\u6D88\\u201D \\u4E00\\u4E2A Promise\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u77E5\\u9053\\uFF0CPromise \\u4E00\\u5171\\u6709\\u4E09\\u79CD\\u72B6\\u6001\\uFF1Apending\\u3001fulfilled\\u3001rejected\\uFF0C\\u540E\\u4E24\\u8005\\u7EDF\\u79F0\\u4E3A\\u201Csettled/resolved\\u201D\\u3002Promise \\u53EA\\u80FD\\u4ECE\\u9ED8\\u8BA4\\u7684 pending \\u72B6\\u6001\\u8F6C\\u4E3A fulfilled \\u6216 rejected\\uFF0C\\u53C8\\u6216\\u8005\\u4E00\\u76F4\\u4FDD\\u6301\\u5728 pending \\u72B6\\u6001\\u4E2D\\uFF0C\\u65E0\\u6CD5\\u88AB\\u53D6\\u6D88\\u3002\\u867D\\u7136 Promise \\u65E0\\u6CD5\\u624B\\u52A8\\u53D6\\u6D88\\uFF0C\\u4F46\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\u6216\",(0,e.jsx)(n.code,{children:\"reject()\"}),\"\\u65B9\\u6CD5\\u6765\\u6539\\u53D8\\u5176\\u72B6\\u6001\\uFF0C\\u4ECE\\u800C\\u5F3A\\u884C\\u201C\\u4E2D\\u6B62\\u201D\\u8BE5 Promise\\u3002\\u5927\\u81F4\\u539F\\u7406\\u5982\\u4E0B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`let cancel;\n\nconst axios = new Promise((resolve, reject) => {\n  cancel = reject; // \\u628A reject \\u65B9\\u6CD5\\u66B4\\u9732\\u5230\\u5916\\u9762\n  setTimeout(() => {\n    resolve(\"done\");\n  }, 3000);\n});\n\naxios\n  .then((done) => {\n    console.log(done); // \\u4E0D\\u4F1A\\u89E6\\u53D1\n  })\n  .catch((err) => {\n    console.error(err); // cancelled manually\n  });\n\ncancel(\"cancelled manually\"); // \\u76F8\\u5F53\\u4E8E\\u8C03\\u7528\\u4E86 reject()\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u867D\\u7136\\u201C\\u4E2D\\u6B62\\u201D\\u548C\\u201C\\u53D6\\u6D88\\u201D\\u4E0D\\u540C\\uFF0C\\u4F46\\u8FD9\\u6837\\u505A\\u4E00\\u6837\\u8FBE\\u5230\\u4E86\\u63D0\\u524D\\u4EE4 Promise \\u505C\\u6B62\\u4E0B\\u6765\\u7684\\u76EE\\u7684\\u3002\\u6211\\u4EEC\\u53EA\\u9700\\u8981\\u505A\\u8C03\\u7528\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\uFF08\\u6216\",(0,e.jsx)(n.code,{children:\"reject()\"}),\"\\uFF09\\u65B9\\u6CD5\\u7684\\u540C\\u65F6\\uFF08\\u6216\\u8005\\u4E4B\\u540E\\uFF0C\\u4E5F\\u5C31\\u662F\\u5728\",(0,e.jsx)(n.code,{children:\"then()\"}),\"\\u65B9\\u6CD5\\u4E2D\\u8C03\\u7528\\uFF09\\uFF0C\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"xhr.abort()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5373\\u53EF\\u5B9E\\u73B0\\u53D6\\u6D88 XHR \\u8BF7\\u6C42\\u7684\\u6548\\u679C\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Axios \\u6B63\\u662F\\u901A\\u8FC7\\u8BE5\\u539F\\u7406\\uFF0C\\u5229\\u7528\",(0,e.jsx)(n.code,{children:\"CancelToken\"}),\"\\u6765\\u6539\\u53D8 Promise \\u72B6\\u6001\\uFF0C\\u4ECE\\u800C\\u53D6\\u6D88\\u5176\\u5185\\u90E8\\u7684 XHR \\u8BF7\\u6C42\\u3002Axios \\u7684\\u8FD9\\u5957\",(0,e.jsx)(n.code,{children:\"CancelToken\"}),\"\\u7684 API \\u5219\\u662F\\u6765\\u81EA\\u4E8E\\u4E00\\u5957\\u88AB\\u64A4\\u56DE\\u7684 TC39 \\u63D0\\u6848\\uFF0C\\u6709\\u5174\\u8DA3\\u7684\\u53EF\\u4EE5\\u770B\\u770B\",(0,e.jsx)(n.a,{href:\"https://github.com/tc39/proposal-cancelable-promises\",children:\"cancelable promises proposal\"}),\"\\u3002\"]}),`\n`,(0,e.jsx)(n.h2,{children:\"Axios \\u4E2D\\u53D6\\u6D88\\u8BF7\\u6C42\\u7684\\u7528\\u6CD5\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u7167\\u4F8B\\uFF0C\\u6211\\u4EEC\\u5148\\u6765\\u770B\\u770B\\u5B98\\u65B9\\u6587\\u6863\\u4E2D Axios \\u53D6\\u6D88\\u7684\\u7528\\u6CD5\\uFF0C\\u65B9\\u6CD5\\u4E00\\uFF0C\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"CancelToken.source()\"}),\"\\u5DE5\\u5382\\u65B9\\u6CD5\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`const CancelToken = axios.CancelToken;\nconst source = CancelToken.source();\n\naxios\n  .get(\"/user/12345\", {\n    cancelToken: source.token,\n  })\n  .catch(function (thrown) {\n    if (axios.isCancel(thrown)) {\n      console.log(\"Request canceled\", thrown.message);\n    } else {\n      // handle error\n    }\n  });\n\naxios.post(\n  \"/user/12345\",\n  {\n    name: \"new name\",\n  },\n  {\n    cancelToken: source.token,\n  }\n);\n\n// cancel the request (the message parameter is optional)\nsource.cancel(\"Operation canceled by the user.\");\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u65B9\\u6CD5\\u4E8C\\uFF0C\\u76F4\\u63A5\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"CancelToken()\"}),\"\\u6784\\u9020\\u51FD\\u6570\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`const CancelToken = axios.CancelToken;\nlet cancel;\n\naxios.get(\"/user/12345\", {\n  cancelToken: new CancelToken(function executor(c) {\n    // An executor function receives a cancel function as a parameter\n    cancel = c;\n  }),\n});\n\n// cancel the request\ncancel();\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u66B4\\u9732\\u201C\\u53D6\\u6D88\\u201D\\u65B9\\u6CD5\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u53EF\\u4EE5\\u770B\\u51FA\\uFF0C\\u5173\\u952E\\u5728\\u4E8E\",(0,e.jsx)(n.code,{children:\"CancelToken()\"}),\"\\u6784\\u9020\\u51FD\\u6570\\u53C2\\u6570\",(0,e.jsx)(n.code,{children:\"executor(c)\"}),\"\\u4E2D\\u7684\\u8FD9\\u4E2A\",(0,e.jsx)(n.code,{children:\"c\"}),\"\\u3002\\u5B9E\\u9645\\u4E0A\\uFF0C\\u901A\\u8FC7\\u5DE5\\u5382\\u65B9\\u6CD5\",(0,e.jsx)(n.code,{children:\"CancelToken.source()\"}),\"\\u6240\\u751F\\u6210\\u7684\",(0,e.jsx)(n.code,{children:\"source\"}),\"\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"cancel()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u540C\\u6837\\u4E5F\\u662F\\u6307\\u5411\\u8FD9\\u4E2A\",(0,e.jsx)(n.code,{children:\"c\"}),\"\\u3002\\u8FD9\\u4E2A\\u795E\\u5947\\u7684\",(0,e.jsx)(n.code,{children:\"c\"}),\"\\uFF0C\\u7A76\\u7ADF\\u662F\\u4EC0\\u4E48\\u73A9\\u610F\\uFF1F\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u522B\\u6025\\uFF0C\\u8BA9\\u6211\\u4EEC\\u5148\\u6765\\u770B\\u770B Axios \\u6E90\\u7801\\u4E2D\\u7684\\u8FD9\\u4E2A\",(0,e.jsx)(n.code,{children:\"CancelToken\"}),\"\\u662F\\u4F55\\u65B9\\u795E\\u5723\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function CancelToken(executor) {\n  if (typeof executor !== \"function\") {\n    throw new TypeError(\"executor must be a function.\");\n  }\n\n  var resolvePromise;\n  this.promise = new Promise(function promiseExecutor(resolve) {\n    resolvePromise = resolve;\n  });\n\n  var token = this;\n  executor(function cancel(message) {\n    if (token.reason) {\n      return;\n    }\n    token.reason = new Cancel(message);\n    resolvePromise(token.reason);\n  });\n}\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u4ECE\\u6784\\u9020\\u51FD\\u6570\",(0,e.jsx)(n.code,{children:\"CancelToken()\"}),\"\\u4E2D\\u53EF\\u4EE5\\u770B\\u51FA\\uFF0C\\u5B83\\u7684\\u5B9E\\u4F8B\\u4E2D\\u6709\\u4E00\\u4E2A\\u540D\\u4E3A\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u7684\\u5C5E\\u6027\\uFF0C\\u5176\\u503C\\u662F\\u4E00\\u4E2A Promise\\uFF0C\\u5B83\\u5C06\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\u65B9\\u6CD5\\u66B4\\u9732\\u7ED9\\u4E86\",(0,e.jsx)(n.code,{children:\"resolvePromise\"}),\"\\u3002\\u800C\\u6784\\u9020\\u51FD\\u6570\",(0,e.jsx)(n.code,{children:\"CancelToken()\"}),\"\\u7684\\u53C2\\u6570\",(0,e.jsx)(n.code,{children:\"executor\"}),\"\\uFF0C\\u5728\\u751F\\u6210\\u5B9E\\u4F8B\\u65F6\\u4F1A\\u8C03\\u7528\\u3002\\u4E5F\\u5C31\\u662F\\u8BF4\\u4E0A\\u9762\\u7528\\u4F8B\\u4E8C\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"executor(c)\"}),\"\\u65B9\\u6CD5\\u5728\\u751F\\u6210 token \\u5B9E\\u4F8B\\u65F6\\u4F1A\\u6267\\u884C\\uFF0C\\u5B9E\\u9645\\u4E0A\\u5C31\\u662F\\u6267\\u884C\\u4E86\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`cancel = c;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8FD9\\u91CC\\u7684\",(0,e.jsx)(n.code,{children:\"c\"}),\"\\uFF0C\\u5C31\\u662F\\u6784\\u9020\\u51FD\\u6570\\u4E2D\\u5B9A\\u4E49\\u7684\",(0,e.jsx)(n.code,{children:\"cancel(message)\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5C31\\u76F8\\u5F53\\u4E8E\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`cancel = function cancel(message) {\n  if (token.reason) {\n    return;\n  }\n  token.reason = new Cancel(message);\n  resolvePromise(token.reason);\n};\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6240\\u4EE5\\uFF0C\\u7ED5\\u4E86\\u8FD9\\u4E48\\u4E00\\u5927\\u5708\\uFF0C\",(0,e.jsx)(n.code,{children:\"CancelToken\"}),\"\\u505A\\u7684\\u4E8B\\u60C5\\uFF0C\\u5C31\\u662F\\u5C06\\u5B9E\\u4F8B\\u4E2D\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u7684\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\u65B9\\u6CD5\\u7ED9\\u66B4\\u9732\\u51FA\\u53BB\\uFF0C\\u5F53\\u6211\\u4EEC\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"cancel()\"}),\"\\u65B9\\u6CD5\\u65F6\\uFF0C\\u4F1A\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"resolvePromise()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u6700\\u7EC8\\u5BFC\\u81F4\\u5B9E\\u4F8B\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u5C5E\\u6027\\u7684\\u72B6\\u6001\\u53D1\\u751F\\u6539\\u53D8\\u3002\"]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\u201C\\u94FE\\u201D\\u9501\\u53CD\\u5E94\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u90A3\\u4E48\\u95EE\\u9898\\u53C8\\u6765\\u4E86\\uFF0C\\u8FD9\\u4E2A\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u7684\\u4F5C\\u7528\\u53C8\\u662F\\u4EC0\\u4E48\\uFF0C\\u4E3A\\u4EC0\\u4E48\\u8981\\u8FD9\\u4E48\\u7ED5\\u5730\\u628A\\u5B83\\u7684\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\u65B9\\u6CD5\\u7ED9\\u66B4\\u9732\\u51FA\\u53BB\\uFF1F\\u8BF4\\u5230\\u66B4\\u9732\\u65B9\\u6CD5\\uFF0C\\u662F\\u5426\\u6709\\u70B9\\u719F\\u6089\\uFF1F\\u6CA1\\u9519\\uFF0C\\u8FD9\\u6B63\\u662F\\u4E0A\\u9762\\u63D0\\u5230\\u7684 Promise \\u7684\\u201C\\u53D6\\u6D88\\u201D\\uFF08\\u4E2D\\u6B62\\uFF09\\u65B9\\u6CD5\\uFF0C\\u5C06\",(0,e.jsx)(n.code,{children:\"resolve()\"}),\"\\u65B9\\u6CD5\\u66B4\\u9732\\uFF0C\\u5C31\\u662F\\u4E3A\\u4E86\\u80FD\\u591F\\u5728\\u5916\\u90E8\\u201C\\u53D6\\u6D88\\u201D\\u8FD9\\u4E2A Promise\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u77E5\\u9053\\uFF0CPromise \\u662F\\u53EF\\u4EE5\\u94FE\\u5F0F\\u8C03\\u7528\\u7684\\uFF0C\\u53EA\\u9700\\u8981\\u5728\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u7684\",(0,e.jsx)(n.code,{children:\"then()\"}),\"\\u65B9\\u6CD5\\u4E2D\\uFF0C\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"xhr.abort()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u5373\\u53EF\\u5B9E\\u73B0\\u53D6\\u6D88\\u529F\\u80FD\\u3002\\u800C\\u5728 Axios \\u4E2D\\uFF0C\\u5C31\\u662F\\u8FD9\\u6837\\u5B9E\\u73B0\\u7684\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`// \\u5728 xhrAdapter.js \\u4E2D\nfunction xhrAdapter(config) {\n  const { cancelToken } = config;\n  return new Promise((resolve, reject) => {\n    const request = new XMLHttpRequest();\n    /*\n      \\u7701\\u7565\\u4EE3\\u7801\n    */\n    request.onreadystatechange = function handleLoad() { /* \\u7701\\u7565 */ }\n    request.onabort = function handleAbort() { /* \\u7701\\u7565 */ }\n    request.onerror = function handleError() { /* \\u7701\\u7565 */ }\n\n    if (cancelToken) {\n      cancelToken.promise.then((cancel) => {\n        reject(cancel);\n        xhr!.abort();\n        xhr = null;\n      });\n    }\n    request.send();\n  });\n}\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:\"config\"}),\"\\u4E2D\\u7684\",(0,e.jsx)(n.code,{children:\"cancelToken\"}),\"\\u5C5E\\u6027\\uFF0C\\u662F\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"CancelToken\"}),\"\\u5B9E\\u4F8B\\uFF0C\\u5728\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"xhrAdapter()\"}),\"\\u65B9\\u6CD5\\u65F6\\uFF0C\\u4F1A\\u5224\\u65AD\\u662F\\u5426\\u8BBE\\u7F6E\\u4E86\\u8BE5\\u5C5E\\u6027\\uFF0C\\u82E5\\u6709\\uFF0C\\u5219\\u5728\\u5176\",(0,e.jsx)(n.code,{children:\"promise\"}),\"\\u5C5E\\u6027\\u7684\",(0,e.jsx)(n.code,{children:\"then()\"}),\"\\u65B9\\u6CD5\\u4E2D\\uFF0C\\u8C03\\u7528\\u5305\\u88F9 XHR \\u8BF7\\u6C42\\u7684 Promise \\u7684\",(0,e.jsx)(n.code,{children:\"reject()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u6765\\u4E2D\\u6B62\\u8BE5 Promise \\u7684\\u7EE7\\u7EED\\u6267\\u884C\\uFF0C\\u540C\\u65F6\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"xhr.abort()\"}),\"\\u65B9\\u6CD5\\uFF0C\\u53D6\\u6D88 XHR \\u8BF7\\u6C42\\u3002\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u8C03\\u7528\",(0,e.jsx)(n.code,{children:\"reject(cancel)\"}),\"\\u65B9\\u6CD5\\u65F6\\u7684\",(0,e.jsx)(n.code,{children:\"cancel\"}),\"\\u53C2\\u6570\\uFF0C\\u662F\\u4E00\\u4E2A\",(0,e.jsx)(n.code,{children:\"Cancel\"}),\"\\u5B9E\\u4F8B\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function Cancel(message) {\n  this.message = message;\n}\n\nCancel.prototype.__CANCEL__ = true;\n`})}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u6211\\u4EEC\\u53EF\\u4EE5\\u901A\\u8FC7\",(0,e.jsx)(n.code,{children:\"isCancel()\"}),\"\\u51FD\\u6570\\u6765\\u5224\\u65AD\",(0,e.jsx)(n.code,{children:\"reject()\"}),\"\\u65B9\\u6CD5\\u629B\\u51FA\\u7684\\u9519\\u8BEF\\u662F\\u5426\\u4E3A\",(0,e.jsx)(n.code,{children:\"Cancel\"}),\"\\u5B9E\\u4F8B\\uFF0C\\u4ECE\\u800C\\u4F5C\\u51FA\\u7279\\u6B8A\\u7684\\u5904\\u7406\\uFF1A\"]}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{className:\"language-js\",children:`function isCancel(value) {\n  return !!(value && value.__CANCEL__);\n}\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"\\u5982\\u6B64\\uFF0C\\u6211\\u4EEC\\u4FBF\\u5B9E\\u73B0\\u4E86\\u53D6\\u6D88\\u8BF7\\u6C42\\u7684\\u529F\\u80FD\\u3002\"})]})}}var T=j;return k(P);})();\n;return Component;"},"__N_SSG":true}